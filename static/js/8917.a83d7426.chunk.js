"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8917],{62921:function(e,r,t){t.d(r,{i:function(){return g}});var s=t(15671),i=t(43144),o=t(11752),a=t(61120),n=t(60136),u=t(29388),c=t(27366),d=t(85015),l=t(79056),h=t(92026),_=t(49861),p=(t(25243),t(63780),t(69912)),y=t(26279),v=t(78289),f=t(78485),m=function(){function e(r){(0,s.Z)(this,e),this._resourceFactory=r,this._resources=null,this._visible=!0,this._attached=!1,this._renderGroup=y.eZ.Outline}return(0,i.Z)(e,[{key:"destroy",value:function(){this._destroyResources()}},{key:"resources",get:function(){return(0,h.pC)(this._resources)?this._resources.external:null}},{key:"visible",get:function(){return this._visible},set:function(e){e!==this._visible&&(this._visible=e,this._syncGeometriesToRenderer())}},{key:"attached",get:function(){return this._attached},set:function(e){e!==this._attached&&(this._attached=e,this._createOrDestroyResources())}},{key:"renderGroup",get:function(){return this._renderGroup},set:function(e){var r;this._renderGroup=e;var t=null===(r=(0,h.WG)(this._resources))||void 0===r?void 0:r.layerView;t&&(t.renderGroup=e)}},{key:"recreate",value:function(){this.attached&&this._createResources()}},{key:"recreateGeometry",value:function(){this._resourceFactory.recreateGeometry?(0,h.Wi)(this._resources)||(this._ensureRenderGeometriesRemoved(),this._resourceFactory.recreateGeometry(this._resources.external),this._syncGeometriesToRenderer()):this.recreate()}},{key:"_createOrDestroyResources",value:function(){this._attached?(0,h.Wi)(this._resources)&&this._createResources():this._destroyResources()}},{key:"_createResources",value:function(){var e;this._destroyResources();var r=this._resourceFactory.createResources(),t=new R({view:this._resourceFactory.view,renderGroup:this._renderGroup}),s=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;this._resources={layerView:new R({view:this._resourceFactory.view,renderGroup:this._renderGroup}),external:r,geometriesAdded:!1},s&&(this._resources.drapeSourceRenderer=s.registerGeometryDrapeSource(t)),this._syncGeometriesToRenderer()}},{key:"_destroyResources",value:function(){var e;if(!(0,h.Wi)(this._resources)){this._ensureRenderGeometriesRemoved();var r=null===(e=this._resourceFactory.view.basemapTerrain)||void 0===e?void 0:e.overlayManager;r&&r.unregisterDrapeSource(this._resources.layerView),this._resourceFactory.destroyResources(this._resources.external),this._resources=null}}},{key:"_syncGeometriesToRenderer",value:function(){this._visible?this._ensureRenderGeometriesAdded():this._ensureRenderGeometriesRemoved()}},{key:"_ensureRenderGeometriesRemoved",value:function(){(0,h.Wi)(this._resources)||(0,h.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded&&(this._resources.drapeSourceRenderer.removeGeometries(this._resources.external.geometries,v.T.UPDATE),this._resources.geometriesAdded=!1)}},{key:"_ensureRenderGeometriesAdded",value:function(){(0,h.Wi)(this._resources)||(0,h.Wi)(this._resources.drapeSourceRenderer)||this._resources.geometriesAdded||(this._resources.drapeSourceRenderer.addGeometries(this._resources.external.geometries,v.T.UPDATE),this._resources.geometriesAdded=!0)}}]),e}(),R=function(e){(0,n.Z)(t,e);var r=(0,u.Z)(t);function t(e){var i;return(0,s.Z)(this,t),(i=r.call(this,e)).drapeSourceType=y.Lw.Features,i.updatePolicy=f.j.SYNC,i.renderGroup=y.eZ.Outline,i}return(0,i.Z)(t)}((0,l.IG)(d.Z));(0,c._)([(0,_.Cb)({constructOnly:!0})],R.prototype,"view",void 0),(0,c._)([(0,_.Cb)({readOnly:!0})],R.prototype,"drapeSourceType",void 0),(0,c._)([(0,_.Cb)()],R.prototype,"renderGroup",void 0),R=(0,c._)([(0,p.j)("DrapedVisualElementLayerView")],R);var k=t(86244),G=t(63825),g=function(e){(0,n.Z)(t,e);var r=(0,u.Z)(t);function t(e){var i,o=e.view,a=e.isDraped;return(0,s.Z)(this,t),(i=r.call(this,o))._isDraped=!1,i.object3dResources=new G.O(i.createObject3DResourceFactory(o)),i.drapedResources=new m(i.createDrapedResourceFactory(o)),i.isDraped=null!==a&&void 0!==a&&a,i}return(0,i.Z)(t,[{key:"isDraped",get:function(){return this._isDraped},set:function(e){e!==this._isDraped&&(this._isDraped=e,this.object3dResources.attached=this.attached&&!e,this.drapedResources.attached=this.attached&&e)}},{key:"renderGroup",get:function(){return this.drapedResources.renderGroup},set:function(e){this.drapedResources.renderGroup=e}},{key:"createResources",value:function(){this.object3dResources.attached=!this._isDraped,this.drapedResources.attached=this._isDraped}},{key:"destroyResources",value:function(){this.object3dResources.attached=!1,this.drapedResources.attached=!1}},{key:"recreate",value:function(){this.object3dResources.recreate(),this.drapedResources.recreate()}},{key:"recreateGeometry",value:function(){this.object3dResources.recreateGeometry(),this.drapedResources.recreateGeometry()}},{key:"destroy",value:function(){this.object3dResources.destroy(),this.drapedResources.destroy(),(0,o.Z)((0,a.Z)(t.prototype),"destroy",this).call(this)}},{key:"updateVisibility",value:function(e){this.object3dResources.visible=e,this.drapedResources.visible=e}}]),t}(k.l)},98917:function(e,r,t){t.d(r,{R:function(){return S}});var s=t(93433),i=t(37762),o=t(15671),a=t(43144),n=t(60136),u=t(29388),c=t(92026),d=t(94172),l=t(14226),h=t(81949),_=t(11186),p=t(71353),y=t(90045),v=t(67077),f=t(51378),m=t(65618),R=t(62921),k=t(19384),G=t(91526),g=t(40779),b=t(70619),D=t(56529),O=t(39077),M=t(4760),w=t(66832),T=t(58901),S=function(e){(0,n.Z)(t,e);var r=(0,u.Z)(t);function t(e){var s;return(0,o.Z)(this,t),(s=r.call(this,e))._maxSize=0,s._position=(0,p.c)(),s._up=(0,p.c)(),s._right=(0,p.c)(),s._renderOccluded=D.yD.OccludeAndTransparent,s._color=(0,v.f)(1,0,0,1),s._outlineColor=(0,v.f)(0,0,0,1),s._outlineSize=0,s._size=32,s._outlineRenderOccluded=D.yD.Opaque,s.applyProps(e),s}return(0,a.Z)(t,[{key:"createObject3DResourceFactory",value:function(e){var r=this;return{view:e,createResources:function(e){return r._createObject3DResources(e)},destroyResources:function(e){return r._destroyObject3DResources(e)},cameraChanged:function(){return r._updateTransformObject3D()}}}},{key:"createDrapedResourceFactory",value:function(e){var r=this;return{view:e,createResources:function(){return r._createDrapedResources()},destroyResources:function(e){return r._destroyDrapedResources(e)}}}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateQuadMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,y.c)(this._color,e),this._updateQuadMaterial()}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,y.c)(this._outlineColor,e),this._updateOutlineMaterial()}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){var r=0===this._outlineSize!=(0===e);this._outlineSize=e,r?this.recreateGeometry():this._updateOutlineMaterial()}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateTransform())}},{key:"outlineRenderOccluded",get:function(){return this._outlineRenderOccluded},set:function(e){this._outlineRenderOccluded=e,this._updateOutlineMaterial()}},{key:"geometry",set:function(e){var r=e.previous,t=e.center,s=e.next;this._maxSize=Math.min((0,_.i)(t,r),(0,_.i)(t,s))/3,(0,_.n)(this._up,(0,_.b)(this._up,r,t)),(0,_.n)(this._right,(0,_.b)(this._right,s,t)),(0,_.c)(this._position,t),this.recreateGeometry()}},{key:"_createObject3DResources",value:function(e){var r=new w.E(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new T.U(this._outlineMaterialParameters);return this._createObject3DGeometries(e,r,t),{quadMaterial:r,outlineMaterial:t,forEach:function(e){e(r),t&&e(t)}}}},{key:"_destroyObject3DResources",value:function(e){var r;e.quadMaterial.dispose(),null===(r=e.outlineMaterial)||void 0===r||r.dispose()}},{key:"_createObject3DGeometries",value:function(e,r,t){if(!(0,_.k)(this._up,p.Z)||!(0,_.k)(this._right,p.Z)){var s,o=this._createGeometries(r,t),a=(0,i.Z)(o);try{for(a.s();!(s=a.n()).done;){var n=s.value;e.addGeometry(n)}}catch(u){a.e(u)}finally{a.f()}this._updateTransformObject3D(e)}}},{key:"_createDrapedResources",value:function(){var e=this,r=new w.E(this._quadMaterialParameters),t=0===this._outlineSize?void 0:new T.U(this._outlineMaterialParameters),s=this._createGeometries(r,t).map((function(e){return new O.z(e,{boundingInfo:e.boundingInfo})}));return this._setTransformDraped(s),{quadMaterial:r,outlineMaterial:t,geometries:s,pixelRatioHandle:(0,d.YP)((function(){return e.view.state.contentPixelRatio}),(function(){e.drapedResources.recreateGeometry()}))}}},{key:"_destroyDrapedResources",value:function(e){var r;e.pixelRatioHandle.remove(),e.geometries=[],null!==(r=e.outlineMaterial)&&void 0!==r&&r.dispose(),e.quadMaterial.dispose()}},{key:"_createGeometries",value:function(e,r){var t=this._getVertices(),s=t.up,i=t.right,o=t.corner,a=this._quadGeometryData(s,i,o,e);return r?[a,(0,b.rh)(r,[s,o,i])]:[a]}},{key:"_getVertices",value:function(){var e=this._up,r=this._right,t=(0,_.a)(f.WM.get(),e,r);return this.isDraped&&(e=(0,_.c)(f.WM.get(),e),r=(0,_.c)(f.WM.get(),r),e[2]=0,r[2]=0,t[2]=0),{up:e,right:r,corner:t}}},{key:"_updateTransform",value:function(){this.isDraped?this.drapedResources.recreateGeometry():this._updateTransformObject3D()}},{key:"_updateTransformObject3D",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:(0,c.WG)(this.object3dResources.object);if(e){var r=this.view.state.camera,t=this._size*r.computeScreenPixelSizeAt(this._position),s=Math.min(this._maxSize,t);(0,l.f)(Z,this._position),(0,l.k)(Z,Z,[s,s,s]),e.transformation=Z}}},{key:"_setTransformDraped",value:function(e){if(0!==e.length){var r=this.view,t=r.basemapTerrain.overlayManager,s=r.state.contentPixelRatio,o=this._position,a=this._size,n=(0,_.c)(f.WM.get(),o);n[2]=k.Rn;var u=j;u.spatialReference=(0,c.Wg)(t.renderer.spatialReference),u.x=n[0],u.y=n[1];var d=a*(t.overlayPixelSizeInMapUnits(u)*s),h=Math.min(this._maxSize,d);(0,l.f)(Z,n),(0,l.k)(Z,Z,[h,h,1]);var p,y=(0,i.Z)(e);try{for(y.s();!(p=y.n()).done;){p.value.updateTransformation((function(e){(0,l.c)(e,Z)}))}}catch(v){y.e(v)}finally{y.f()}}}},{key:"_quadGeometryData",value:function(e,r,t,i){return new g.Z(i,[[M.T.POSITION,new G.a([0,0,0].concat((0,s.Z)(r),(0,s.Z)(e),(0,s.Z)(t)),3,!0)]],[[M.T.POSITION,[0,1,2,1,2,3]]])}},{key:"_quadMaterialParameters",get:function(){return{color:this._color,transparent:!0,writeDepth:!1,polygonOffset:!0,renderOccluded:this._renderOccluded}}},{key:"_updateQuadMaterial",value:function(){var e,r;null!==(e=(0,c.WG)(this.object3dResources.resources))&&void 0!==e&&e.quadMaterial.setParameters(this._quadMaterialParameters),null===(r=(0,c.WG)(this.drapedResources.resources))||void 0===r||r.quadMaterial.setParameters(this._quadMaterialParameters)}},{key:"_outlineMaterialParameters",get:function(){return{color:this._outlineColor,width:this._outlineSize,renderOccluded:this._outlineRenderOccluded}}},{key:"_updateOutlineMaterial",value:function(){var e,r,t,s;null!==(e=(0,c.WG)(this.object3dResources.resources))&&void 0!==e&&null!==(r=e.outlineMaterial)&&void 0!==r&&r.setParameters(this._outlineMaterialParameters),null===(t=(0,c.WG)(this.drapedResources.resources))||void 0===t||null===(s=t.outlineMaterial)||void 0===s||s.setParameters(this._outlineMaterialParameters)}}]),t}(R.i),Z=(0,h.c)(),j=(0,m.Tx)(0,0,void 0,null)}}]);
//# sourceMappingURL=8917.a83d7426.chunk.js.map