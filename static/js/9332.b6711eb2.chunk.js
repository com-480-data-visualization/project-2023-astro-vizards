"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9332],{42388:function(e,t,r){r.d(t,{j:function(){return y}});var a=r(15671),i=r(43144),n=r(60136),s=r(29388),o=r(27366),u=r(85015),l=r(41691),h=r(49861),p=(r(25243),r(63780),r(69912)),c={visible:"visibleSublayers"},y=function(e){(0,n.Z)(r,e);var t=(0,s.Z)(r);function r(e){var i;return(0,a.Z)(this,r),(i=t.call(this,e)).scale=0,i}return(0,i.Z)(r,[{key:"layer",set:function(e){var t=this;this._get("layer")!==e&&(this._set("layer",e),this.handles.remove("layer"),e&&this.handles.add([e.sublayers.on("change",(function(){return t.notifyChange("visibleSublayers")})),e.on("wms-sublayer-update",(function(e){return t.notifyChange(c[e.propertyName])}))],"layer"))}},{key:"layers",get:function(){return this.visibleSublayers.filter((function(e){return e.name})).map((function(e){return e.name})).join()}},{key:"version",get:function(){this.commitProperty("layers");var e=this.layer;return e&&e.commitProperty("imageTransparency"),(this._get("version")||0)+1}},{key:"visibleSublayers",get:function(){var e=this.layer,t=this.scale,r=null===e||void 0===e?void 0:e.sublayers,a=[];return null!==r&&void 0!==r&&r.forEach((function e(r){var i=r.minScale,n=r.maxScale,s=r.sublayers;r.visible&&(0===t||(0===i||t<=i)&&(0===n||t>=n))&&(s?s.forEach(e):a.push(r))})),a}},{key:"toJSON",value:function(){var e=this.layer,t=this.layers;return{format:e.imageFormat,request:"GetMap",service:"WMS",styles:"",transparent:e.imageTransparency?"TRUE":"FALSE",version:e.version,layers:t}}}]),r}((0,l.p)(u.Z));(0,o._)([(0,h.Cb)()],y.prototype,"layer",null),(0,o._)([(0,h.Cb)({readOnly:!0})],y.prototype,"layers",null),(0,o._)([(0,h.Cb)({type:Number})],y.prototype,"scale",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],y.prototype,"version",null),(0,o._)([(0,h.Cb)({readOnly:!0})],y.prototype,"visibleSublayers",null),y=(0,o._)([(0,p.j)("esri.layers.support.ExportWMSImageParameters")],y)},39332:function(e,t,r){r.r(t),r.d(t,{default:function(){return k}});var a=r(1413),i=r(74165),n=r(15861),s=r(15671),o=r(43144),u=r(60136),l=r(29388),h=r(27366),p=r(32718),c=r(92026),y=r(66978),f=r(94172),v=r(49861),d=(r(25243),r(63780),r(69912)),m=r(53866),g=r(90110),b=r(95986),x=r(9229),w=r(67581),Z=r(13107),C=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(){var e;return(0,s.Z)(this,r),(e=t.apply(this,arguments)).bitmapContainer=new g.c,e}return(0,o.Z)(r,[{key:"supportsSpatialReference",value:function(e){return this.layer.serviceSupportsSpatialReference(e)}},{key:"update",value:function(e){var t=this;this.strategy.update(e).catch((function(e){(0,y.D_)(e)||p.Z.getLogger(t.declaredClass).error(e)}))}},{key:"attach",value:function(){var e=this,t=this.layer,r=t.imageMaxHeight,a=t.imageMaxWidth;this.bitmapContainer=new g.c,this.container.addChild(this.bitmapContainer),this.strategy=new x.Z({container:this.bitmapContainer,fetchSource:this.fetchImage.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxHeight:r,imageMaxWidth:a,imageRotationSupported:!1,imageNormalizationSupported:!1,hidpi:!1}),this.addAttachHandles((0,f.YP)((function(){return e.exportImageVersion}),(function(){return e.requestUpdate()})))}},{key:"detach",value:function(){this.strategy=(0,c.SC)(this.strategy),this.container.removeAllChildren()}},{key:"moveStart",value:function(){}},{key:"viewChange",value:function(){}},{key:"moveEnd",value:function(){this.requestUpdate()}},{key:"createFetchPopupFeaturesQuery",value:function(e){var t,r=this.view,a=this.bitmapContainer,i=e.x,n=e.y,s=r.spatialReference,o=0,u=0;if(a.children.some((function(e){var r=e.width,a=e.height,l=e.resolution,h=e.x,p=e.y,c=h+l*r,y=p-l*a;return i>=h&&i<=c&&n<=p&&n>=y&&(t=new m.Z({xmin:h,ymin:y,xmax:c,ymax:p,spatialReference:s}),o=r,u=a,!0)})),!t)return null;var l=t.width/o,h=Math.round((i-t.xmin)/l),p=Math.round((t.ymax-n)/l);return{extent:t,width:o,height:u,x:h,y:p}}},{key:"doRefresh",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.requestUpdate();case 1:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isUpdating",value:function(){return this.strategy.updating||this.updateRequested}},{key:"fetchImage",value:function(e,t,r,i){return this.layer.fetchImageBitmap(e,t,r,(0,a.Z)({timeExtent:this.timeExtent},i))}}]),r}((0,r(29431).Z)((0,Z.Z)((0,b.y)(w.Z))));(0,h._)([(0,v.Cb)()],C.prototype,"strategy",void 0),(0,h._)([(0,v.Cb)()],C.prototype,"updating",void 0);var k=C=(0,h._)([(0,d.j)("esri.views.2d.layers.WMSLayerView2D")],C)},13107:function(e,t,r){r.d(t,{Z:function(){return y}});var a=r(15671),i=r(43144),n=r(60136),s=r(29388),o=r(27366),u=r(32718),l=r(66978),h=r(94172),p=r(49861),c=(r(25243),r(63780),r(69912)),y=function(e){var t=function(e){(0,n.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"initialize",value:function(){var e=this;this.handles.add((0,h.on)((function(){return e.layer}),"refresh",(function(t){e.doRefresh(t.dataChanged).catch((function(t){(0,l.D_)(t)||u.Z.getLogger(e.declaredClass).error(t)}))})),"RefreshableLayerView")}}]),r}(e);return(0,o._)([(0,p.Cb)()],t.prototype,"layer",void 0),t=(0,o._)([(0,c.j)("esri.layers.mixins.RefreshableLayerView")],t)}},29431:function(e,t,r){r.d(t,{Z:function(){return f}});var a=r(15671),i=r(43144),n=r(60136),s=r(29388),o=r(27366),u=r(10064),l=r(92026),h=r(49861),p=(r(25243),r(63780),r(69912)),c=r(45948),y=r(42388),f=function(e){var t=function(e){(0,n.Z)(r,e);var t=(0,s.Z)(r);function r(){return(0,a.Z)(this,r),t.apply(this,arguments)}return(0,i.Z)(r,[{key:"initialize",value:function(){this.exportImageParameters=new y.j({layer:this.layer})}},{key:"destroy",value:function(){this.exportImageParameters=(0,l.SC)(this.exportImageParameters)}},{key:"exportImageVersion",get:function(){var e;return null!==(e=this.exportImageParameters)&&void 0!==e&&e.commitProperty("version"),this.commitProperty("timeExtent"),(this._get("exportImageVersion")||0)+1}},{key:"fetchPopupFeatures",value:function(e){var t=this.layer;if(!e)return Promise.reject(new u.Z("wmslayerview:fetchPopupFeatures","Nothing to fetch without area",{layer:t}));var r=t.popupEnabled;if(!r)return Promise.reject(new u.Z("wmslayerview:fetchPopupFeatures","popupEnabled should be true",{popupEnabled:r}));var a=this.createFetchPopupFeaturesQuery(e);if(!a)return Promise.resolve([]);var i=a.extent,n=a.width,s=a.height,o=a.x,l=a.y;if(!(i&&n&&s))throw new u.Z("wmslayerview:fetchPopupFeatures","WMSLayer does not support fetching features.",{extent:i,width:n,height:s});return t.fetchFeatureInfo(i,n,s,o,l)}}]),r}(e);return(0,o._)([(0,h.Cb)()],t.prototype,"exportImageParameters",void 0),(0,o._)([(0,h.Cb)({readOnly:!0})],t.prototype,"exportImageVersion",null),(0,o._)([(0,h.Cb)()],t.prototype,"layer",void 0),(0,o._)([(0,h.Cb)(c.qG)],t.prototype,"timeExtent",void 0),t=(0,o._)([(0,p.j)("esri.layers.mixins.WMSLayerView")],t)}}}]);
//# sourceMappingURL=9332.b6711eb2.chunk.js.map