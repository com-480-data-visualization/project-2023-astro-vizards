"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[96],{11316:function(e,t,i){i.d(t,{S:function(){return h},b:function(){return p}});var a,n,r=i(30168),s=i(41012),o=i(95276),l=i(58406),u=i(98634),c=i(64201),d=i(4760);function p(e){var t=new c.kG;t.extensions.add("GL_OES_standard_derivatives");var i=t.vertex,p=t.fragment,h=t.attributes,v=t.varyings;return(0,s.Sv)(i,e),h.add(d.T.POSITION,"vec3"),h.add(d.T.UV0,"vec2"),v.add("vUV","vec2"),i.code.add((0,u.H)(a||(a=(0,r.Z)(["void main(void) {\nvUV = uv0;\ngl_Position = proj * view * vec4(position, 1.0);\n}"])))),p.uniforms.add([new o.N("backgroundColor",(function(e){return e.backgroundColor})),new o.N("gridColor",(function(e){return e.gridColor})),new l.p("gridWidth",(function(e){return e.gridWidth}))]),p.code.add((0,u.H)(n||(n=(0,r.Z)(["void main() {\nconst float LINE_WIDTH = 1.0;\nvec2 uvScaled = vUV * gridWidth;\nvec2 gridUV = (fract(uvScaled + 0.5) - 0.5) / (LINE_WIDTH * fwidth(uvScaled));\nvec2 grid = (1.0 - step(0.5, gridUV)) * step(-0.5, gridUV);\ngrid.x *= step(0.5, uvScaled.x) * step(uvScaled.x, gridWidth - 0.5);\ngrid.y *= step(0.5, uvScaled.y) * step(uvScaled.y, gridWidth - 0.5);\nfloat gridFade = max(grid.x, grid.y);\nfloat gridAlpha = gridColor.a * gridFade;\ngl_FragColor =\nvec4(backgroundColor.rgb * backgroundColor.a, backgroundColor.a) * (1.0 - gridAlpha) +\nvec4(gridColor.rgb, 1.0) * gridAlpha;\n}"])))),t}var h=Object.freeze(Object.defineProperty({__proto__:null,build:p},Symbol.toStringTag,{value:"Module"}))},96866:function(e,t,i){i.d(t,{B:function(){return f}});var a=i(74165),n=i(15861),r=i(1413),s=i(37762),o=i(80292),l=i(35995),u=i(71907),c=i(33397),d=i(25265),p=i(49861),h=i(22892),v=i(53283);function f(e){var t,i=null!==(t=null===e||void 0===e?void 0:e.origins)&&void 0!==t?t:[void 0];return function(t,a){var n,u=function(e,t,i){var a;if("resource"===(null===e||void 0===e?void 0:e.type))return function(e,t,i){var a=(0,c.Oe)(t,i);return{type:String,read:function(e,t,i){var n=(0,v.r)(e,t,i);return a.type===String?n:"function"==typeof a.type?new a.type({url:n}):void 0},write:{writer:function(t,n,s,u){if(!u||!u.resources)return"string"==typeof t?void(n[s]=(0,v.t)(t,u)):void(n[s]=t.write({},u));var c=function(e){return null==e?null:"string"==typeof e?e:e.url}(t),p=(0,v.t)(c,(0,r.Z)((0,r.Z)({},u),{},{verifyItemRelativeUrls:u&&u.verifyItemRelativeUrls?{writtenUrls:u.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0}),v.M.NO),f=a.type!==String&&(!(0,o.l)(this)||u&&u.origin&&this.originIdOf(i)>(0,d.M9)(u.origin)),_={object:this,propertyName:i,value:t,targetUrl:p,dest:n,targetPropertyName:s,context:u,params:e};u&&u.portalItem&&p&&!(0,l.YP)(p)?f?function(e){var t,i=e.context,a=e.targetUrl,n=e.params,s=e.value,o=e.dest,u=e.targetPropertyName;if(!i.portalItem)return;var c=i.portalItem.resourceFromPath(a),d=w(s,a,i),p=(0,h.B)(d),v=(0,l.Ml)(c.path),f=null!==(t=null===n||void 0===n?void 0:n.compress)&&void 0!==t&&t;p===v?(i.resources&&y((0,r.Z)((0,r.Z)({},e),{},{resource:c,content:d,compress:f,updates:i.resources.toUpdate})),o[u]=a):g(e)}(_):function(e){var t=e.context,i=e.targetUrl,a=e.dest,n=e.targetPropertyName;t.portalItem&&t.resources&&(t.resources.toKeep.push({resource:t.portalItem.resourceFromPath(i),compress:!1}),a[n]=i)}(_):u&&u.portalItem&&(null==p||null!=(0,v.i)(p)||(0,l.jc)(p)||f)?g(_):n[s]=p}}}}(e,t,i);switch(null!==(a=null===e||void 0===e?void 0:e.type)&&void 0!==a?a:"other"){case"other":return{read:!0,write:!0};case"url":return{read:v.a.read,write:v.a.write}}}(e,t,a),f=(0,s.Z)(i);try{for(f.s();!(n=f.n()).done;){var _=n.value,m=(0,p.CJ)(t,_,a);for(var b in u)m[b]=u[b]}}catch(P){f.e(P)}finally{f.f()}}}function g(e){var t,i,a,n=e.targetUrl,s=e.params,o=e.value,c=e.context,d=e.dest,p=e.targetPropertyName;if(c.portalItem){var f=(0,v.p)(n),g=null!==(t=null===f||void 0===f?void 0:f.filename)&&void 0!==t?t:(0,u.D)(),m=null!==(i=null===s||void 0===s?void 0:s.prefix)&&void 0!==i?i:null===f||void 0===f?void 0:f.prefix,b=w(o,n,c),P=(0,l.v_)(m,g),D="".concat(P,".").concat((0,h.B)(b)),M=c.portalItem.resourceFromPath(D);(0,l.jc)(n)&&c.resources&&c.resources.pendingOperations.push(function(e){return _.apply(this,arguments)}(n).then((function(e){M.path="".concat(P,".").concat((0,h.B)(e)),d[p]=M.itemRelativeUrl})).catch((function(){})));var C=null!==(a=null===s||void 0===s?void 0:s.compress)&&void 0!==a&&a;c.resources&&y((0,r.Z)((0,r.Z)({},e),{},{resource:M,content:b,compress:C,updates:c.resources.toAdd})),d[p]=M.itemRelativeUrl}}function y(e){var t=e.object,i=e.propertyName,a=e.updates,n=e.resource,r=e.content,s=e.compress;a.push({resource:n,content:r,compress:s,finish:function(e){!function(e,t,i){"string"==typeof e[t]?e[t]=i.url:e[t].url=i.url}(t,i,e)}})}function w(e,t,i){return"string"==typeof e?{url:t}:new Blob([JSON.stringify(e.toJSON(i))],{type:"application/json"})}function _(){return(_=(0,n.Z)((0,a.Z)().mark((function e(t){var n,r,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.resolve().then(i.bind(i,76200));case 2:return n=e.sent.default,e.next=5,n(t,{responseType:"blob"});case 5:return r=e.sent,s=r.data,e.abrupt("return",s);case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},80292:function(e,t,i){function a(e){return e&&"getAtOrigin"in e&&"originOf"in e}i.d(t,{l:function(){return a}})},30494:function(e,t,i){i.d(t,{T:function(){return l}});var a=i(74165),n=i(15861),r=i(76200),s=i(10064),o=i(92026);function l(e,t,i,a,n,r){return u.apply(this,arguments)}function u(){return u=(0,n.Z)((0,a.Z)().mark((function e(t,i,n,l,u,c){var d,p,h,v,f;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(d=null,!(0,o.pC)(n)){e.next=17;break}return p="".concat(t,"/nodepages/"),h=p+Math.floor(n.rootIndex/n.nodesPerPage),e.prev=3,e.next=6,(0,r.default)(h,{query:{f:"json",token:l},responseType:"json",signal:c});case 6:return e.t0=e.sent.data,e.t1=n.rootIndex,e.t2=n.nodesPerPage,e.t3=n.lodSelectionMetricType,e.t4=p,e.abrupt("return",{type:"page",rootPage:e.t0,rootIndex:e.t1,pageSize:e.t2,lodMetric:e.t3,urlPrefix:e.t4});case 14:e.prev=14,e.t5=e.catch(3),(0,o.pC)(u)&&u.warn("#fetchIndexInfo()","Failed to load root node page. Falling back to node documents.",h,e.t5),d=e.t5;case 17:if(i){e.next=19;break}return e.abrupt("return",null);case 19:return v="".concat(t,"/nodes/"),f=v+(i&&i.split("/").pop()),e.prev=20,e.next=23,(0,r.default)(f,{query:{f:"json",token:l},responseType:"json",signal:c});case 23:return e.t6=e.sent.data,e.t7=v,e.abrupt("return",{type:"node",rootNode:e.t6,urlPrefix:e.t7});case 28:throw e.prev=28,e.t8=e.catch(20),new s.Z("sceneservice:root-node-missing","Root node missing.",{pageError:d,nodeError:e.t8,url:f});case 31:case"end":return e.stop()}}),e,null,[[3,14],[20,28]])}))),u.apply(this,arguments)}},22892:function(e,t,i){i.d(t,{B:function(){return n}});var a=i(35995);function n(e){return r[function(e){return e instanceof Blob?e.type:function(e){var t=(0,a.Ml)(e);return l[t]||s}(e.url)}(e)]||o}var r={},s="text/plain",o=r[s],l={png:"image/png",jpeg:"image/jpeg",jpg:"image/jpg",bmp:"image/bmp",gif:"image/gif",json:"application/json",txt:"text/plain",xml:"application/xml",svg:"image/svg+xml",zip:"application/zip",pbf:"application/vnd.mapbox-vector-tile",gz:"application/gzip","bin.gz":"application/octet-stream"};for(var u in l)r[l[u]]=u},96664:function(e,t,i){i.d(t,{O:function(){return o},s:function(){return l}});var a="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",n="data:image/png;base64,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",r=i(1487),s={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function o(e){return e.fromData(a,(function(){return new r.x(a,s)}))}function l(e){return e.fromData(n,(function(){return new r.x(n,s)}))}},64269:function(e,t,i){i.r(t),i.d(t,{default:function(){return Jt}});var a=i(15671),n=i(43144),r=i(60136),s=i(29388),o=i(27366),l=i(85015),u=i(92026),c=i(49861),d=i(25243),p=(i(63780),i(69912)),h=i(98074),v=(i(59486),i(11582)),f=i(17768),g=i(46784),y=i(89125),w=i(96866),_=i(585),m=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="plane",n.position=null,n.heading=0,n.tilt=0,n.width=10,n.height=10,n}return(0,n.Z)(i,[{key:"equals",value:function(e){return this.heading===e.heading&&this.tilt===e.tilt&&(0,u._W)(this.position,e.position)&&this.width===e.width&&this.height===e.height}}]),i}((0,v.J)(g.wq));(0,o._)([(0,c.Cb)({readOnly:!0,json:{read:!1,write:!0}})],m.prototype,"type",void 0),(0,o._)([(0,c.Cb)({type:_.Z}),(0,w.B)()],m.prototype,"position",void 0),(0,o._)([(0,c.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,w.B)(),(0,y.p)((function(e){return f.BV.normalize((0,d.q9)(e),0,!0)}))],m.prototype,"heading",void 0),(0,o._)([(0,c.Cb)({type:Number,nonNullable:!0,range:{min:0,max:360}}),(0,w.B)(),(0,y.p)((function(e){return f.BV.normalize((0,d.q9)(e),0,!0)}))],m.prototype,"tilt",void 0),(0,o._)([(0,c.Cb)({type:Number,nonNullable:!0}),(0,w.B)()],m.prototype,"width",void 0),(0,o._)([(0,c.Cb)({type:Number,nonNullable:!0}),(0,w.B)()],m.prototype,"height",void 0);var b=m=(0,o._)([(0,p.j)("esri.analysis.SlicePlane")],m),P=i(100),D=i(32718),M=i(94172),C=i(82218),A=i(30651),k=i(59147),V=i(1413),T=i(93433),E=i(29439),I=i(93169),S=i(16889),W=i(17842),O=i(14226),x=i(81949),R=i(48976),Z=i(11186),L=i(71353),H=i(79803),N=i(14320),z=i(55652),U=i(40885),G=i(40927),Q=i(51378),B=i(67077),j=(0,I.Z)("mac")?"Meta":"Control",F="Shift",Y=1.15,q=1.15,X=Math.cos((0,S.Vl)(45)),K=Math.cos((0,S.Vl)(5)),J=(0,L.f)(1,.5,0),$=1,ee=(0,B.b)([].concat((0,T.Z)(J),[.7])),te=[0,0,0,.04],ie=(0,B.b)([].concat((0,T.Z)(J),[.5])),ae=(0,B.f)(1,1,1,1),ne=(0,B.f)(1,.8,.6,1),re=(0,B.f)(1,.93,.86,1),se=(0,B.b)([].concat((0,T.Z)(J),[1])),oe=(0,B.b)([].concat((0,T.Z)(J),[1])),le=3,ue=11,ce=22.5,de=(0,B.b)([].concat((0,T.Z)(J),[1])),pe=.3,he=i(33906),ve=i(35284),fe=i(83639),ge=i(40508),ye=i(33837),we=i(90045),_e=i(52168),me=i(70619),be=i(56529),Pe=i(37081),De=i(33559),Me=i(23620),Ce=i(93822),Ae=i(12594),ke=i(64642),Ve=i(11983),Te=i(98634),Ee=i(82144),Ie=i(31132),Se=i(7566),We=i(27627),Oe=i(11316),xe=i(8548),Re=i(36207),Ze=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).backgroundColor=(0,B.f)(1,0,0,.5),e.gridColor=(0,B.f)(0,1,0,.5),e.gridWidth=4,e}return(0,n.Z)(i)}(Te.K),Le=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(){return(0,a.Z)(this,i),t.apply(this,arguments)}return(0,n.Z)(i,[{key:"initializeProgram",value:function(e){return new We.$(e.rctx,i.shader.get().build(this.configuration),Se.i)}},{key:"initializePipeline",value:function(){return(0,Re.sm)({blending:(0,Re.wK)(xe.zi.ONE,xe.zi.ONE,xe.zi.ONE_MINUS_SRC_ALPHA,xe.zi.ONE_MINUS_SRC_ALPHA),depthTest:{func:xe.wb.LESS},colorWrite:Re.BK})}}]),i}(Ie.A);Le.shader=new Ee.J(Oe.S,(function(){return i.e(8492).then(i.bind(i,18492))}));var He,Ne=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e,new Ue))._configuration=new De.m,n}return(0,n.Z)(i,[{key:"createBufferWriter",value:function(){return new Ae.G(ke.W1)}},{key:"requiresSlot",value:function(e,t){return t===Pe.H.Color&&e===Ce.r.TRANSPARENT_DEPTH_WRITE_DISABLED_MATERIAL}},{key:"createGLMaterial",value:function(e){return new ze(e)}},{key:"getConfiguration",value:function(){return this._configuration}}]),i}(Ve.c),ze=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).ensureTechnique(Le,null),n}return(0,n.Z)(i,[{key:"beginSlot",value:function(){return(0,u.Wg)(this.technique)}}]),i}(Me.Z),Ue=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(){var e;return(0,a.Z)(this,i),(e=t.apply(this,arguments)).renderOccluded=be.yD.Occlude,e}return(0,n.Z)(i)}(Ze),Ge=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._material=null,n._renderOccluded=be.yD.OccludeAndTransparent,n._gridWidth=1,n._gridColor=(0,B.f)(1,0,0,1),n._backgroundColor=(0,B.f)(1,0,0,1),n.applyProps(e),n}return(0,n.Z)(i,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"gridWidth",get:function(){return this._gridWidth},set:function(e){this._gridWidth!==e&&(this._gridWidth=e,this._updateMaterial())}},{key:"gridColor",get:function(){return this._gridColor},set:function(e){(0,we.c)(this._gridColor,e),this._updateMaterial()}},{key:"backgroundColor",get:function(){return this._backgroundColor},set:function(e){(0,we.c)(this._backgroundColor,e),this._updateMaterial()}},{key:"createExternalResources",value:function(){this._material=new Ne(this._materialParameters)}},{key:"destroyExternalResources",value:function(){this._material=null}},{key:"forEachExternalMaterial",value:function(e){(0,u.pC)(this._material)&&e(this._material)}},{key:"createGeometries",value:function(e){if((0,u.pC)(this._material)){var t=(0,me.g7)(this._material);e.addGeometry(t)}}},{key:"_materialParameters",get:function(){return{backgroundColor:this._backgroundColor,gridWidth:this._gridWidth,gridColor:this._gridColor,renderOccluded:this._renderOccluded}}},{key:"_updateMaterial",value:function(){(0,u.pC)(this._material)&&this._material.setParameters(this._materialParameters)}}]),i}(_e._),Qe=i(17539),Be=i(81703),je=i(68401),Fe=i(66832),Ye=i(24231),qe=i(58901),Xe=i(99034);i(53866);function Ke(e,t,i,a,n,r,s,o){return function(e,t,i,a,n,r){var s=(0,Z.e)(e,t),o=Q.WM.get(),l=Q.WM.get();switch(a===gt.HORIZONTAL_OR_VERTICAL?Math.abs(s)>X?gt.HORIZONTAL:gt.VERTICAL:a){case gt.VERTICAL:var u=Math.abs(s)<=K?e:i.viewUp;(0,Z.f)(o,u,t),(0,Z.c)(l,t);break;case gt.HORIZONTAL:(0,Z.f)(o,i.viewUp,t),(0,Z.f)(l,t,o);break;case gt.TILTED:var c=Math.abs(s)<=K?t:i.viewUp;(0,Z.f)(o,c,e),(0,Z.f)(l,e,o)}var d=(0,Z.f)(Q.WM.get(),o,l);(0,Z.e)(d,i.viewForward)>0&&(0,Z.g)(l,l,-1),(0,Z.n)(n,o),(0,Z.n)(r,l)}(t,s.worldUpAtPosition(e,Q.WM.get()),n,r,o.basis1,o.basis2),(0,Z.g)(o.basis1,o.basis1,i),(0,Z.g)(o.basis2,o.basis2,a),(0,Z.c)(o.origin,e),(0,z.my)(o.basis2,o.basis1,o.origin,o.plane),o}function Je(e,t){return(0,fe.Aq)(e.basis1,e.basis2,e.origin,t)}function $e(e,t,i,a){var n=t.worldUpAtPosition(e.origin,Q.WM.get()),r=Q.WM.get();switch(i){case ft.HEADING:(0,Z.c)(r,n);break;case ft.TILT:(0,Z.c)(r,e.basis1)}return(0,z.Yq)(e.origin,r,a)}function et(e,t,i,a){var n=tt(i,He.NEGATIVE_X),r=Q.MP.get();(0,O.o)(r,t,n.edge*Math.PI/2);var s=(0,Z.n)(Q.WM.get(),n.basis),o=(0,Z.g)(Q.WM.get(),s,n.direction*a.computeScreenPixelSizeAt(n.position)*40);(0,Z.a)(o,o,n.position);var l=a.projectToRenderScreen(o,(0,W.Wv)(Q.WM.get())),u=function(e,t){var i=(0,E.Z)(e.viewport,4),a=i[0],n=i[1],r=i[2],s=i[3],o=Math.min(r,s)/16,l=!0;return t[0]<a+o?(t[0]=a+o,l=!1):t[0]>a+r-o&&(t[0]=a+r-o,l=!1),t[1]<n+o?(t[1]=n+o,l=!1):t[1]>n+s-o&&(t[1]=n+s-o,l=!1),l}(a,l);(0,Be.Bh)(a,l,mt),(0,Z.n)(mt.direction,mt.direction);var c=Q.WM.get();!u&&(0,C.i)(i,mt,c)&&(o=c),r[12]=0,r[13]=0,r[14]=0,e.modelTransform=r,e.renderLocation=(0,L.a)(o),u?e.state|=_t:e.state&=~_t}function tt(e,t){switch(t){case He.POSITIVE_X:return{basis:e.basis1,direction:1,position:(0,Z.a)(Q.WM.get(),e.origin,e.basis1),edge:t};case He.POSITIVE_Y:return{basis:e.basis2,direction:1,position:(0,Z.a)(Q.WM.get(),e.origin,e.basis2),edge:t};case He.NEGATIVE_X:return{basis:e.basis1,direction:-1,position:(0,Z.b)(Q.WM.get(),e.origin,e.basis1),edge:t};case He.NEGATIVE_Y:return{basis:e.basis2,direction:-1,position:(0,Z.b)(Q.WM.get(),e.origin,e.basis2),edge:t}}}function it(e,t,i){var a=i.projectToRenderScreen((0,Z.a)(Q.WM.get(),e,t),(0,W.Wv)(Q.WM.get())),n=i.projectToRenderScreen((0,Z.b)(Q.WM.get(),e,t),(0,W.Wv)(Q.WM.get()));return(0,Z.p)((0,Z.b)(a,a,n))}function at(e){var t=(0,Z.l)(e.basis1),i=(0,Z.l)(e.basis2);return pe*Math.min(t,i)}function nt(e){return at(e)}function rt(e){return 0!==e.direction[0]&&0!==e.direction[1]}function st(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:wt.CENTER_ON_ARROW)===wt.CENTER_ON_CALLOUT?40:0,i=[(0,L.f)(t,0,-24),(0,L.f)(t,0,24)],a=function(e,t){var i=(0,Z.b)((0,L.c)(),e[e.length-1],e[e.length-2]);if((0,Z.n)(i,i),(0,Z.g)(i,i,ce),(0,Z.a)(i,i,e[e.length-1]),t){var a=(0,Z.b)((0,L.c)(),e[0],e[1]);return(0,Z.n)(a,a),(0,Z.g)(a,a,ce),(0,Z.a)(a,a,e[0]),[a].concat((0,T.Z)(e),[i])}return[].concat((0,T.Z)(e),[i])}(i,!0),n=function(e,t){return function(e,t,i){var a=new Fe.E({color:ae,cullFace:je.Vr.Back,renderOccluded:be.yD.Opaque}),n=new Fe.E({color:ne,cullFace:je.Vr.Back,renderOccluded:be.yD.Opaque}),r=new Fe.E({color:re,cullFace:je.Vr.Back,renderOccluded:be.yD.Opaque}),s=new Fe.E({color:oe,transparent:!0,writeDepth:!1,cullFace:je.Vr.Front,renderOccluded:be.yD.Transparent}),o=function(o){e=e.slice(0);var l=(0,Z.b)(Q.WM.get(),e[0],e[1]);(0,Z.n)(l,l);var u=(0,Z.b)(Q.WM.get(),e[e.length-1],e[e.length-2]);if((0,Z.n)(u,u),t>0){var c=(0,Z.g)((0,L.c)(),u,-t);e[e.length-1]=(0,Z.a)(c,c,e[e.length-1]);var d=(0,Z.g)((0,L.c)(),l,-t);e[0]=(0,Z.a)(d,d,e[0])}var p=o?q:1,h=ce*p,v=ue*p,f=(0,O.i)(Q.MP.get());if(t>0){var g=h/4,y=(0,Z.s)(Q.WM.get(),0,g,0),w=1+t/g;(0,O.w)(f,f,y),(0,O.k)(f,f,(0,Z.s)(Q.WM.get(),w,w,w)),(0,O.w)(f,f,(0,Z.g)(y,y,-1/w))}var _=(0,O.i)((0,x.c)()),m=(0,L.f)(0,1,0),b=(0,O.F)((0,x.c)(),(0,R.r)(Q.vD.get(),m,u));b[12]=e[e.length-1][0],b[13]=e[e.length-1][1],b[14]=e[e.length-1][2],(0,O.m)(b,b,f);var P=function(e,t,i){for(var a=[],n=12,r=0;r<n;r++){var s=r/n*2*Math.PI;a.push([Math.cos(s)*e,Math.sin(s)*e])}return(0,me.x2)(i,a,t,[],[],!1)}(le*(o?Y:1)+t,e,i?s:r);P.transformation=_;var D=[P],M=(0,me.QL)(i?s:a,h,v,24,!1,!1,!0);M.transformation=b,D.push(M);var C=(0,me.QL)(i?s:n,h,v,24,!1,!0,!1);C.transformation=b,D.push(C);var A=(0,O.F)((0,x.c)(),(0,R.r)(Q.vD.get(),m,l));return A[12]=e[0][0],A[13]=e[0][1],A[14]=e[0][2],(0,O.m)(A,A,f),D.push(M.instantiate({transformation:A})),D.push(C.instantiate({transformation:A})),D};return{normal:o(!1),focused:o(!0)}}(i,e,t)},r=n(0,!1),s=n(2.25,!0),o=new Ye.Y({color:se,renderOccluded:be.yD.OccludeAndTransparent}),l=(0,me.rh)(o,[[t,0,0],[t-40,0,0]]),u=(0,me.rh)(o,[[t,0,0],[t-40,0,0]]);return new ve.Z({view:e,renderObjects:[].concat((0,T.Z)(r.normal.map((function(e){return new ge.r(e,Xe.Q9.Unfocused|yt)}))),(0,T.Z)(s.normal.map((function(e){return new ge.r(e,Xe.Q9.Unfocused|yt)}))),[new ge.r(l,Xe.Q9.Unfocused|yt|_t)],(0,T.Z)(r.focused.map((function(e){return new ge.r(e,Xe.Q9.Focused|yt)}))),(0,T.Z)(s.focused.map((function(e){return new ge.r(e,Xe.Q9.Focused|yt)}))),[new ge.r(u,Xe.Q9.Focused|yt|_t)]),autoScaleRenderObjects:!1,collisionType:{type:"line",paths:[a]},collisionPriority:1,radius:ue,state:yt})}function ot(e,t){var i=(0,fe.Ju)(e,{customStateMask:yt,texture:t});return i.state=yt,i}function lt(e){return new ye.r({view:e,attached:!1,color:ee,width:$,writeDepthEnabled:!1,renderOccluded:be.yD.OccludeAndTransparent,geometry:[[[-1,-1,0],[1,-1,0],[1,1,0],[-1,1,0],[-1,-1,0]]]})}function ut(e){return new Ge({view:e,attached:!1,backgroundColor:(0,T.Z)(te),gridColor:ie,gridWidth:4,renderOccluded:be.yD.OccludeAndTransparent})}function ct(e,t){var i=rt(t),a=i?[(0,L.f)(1,0,0),(0,L.f)(0,0,0),(0,L.f)(0,1,0)]:[(0,L.f)(1,0,0),(0,L.f)(-1,0,0)],n=de,r=i?4:1,s=2*r,o=function(e){return e>1?function(e){return new qe.U({color:n,width:e,renderOccluded:be.yD.OccludeAndTransparent})}(e):new Ye.Y({color:n,renderOccluded:be.yD.OccludeAndTransparent})},l=[new ge.r((0,me.rh)(o(r),a),Xe.Q9.Unfocused|Pt),new ge.r((0,me.rh)(o(s),a),Xe.Q9.Focused|Pt),new ge.r((0,me.rh)(o(1),a),Dt)],u=new ve.Z((0,V.Z)({view:e,renderObjects:l,collisionType:{type:"line",paths:[a]},radius:i?6:4},fe.X9));return u.state=Pt,u}function dt(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new b;if((0,u.Wi)(e))return null;var n=t.renderCoordsHelper,r=n.fromRenderCoords(e.origin,t.spatialReference);if((0,u.Wi)(r))return null;var s=(0,H.fM)(r,i);if((0,u.Wi)(s))return null;a.position=s;var o=2*(0,Z.l)(e.basis1),l=2*(0,Z.l)(e.basis2),c=Qe.Z.renderUnitScaleFactor(t.spatialReference,i);a.width=o*c,a.height=l*c;var d=n.worldUpAtPosition(e.origin,Q.WM.get());return a.tilt=(0,S.BV)(pt(e,d)),a.heading=n.headingAtPosition(e.origin,e.basis1)-90,a}function pt(e,t){return(0,G.cp)(t,e.basis2,e.basis1)+bt}function ht(e,t){if((0,u.Wi)(e)||(0,u.Wi)(e.position))return null;var i=(0,he.G)(e.position,t.spatialReference,t.elevationProvider);if((0,u.Wi)(i))return null;var a=Qe.Z.renderUnitScaleFactor(e.position.spatialReference,t.spatialReference),n=e.width*a,r=e.height*a;return{position:i,heading:e.heading,tilt:e.tilt,renderWidth:n,renderHeight:r}}function vt(e,t,i){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:(0,C.a)();if((0,u.Wi)(e))return null;var n=function(e,t,i,a,n,r){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:(0,C.a)();return r.toRenderCoords(e,s.origin)?(r.worldBasisAtPosition(s.origin,N.R.X,s.basis1),r.worldBasisAtPosition(s.origin,N.R.Y,s.basis2),(0,z.my)(s.basis2,s.basis1,s.origin,s.plane),(0,C.r)(s,-(0,S.Vl)(t),(0,C.n)(s),s),(0,C.r)(s,(0,S.Vl)(i),s.basis1,s),(0,Z.g)(s.basis1,s.basis1,a/2),(0,Z.g)(s.basis2,s.basis2,n/2),(0,C.u)(s),s):(D.Z.getLogger("esri.views.3d.analysis.Slice.sliceToolUtils").error("Failed to project slice plane position, projection from ".concat(e.spatialReference.wkid," is not supported")),null)}(e.position,e.heading,e.tilt,e.renderWidth,e.renderHeight,t.renderCoordsHelper,a);return!i.tiltEnabled&&(0,u.pC)(n)&&function(e,t,i){var a=t.worldUpAtPosition(e.origin,Q.WM.get()),n=e.basis1,r=pt(e,a),s=Math.round(r/bt)*bt;(0,C.r)(e,s-r,n,i)}(n,t.renderCoordsHelper,n),n}!function(e){e[e.POSITIVE_X=0]="POSITIVE_X",e[e.POSITIVE_Y=1]="POSITIVE_Y",e[e.NEGATIVE_X=2]="NEGATIVE_X",e[e.NEGATIVE_Y=3]="NEGATIVE_Y"}(He||(He={}));var ft,gt,yt=Xe.jg.Custom1;!function(e){e[e.HEADING=1]="HEADING",e[e.TILT=2]="TILT"}(ft||(ft={})),function(e){e[e.HORIZONTAL_OR_VERTICAL=0]="HORIZONTAL_OR_VERTICAL",e[e.HORIZONTAL=1]="HORIZONTAL",e[e.VERTICAL=2]="VERTICAL",e[e.TILTED=3]="TILTED"}(gt||(gt={}));var wt,_t=Xe.jg.Custom2,mt=(0,U.Ue)(),bt=Math.PI/2,Pt=Xe.jg.Custom1,Dt=Xe.jg.Custom2;function Mt(e){var t="building-scene-3d"===e.type?e:null;return(0,u.pC)(t)}!function(e){e[e.CENTER_ON_CALLOUT=0]="CENTER_ON_CALLOUT",e[e.CENTER_ON_ARROW=1]="CENTER_ON_ARROW"}(wt||(wt={}));var Ct=i(41644);var At="esri.views.3d.analysis.Slice.SliceController",kt=D.Z.getLogger(At),Vt=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._handles=new P.Z,n._internalChange=!1,n._currentSlicePlane=null,n}return(0,n.Z)(i,[{key:"initialize",value:function(){var e=this;this._handles.add(this.analysis.excludedLayers.on("before-add",(function(t){var i=t.item;null!=i&&(i instanceof A.Z||i instanceof k.Z)?i instanceof A.Z&&function(e){switch(e.type){case"building-scene":case"csv":case"dimension":case"feature":case"geo-rss":case"geojson":case"graphics":case"group":case"integrated-mesh":case"kml":case"knowledge-graph":case"link-chart":case"knowledge-graph-sublayer":case"line-of-sight":case"map-notes":case"ogc-feature":case"oriented-imagery":case"point-cloud":case"route":case"scene":case"stream":case"voxel":case"subtype-group":case"unknown":case"unsupported":case"wfs":case null:return!1;case"base-dynamic":case"base-elevation":case"base-tile":case"bing-maps":case"elevation":case"imagery":case"imagery-tile":case"map-image":case"media":case"open-street-map":case"tile":case"vector-tile":case"wcs":case"web-tile":case"wms":case"wmts":return!0;default:return(0,Ct.Bg)(e.type),!1}}(i)?(kt.error("excludedLayers","Layer '".concat(i.title,", id:").concat(i.id,"' of type '").concat(i.type,"' can not be individually excluded from slicing. Use 'excludeGroundSurface' instead.")),t.preventDefault()):e.analysis.excludedLayers.includes(i)&&t.preventDefault():(kt.error("excludedLayers","Invalid layer type, layer must derive from Layer or BuildingComponentSublayer"),t.preventDefault())}))),function(e,t){var i;Tt.has(e)||Tt.set(e,{all:[],activeController:null}),null===(i=Tt.get(e))||void 0===i||i.all.push(t)}(this.view,this),this._handles.add([(0,M.YP)((function(){return e.analysisViewData.plane}),(function(){e._internalChange||e._updateSlicePlaneFromBoundedPlane(),e._updateLayerViews()}),{sync:!0}),(0,M.YP)((function(){return e.analysis.excludeGroundSurface}),(function(){return e._updateLayerViews()}),{sync:!0}),this.analysis.excludedLayers.on("change",(function(){return e._updateLayerViews()})),(0,M.YP)((function(){return[e.analysisViewData.active,e.analysisViewData.visible]}),(function(){e._updateActiveController(),e._updateViewSlicePlane()}),{sync:!0}),(0,M.YP)((function(){return e._allLayerAndSubLayerViews}),(function(){return e._updateLayerViews()}))]),this._handles.add([(0,M.YP)((function(){return e.analysis.shape}),(function(){e._internalChange||(e._updateBoundedPlaneFromSlicePlane(),e._updateViewSlicePlane())}),{sync:!0})],"analysis"),this._updateActiveController(),this._updateBoundedPlaneFromSlicePlane(),this._updateViewSlicePlane()}},{key:"destroy",value:function(){this.analysisViewData.active&&(this.analysisViewData.active=!1,this.view.slicePlane=null),function(e,t){var i;if(!Tt.has(e))throw new Error("view expected in global slice register");var a=Tt.get(e),n=null!==(i=null===a||void 0===a?void 0:a.all.lastIndexOf(t))&&void 0!==i?i:-1;if(!a||-1===n)throw new Error("controller expected in global slice register");a.all.splice(n,1),0===a.all.length&&Tt.delete(e)}(this.view,this),this._handles.destroy(),this.set("view",null)}},{key:"_allLayerAndSubLayerViews",get:function(){var e=this.view.allLayerViews.items;return e.concat(e.filter(Mt).flatMap((function(e){return e.sublayerViews.items})))}},{key:"_updateBoundedPlaneFromSlicePlane",value:function(){var e=this.analysis.shape,t=this._currentSlicePlane;if(!((0,u.Wi)(t)&&(0,u.Wi)(e)||(0,u.pC)(t)&&(0,u.pC)(e)&&e.equals(t))){var i=null,a=null;if((0,u.pC)(e)&&(0,u.pC)(e.position)){var n=e.position.spatialReference,r=ht(e,this.view);(0,u.Wi)(r)&&(0,he.e)(this.analysis,n,kt),i=vt(r,this.view,{tiltEnabled:this.analysis.tiltEnabled},(0,C.a)()),(0,u.pC)(i)&&(a={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height})}this._currentSlicePlane=a,this._internalChange=!0,this.analysisViewData.plane=i,this._internalChange=!1}}},{key:"_updateSlicePlaneFromBoundedPlane",value:function(){var e=dt(this.analysisViewData.plane,this.view,this.view.spatialReference,new b),t=null;(0,u.pC)(e)&&(t={heading:e.heading,tilt:e.tilt,position:e.position,width:e.width,height:e.height}),this._currentSlicePlane=t,this._internalChange=!0,this.analysis.shape=e,this._internalChange=!1,this._updateViewSlicePlane()}},{key:"_updateActiveController",value:function(){if(!Et){var e=It(this.view);if(e)if(this.analysisViewData.active)(0,u.pC)(e.activeController)&&e.activeController!==this?(Et=!0,e.activeController.analysisViewData.active=!1,Et=!1):(0,u.pC)(e.activeController)&&e.activeController,this._updateLayerViews(),e.activeController=this;else{if((0,u.pC)(e.activeController)&&e.activeController!==this)return;(0,u.pC)(e.activeController)&&e.activeController===this&&(e.activeController=null,this._updateLayerViews())}}}},{key:"_updateViewSlicePlane",value:function(){!function(e){var t,i=null===(t=It(e))||void 0===t?void 0:t.activeController;(0,u.pC)(i)&&(0,u.pC)(i.analysisViewData.plane)&&i.analysisViewData.visible?e.slicePlane=i.analysisViewData.plane:e.slicePlane=null}(this.view)}},{key:"_updateLayerViews",value:function(){var e=(0,u.pC)(this.analysisViewData.plane)&&this.analysisViewData.visible&&this.analysisViewData.active,t=[];this.analysis.excludedLayers.forEach((function e(i){"layers"in i?i.layers.forEach(e):t.push(i)})),this.view.allLayerViews.forEach((function(i){i.destroyed||("slicePlaneEnabled"in i&&(i.slicePlaneEnabled=e&&!t.includes(i.layer)),"sublayerViews"in i&&i.sublayerViews.forEach((function(i){i.slicePlaneEnabled=e&&!t.includes(i.sublayer)})))})),null!=this.view.basemapTerrain&&(this.view.basemapTerrain.slicePlaneEnabled=e&&!this.analysis.excludeGroundSurface)}}]),i}(l.Z);(0,o._)([(0,c.Cb)()],Vt.prototype,"view",void 0),(0,o._)([(0,c.Cb)()],Vt.prototype,"analysis",void 0),(0,o._)([(0,c.Cb)()],Vt.prototype,"analysisViewData",void 0),(0,o._)([(0,c.Cb)()],Vt.prototype,"_allLayerAndSubLayerViews",null),Vt=(0,o._)([(0,p.j)(At)],Vt);var Tt=new Map,Et=!1;function It(e){return Tt.get(e)}var St,Wt=i(84702),Ot=i(99346),xt=i(96664),Rt=i(51328),Zt=i(88153),Lt=i(54463),Ht=i(76365),Nt=i(5693),zt=i(72612),Ut=St=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._clock=Wt.m,n._previewPlaneOpacity=1,n.removeIncompleteOnCancel=!1,n.layersMode="none",n.shiftManipulator=null,n.rotateHeadingManipulator=null,n.rotateTiltManipulator=null,n.resizeManipulators=null,n._handles=new P.Z,n._viewHandles=new P.Z,n._frameTask=null,n._pointerMoveTimerMs=2500,n._prevPointerMoveTimeout=null,n._previewPlaneGridVisualElement=null,n._previewPlaneOutlineVisualElement=null,n._startPlane=(0,C.a)(),n._previewPlane=null,n._activeKeyModifiers={},n._lastCursorPosition=(0,W.vW)(),n._resizeHandles=[{direction:[1,0]},{direction:[1,1]},{direction:[0,1]},{direction:[-1,1]},{direction:[-1,0]},{direction:[-1,-1]},{direction:[0,-1]},{direction:[1,-1]}],n._intersector=(0,Zt.Z8)(e.view.state.viewingMode),n._intersector.options.store=Lt.eC.MIN,n}return(0,n.Z)(i,[{key:"initialize",value:function(){var e=this;if(null==this.analysis)throw new Error("SliceTool requires valid analysis, but null was provided.");this._rotateHeadingImage=(0,xt.O)(this.view.toolViewManager.textures),this._rotateTiltImage=(0,xt.s)(this.view.toolViewManager.textures);var t=function(t){e._updateManipulatorsInteractive(t),t.grabbing||((0,u.pC)(e.analysisViewData.plane)&&(0,C.c)(e.analysisViewData.plane,e._startPlane),e.inputState=null)};this.shiftManipulator=st(this.view),this.manipulators.add(this.shiftManipulator),this.shiftManipulator.events.on("grab-changed",(function(i){e._onShiftGrab(i),t(e.shiftManipulator)})),this._handles.add(this._createShiftDragPipeline(this.shiftManipulator)),this.rotateHeadingManipulator=ot(this.view,this._rotateHeadingImage.texture),this.manipulators.add(this.rotateHeadingManipulator),this.rotateHeadingManipulator.events.on("grab-changed",(function(i){e._onRotateHeadingGrab(i),t(e.rotateHeadingManipulator)})),this._handles.add(this._createRotateHeadingDragPipeline(this.rotateHeadingManipulator)),this.rotateTiltManipulator=ot(this.view,this._rotateTiltImage.texture),this.manipulators.add(this.rotateTiltManipulator),this.rotateTiltManipulator.events.on("grab-changed",(function(i){e._onRotateTiltGrab(i),t(e.rotateTiltManipulator)})),this._handles.add(this._createRotateTiltDragPipeline(this.rotateTiltManipulator)),this.resizeManipulators=this._resizeHandles.map((function(i,a){var n=ct(e.view,i);return n.events.on("grab-changed",(function(i){e._onResizeGrab(i,a),t(n)})),e._handles.add(e._createResizeDragPipeline(n)),n})),this.manipulators.addMany(this.resizeManipulators),this._previewPlaneGridVisualElement=ut(this.view),this._previewPlaneOutlineVisualElement=lt(this.view),this._previewPlaneOutlineVisualElement.width=2,this._handles.add((0,M.YP)((function(){return e.analysisViewData.plane}),(function(){return e._updateManipulators()}),M.Z_));var i=(0,M.YP)((function(){return e.state}),(function(t){"sliced"===t&&e.finishToolCreation()}),M.tX);this._handles.add([i,(0,M.YP)((function(){return e.view.state.camera}),(function(){return e._onCameraChange()}))])}},{key:"destroy",value:function(){this._rotateHeadingImage=(0,u.RY)(this._rotateHeadingImage),this._rotateTiltImage=(0,u.RY)(this._rotateTiltImage),this._handles=(0,u.SC)(this._handles),this._viewHandles=(0,u.SC)(this._viewHandles),this._removeFrameTask(),this._clearPointerMoveTimeout(),this._previewPlaneOutlineVisualElement=(0,u.SC)(this._previewPlaneOutlineVisualElement),this._previewPlaneGridVisualElement=(0,u.SC)(this._previewPlaneGridVisualElement)}},{key:"state",get:function(){var e=!!this.analysisViewData.plane,t=!!this.inputState;return e?e&&t?"slicing":e&&!t?"sliced":"ready":"ready"}},{key:"cursor",get:function(){return this._isPlacingSlicePlane||"exclude"===this.layersMode?"crosshair":(0,u.pC)(this._creatingPointerId)?"grabbing":null}},{key:"analysis",set:function(e){if(null==e)throw new Error("SliceTool requires valid analysis, but null was provided.");this._handles.remove("analysis"),this._set("analysis",e)}},{key:"inputState",get:function(){return this._get("inputState")},set:function(e){this._set("inputState",e),this.analysisViewData.showGrid=(0,u.pC)(e)&&"resize"===e.type,this._updateMaterials()}},{key:"_isPlacingSlicePlane",get:function(){return!this.inputState&&!this.analysisViewData.plane&&this.active}},{key:"_creatingPointerId",get:function(){return(0,u.pC)(this.inputState)&&"shift"===this.inputState.type?this.inputState.creatingPointerId:null}},{key:"enterExcludeLayerMode",value:function(){(0,u.Wi)(this.analysisViewData.plane)||(this._set("layersMode","exclude"),this.active||(this.view.activeTool=this))}},{key:"exitExcludeLayerMode",value:function(){(0,u.Wi)(this.analysisViewData.plane)||(this._set("layersMode","none"),this.active&&(this.view.activeTool=null))}},{key:"onDeactivate",value:function(){this._set("layersMode","none"),this._updatePreviewPlane(null)}},{key:"onShow",value:function(){this._updateVisibility(!0)}},{key:"onHide",value:function(){this._updateVisibility(!1)}},{key:"_updateVisibility",value:function(e){this._updateManipulators(),e||this._clearPointerMoveTimeout()}},{key:"onInputEvent",value:function(e){switch(e.type){case"pointer-drag":if(!Qt(e))return;this._isPlacingSlicePlane?this._onClickPlacePlane(e)&&e.stopPropagation():this._onPointerDrag(e)&&e.stopPropagation();break;case"pointer-move":this._onPointerMove(e);break;case"pointer-up":this._onPointerUp(e)&&e.stopPropagation();break;case"immediate-click":if(!Qt(e))return;this._onClickPlacePlane(e)&&e.stopPropagation();break;case"click":if(!Qt(e))return;this._onClickExcludeLayer(e)&&e.stopPropagation();break;case"drag":this.inputState&&e.stopPropagation();break;case"key-down":this._onKeyDown(e)&&e.stopPropagation();break;case"key-up":this._onKeyUp(e)&&e.stopPropagation()}}},{key:"onEditableChange",value:function(){this.analysisViewData.editable=this.internallyEditable}},{key:"_onPointerDrag",value:function(e){var t=this.inputState;if(e.pointerId===this._creatingPointerId&&(0,u.pC)(t)&&"shift"===t.type){var i=(0,zt.vT)(e);return this.shiftManipulator.events.emit("drag",{action:t.hasBeenDragged?"update":"start",pointerType:e.pointerType,start:i,screenPoint:i}),t.hasBeenDragged=!0,!0}return!1}},{key:"_onPointerMove",value:function(e){this._lastCursorPosition.x=e.x,this._lastCursorPosition.y=e.y,this._resetPointerMoveTimeout(),"touch"!==e.pointerType&&this._updatePreviewPlane((0,zt.vT)(e),this._activeKeyModifiers)}},{key:"_onCameraChange",value:function(){this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),this._updateManipulators()}},{key:"_onPointerUp",value:function(e){if(e.pointerId===this._creatingPointerId&&(0,u.pC)(this.analysisViewData.plane)){var t=(0,zt.vT)(e);return this.shiftManipulator.events.emit("drag",{action:"end",start:t,screenPoint:t}),(0,C.c)(this.analysisViewData.plane,this._startPlane),this.inputState=null,!0}return!1}},{key:"_onClickPlacePlane",value:function(e){if("exclude"===this.layersMode)return!1;if(this._isPlacingSlicePlane){var t=(0,zt.vT)(e),i=(0,C.a)();if(this._pickPlane(t,!1,this._activeKeyModifiers,i)){if((0,C.c)(i,this._startPlane),this.analysis.shape=dt(i,this.view,this.view.spatialReference,new b),"pointer-drag"===e.type){var a=this._calculatePickRay(t);this.inputState=Gt(a,e.pointerId,i.origin,i)}return!0}}return!1}},{key:"_onClickExcludeLayer",value:function(e){var t=this;return!("exclude"!==this.layersMode||!this.created)&&(this.view.hitTest((0,zt.vT)(e)).then((function(e){if(e.results.length){var i=e.results[0],a="graphic"===(null===i||void 0===i?void 0:i.type)&&i.graphic;if(a){var n=a.sourceLayer||a.layer;n&&t.analysis.excludedLayers.push(n)}}else e.ground.layer?t.analysis.excludedLayers.push(e.ground.layer):t.analysis.excludeGroundSurface=!0})),this._set("layersMode","none"),this.active&&(this.view.activeTool=null),!0)}},{key:"_onKeyDown",value:function(e){return(e.key===F||e.key===j)&&(this._activeKeyModifiers[e.key]=!0,(0,u.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}},{key:"_onKeyUp",value:function(e){return!(e.key!==F&&e.key!==j||!this._activeKeyModifiers[e.key])&&(delete this._activeKeyModifiers[e.key],(0,u.pC)(this._previewPlane)&&this._updatePreviewPlane(this._lastCursorPosition,this._activeKeyModifiers),!0)}},{key:"_onShiftGrab",value:function(e){if("start"===e.action&&!(0,u.Wi)(this.analysisViewData.plane)&&e.screenPoint){var t=this._calculatePickRay(e.screenPoint);(0,C.c)(this.analysisViewData.plane,this._startPlane),this.inputState=Gt(t,null,this.shiftManipulator.renderLocation,this.analysisViewData.plane)}}},{key:"_createShiftDragPipeline",value:function(e){var t=this;return(0,Nt.Xd)(e,(function(e,i,a){var n=t.inputState;if(!(0,u.Wi)(n)&&"shift"===n.type){var r=(0,u.pC)(t.analysisViewData.plane)?(0,C.c)(t.analysisViewData.plane,(0,C.a)()):null;i.next((0,Rt._N)(t.view,n.shiftPlane)).next(t._shiftDragAdjustSensitivity(n)).next(t._shiftDragUpdatePlane(n)),a.next((function(){(0,u.pC)(r)&&t._updateBoundedPlane(r)}))}}))}},{key:"_shiftDragAdjustSensitivity",value:function(e){var t=this;return function(i){if((0,u.Wi)(t.analysisViewData.plane))return null;var a=Math.min((1-Math.abs((0,Z.e)((0,C.n)(t.analysisViewData.plane),i.ray.direction)/(0,Z.l)(i.ray.direction)))/.001,1),n=-(0,z.jH)(t._startPlane.plane,i.renderEnd),r=-(0,z.jH)(t._startPlane.plane,e.startPoint);return e.depth=e.depth*(1-a)+n*a-r,i}}},{key:"_shiftDragUpdatePlane",value:function(e){var t=this;return function(){if(!(0,u.Wi)(t.analysisViewData.plane)){var i=(0,Z.c)(Q.WM.get(),t._startPlane.origin),a=(0,Z.c)(Q.WM.get(),(0,C.n)(t._startPlane));(0,Z.g)(a,a,-e.depth),(0,Z.a)(a,a,i);var n=(0,C.f)(a,t.analysisViewData.plane.basis1,t.analysisViewData.plane.basis2,(0,C.a)());t._updateBoundedPlane(n)}}}},{key:"_onRotateHeadingGrab",value:function(e){if("start"===e.action&&!(0,u.Wi)(this.analysisViewData.plane)&&e.screenPoint){var t=$e(this.analysisViewData.plane,this.view.renderCoordsHelper,ft.HEADING,(0,z.Ue)()),i=this._calculatePickRay(e.screenPoint),a=(0,L.c)();(0,z.BR)(t,i,a)&&((0,C.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}}},{key:"_createRotateHeadingDragPipeline",value:function(e){var t=this;return(0,Nt.Xd)(e,(function(e,i,a){var n=t.inputState;if(!(0,u.Wi)(n)&&"rotate"===n.type){var r=(0,u.pC)(t.analysisViewData.plane)?(0,C.c)(t.analysisViewData.plane,(0,C.a)()):null;i.next((0,Rt._N)(t.view,n.rotatePlane)).next(t._rotateDragRenderPlaneToRotate(n)).next(t._rotateDragUpdatePlaneFromRotate()),a.next((function(){(0,u.pC)(r)&&t._updateBoundedPlane(r)}))}}))}},{key:"_onRotateTiltGrab",value:function(e){if("start"===e.action&&!(0,u.Wi)(this.analysisViewData.plane)&&e.screenPoint){var t=$e(this.analysisViewData.plane,this.view.renderCoordsHelper,ft.TILT,(0,z.Ue)()),i=this._calculatePickRay(e.screenPoint),a=(0,L.c)();(0,z.BR)(t,i,a)&&((0,C.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"rotate",rotatePlane:t,startPoint:a})}}},{key:"_createRotateTiltDragPipeline",value:function(e){var t=this;return(0,Nt.Xd)(e,(function(e,i,a){var n=t.inputState;if(!(0,u.Wi)(n)&&"rotate"===n.type){var r=(0,u.pC)(t.analysisViewData.plane)?(0,C.c)(t.analysisViewData.plane,(0,C.a)()):null;i.next((0,Rt._N)(t.view,n.rotatePlane)).next(t._rotateDragRenderPlaneToRotate(n)).next(t._rotateDragUpdatePlaneFromRotate()),a.next((function(){(0,u.pC)(r)&&t._updateBoundedPlane(r)}))}}))}},{key:"_rotateDragRenderPlaneToRotate",value:function(e){var t=this;return function(i){if((0,u.Wi)(t.analysisViewData.plane))return null;var a=(0,z.mJ)(e.rotatePlane),n=(0,fe.Gd)(e.startPoint,i.renderEnd,t.analysisViewData.plane.origin,a);return(0,V.Z)((0,V.Z)({},i),{},{rotateAxis:a,rotateAngle:n})}}},{key:"_rotateDragUpdatePlaneFromRotate",value:function(){var e=this;return function(t){if(!(0,u.Wi)(e.analysisViewData.plane)){var i=(0,O.d)(Q.MP.get(),t.rotateAngle,t.rotateAxis);if(!(0,u.Wi)(i)){var a=(0,Z.m)(Q.WM.get(),e._startPlane.basis1,i),n=(0,Z.m)(Q.WM.get(),e._startPlane.basis2,i),r=(0,C.f)(e.analysisViewData.plane.origin,a,n,(0,C.a)());e._updateBoundedPlane(r)}}}}},{key:"_onResizeGrab",value:function(e,t){if("start"===e.action&&!(0,u.Wi)(this.analysisViewData.plane)&&e.screenPoint){var i=this._calculatePickRay(e.screenPoint),a=Q.WM.get();(0,z.BR)(this.analysisViewData.plane.plane,i,a)&&((0,C.c)(this.analysisViewData.plane,this._startPlane),this.inputState={type:"resize",activeHandleIdx:t,startPoint:(0,L.a)(a)})}}},{key:"_createResizeDragPipeline",value:function(e){var t=this;return(0,Nt.Xd)(e,(function(e,i,a){var n=t.inputState;if(!(0,u.Wi)(n)&&"resize"===n.type&&!(0,u.Wi)(t.analysisViewData.plane)){var r=(0,C.c)(t.analysisViewData.plane,(0,C.a)());i.next((0,Rt._N)(t.view,t.analysisViewData.plane.plane)).next(t._resizeDragUpdatePlane(n)),a.next((function(){t._updateBoundedPlane(r)}))}}))}},{key:"_resizeDragUpdatePlane",value:function(e){var t=this;return function(i){if(!(0,u.Wi)(t.analysisViewData.plane)){var a=function(e,t,i,a,n,r){var s=(0,Z.c)(Q.WM.get(),n.origin);(0,Z.a)(s,s,(0,Z.g)(Q.WM.get(),n.basis1,e.direction[0]<0?1:-1)),(0,Z.a)(s,s,(0,Z.g)(Q.WM.get(),n.basis2,e.direction[1]<0?1:-1));var o=(0,Z.l)(n.basis1),l=(0,Z.l)(n.basis2),u=(0,Z.b)(Q.WM.get(),i,s),c=(0,Z.b)(Q.WM.get(),t,s),d=0,p=0;if(rt(e)){var h=nt(n),v=nt(r);d=o-.5*e.direction[0]*(0,Z.e)(n.basis1,c)/o,p=l-.5*e.direction[1]*(0,Z.e)(n.basis2,c)/l;var f=v/h;d*=f,p*=f}var g=d+.5*e.direction[0]*(0,Z.e)(n.basis1,u)/o,y=p+.5*e.direction[1]*(0,Z.e)(n.basis2,u)/l,w=(0,Z.g)(Q.WM.get(),n.basis1,g/o),_=(0,Z.g)(Q.WM.get(),n.basis2,y/l);(g<=0||it(r.origin,w,a)<=1600)&&(0,Z.c)(w,r.basis1),(y<=0||it(r.origin,_,a)<=1600)&&(0,Z.c)(_,r.basis2);var m=(0,Z.c)(Q.WM.get(),s);return(0,Z.a)(m,m,(0,Z.g)(Q.WM.get(),w,e.direction[0]<0?-1:1)),(0,Z.a)(m,m,(0,Z.g)(Q.WM.get(),_,e.direction[1]<0?-1:1)),(0,C.f)(m,w,_,r)}(t._resizeHandles[e.activeHandleIdx],e.startPoint,i.renderEnd,t.view.state.camera,t._startPlane,(0,C.c)(t.analysisViewData.plane));t._updateBoundedPlane(a)}}}},{key:"_updateBoundedPlane",value:function(e){var t=this.analysisViewData;if(!(0,u.pC)(t))throw new Error("valid internal object expected");t.plane=e}},{key:"_updatePreviewPlane",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=this._previewPlane;if(this._previewPlane=null,(0,u.Wi)(e))return this._removeFrameTask(),void this._updateManipulators();if(!this.analysisViewData.plane&&this.active){var n=(0,u.pC)(a)?a:(0,C.a)();if(a=(0,u.pC)(a)?(0,C.c)(a,Bt):null,this._pickPlane(e,!0,i,n)){var r=!1;(0,u.pC)(a)&&(r=(0,Z.e)(a.plane,n.plane)<.95||(0,Z.e)((0,Z.n)(Q.WM.get(),a.basis1),(0,Z.n)(Q.WM.get(),n.basis1))<.95),r&&(this._previewPlaneOpacity=0),this._previewPlane=n}}(0,u.pC)(this._previewPlane)&&(0,u.Wi)(this._frameTask)&&0===this._previewPlaneOpacity?this._frameTask=(0,Ot.A)({update:function(e){var i=e.deltaTime;t._previewPlaneOpacity=Math.min(t._previewPlaneOpacity+i/300,1),t._updateManipulators(),1===t._previewPlaneOpacity&&t._removeFrameTask()}}):(0,u.Wi)(this._previewPlane)&&(0,u.pC)(this._frameTask)?this._removeFrameTask():(0,u.pC)(this._previewPlane)&&this._updateManipulators()}},{key:"_removeFrameTask",value:function(){this._frameTask=(0,u.hw)(this._frameTask)}},{key:"_calculatePickRay",value:function(e){var t=(0,U.Ue)(),i=(0,W.md)(e,jt);return(0,Be.u4)(this.view.state.camera,i,t),(0,Z.n)(t.direction,t.direction),t}},{key:"_pickMinResult",value:function(e){var t=(0,W.md)(e,Q.qW.get());return this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector),this._intersector.results.min}},{key:"_pickPlane",value:function(e,t,i,a){var n=this._pickMinResult(e),r=Q.WM.get();if(!n.getIntersectionPoint(r))return!1;var s=n.getTransformedNormal(Q.WM.get()),o=this.view.state.camera;(0,Z.e)(s,o.viewForward)>0&&(0,Z.g)(s,s,-1);var l=function(e,t){return.4*Math.min(t.width,t.height)*t.computeRenderPixelSizeAt(e)}(r,o),u=(t?1:-1)*l*.02,c=(0,Z.g)(Q.WM.get(),s,u);(0,Z.a)(c,c,r);var d=this.analysis.tiltEnabled?gt.TILTED:gt.HORIZONTAL_OR_VERTICAL;return Ke(c,s,l,l,o,i[F]?gt.VERTICAL:i[j]?gt.HORIZONTAL:d,this.view.renderCoordsHelper,a),!0}},{key:"_clearPointerMoveTimeout",value:function(){this._prevPointerMoveTimeout=(0,u.hw)(this._prevPointerMoveTimeout)}},{key:"_resetPointerMoveTimeout",value:function(){var e=this;this._clearPointerMoveTimeout(),this.shiftManipulator.state|=yt,this.rotateHeadingManipulator.state|=yt,this.rotateTiltManipulator.state|=yt,this._prevPointerMoveTimeout=this._clock.setTimeout((function(){e.shiftManipulator.state&=~yt,e.rotateHeadingManipulator.state&=~yt,e.rotateTiltManipulator.state&=~yt}),this._pointerMoveTimerMs)}},{key:"_updateManipulators",value:function(){var e=this;if(!St.disableEngineLayers){var t,i=!1;if((0,u.pC)(this.analysisViewData.plane))t=this.analysisViewData.plane,i=!1;else{if(!(0,u.pC)(this._previewPlane))return this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((function(e){return e.available=!1})),this._previewPlaneOutlineVisualElement.visible=!1,void(this._previewPlaneGridVisualElement.visible=!1);t=this._previewPlane,i=!0}var a=Je(t,Q.MP.get());i?(this.shiftManipulator.available=!1,this.rotateHeadingManipulator.available=!1,this.rotateTiltManipulator.available=!1,this.resizeManipulators.forEach((function(e){return e.available=!1})),this._previewPlaneOutlineVisualElement.attached=!0,this._previewPlaneGridVisualElement.attached=!0,this._previewPlaneOutlineVisualElement.visible=!0,this._previewPlaneGridVisualElement.visible=!0):(this.shiftManipulator.available=!0,this.rotateHeadingManipulator.available=!0,this.rotateTiltManipulator.available=this.analysis.tiltEnabled,this.resizeManipulators.forEach((function(e){return e.available=!0})),et(this.shiftManipulator,a,t,this.view.state.camera),function(e,t,i,a){var n=a.worldUpAtPosition(i.origin,Q.WM.get()),r=tt(i,He.POSITIVE_X),s=(0,O.b)(Q.MP.get(),r.edge*Math.PI/2);(0,O.r)(s,s,-pt(i,n)),(0,O.m)(s,t,s),s[12]=0,s[13]=0,s[14]=0,e.modelTransform=s,e.renderLocation=r.position}(this.rotateHeadingManipulator,a,t,this.view.renderCoordsHelper),function(e,t,i){var a=tt(i,He.POSITIVE_Y),n=(0,O.b)(Q.MP.get(),a.edge*Math.PI/2);(0,O.r)(n,n,bt),(0,O.m)(n,t,n),n[12]=0,n[13]=0,n[14]=0,e.modelTransform=n,e.renderLocation=a.position}(this.rotateTiltManipulator,a,t),this.resizeManipulators.forEach((function(i,n){return function(e,t,i,a){var n=(0,Z.l)(a.basis1),r=(0,Z.l)(a.basis2),s=at(a),o=nt(a),l=(0,Z.s)(Q.WM.get(),0,0,0);(0,Z.a)(l,(0,Z.g)(Q.WM.get(),a.basis1,t.direction[0]),(0,Z.g)(Q.WM.get(),a.basis2,t.direction[1])),(0,Z.a)(l,a.origin,l);var u=0,c=1;if(rt(t))1===t.direction[0]&&-1===t.direction[1]?u=bt:1===t.direction[0]&&1===t.direction[1]?u=Math.PI:-1===t.direction[0]&&1===t.direction[1]&&(u=3*Math.PI/2),c=o;else{var d=0!==t.direction[0]?1:2;u=1===d?bt:0,c=(1===d?r:n)-s}var p=(0,O.b)(Q.MP.get(),u);(0,O.k)(p,p,(0,Z.s)(Q.WM.get(),c,c,c)),(0,O.m)(p,i,p),p[12]=0,p[13]=0,p[14]=0,e.modelTransform=p,e.renderLocation=l}(i,e._resizeHandles[n],a,t)})),this._previewPlaneOutlineVisualElement.visible=!1,this._previewPlaneGridVisualElement.visible=!1);var n=(0,Z.s)(Q.WM.get(),(0,Z.l)(t.basis1),(0,Z.l)(t.basis2),1),r=(0,O.E)(Q.MP.get(),n),s=(0,O.m)(r,a,r);this._previewPlaneOutlineVisualElement.transform=s,this._previewPlaneGridVisualElement.transform=s,this._updateMaterials()}}},{key:"_updateMaterials",value:function(){var e=[ee[0],ee[1],ee[2],ee[3]*this._previewPlaneOpacity];this._previewPlaneOutlineVisualElement.color=e;var t=[te[0],te[1],te[2],te[3]*this._previewPlaneOpacity];this._previewPlaneGridVisualElement.backgroundColor=t,this._previewPlaneGridVisualElement.gridColor=[0,0,0,0]}},{key:"_updateManipulatorsInteractive",value:function(e){if(!e.grabbing)return this.shiftManipulator.interactive=!0,this.rotateHeadingManipulator.interactive=!0,this.rotateTiltManipulator.interactive=!0,void this.resizeManipulators.forEach((function(e){e.interactive=!0}));this.shiftManipulator.interactive=this.shiftManipulator===e,this.rotateHeadingManipulator.interactive=this.rotateHeadingManipulator===e,this.rotateTiltManipulator.interactive=this.rotateTiltManipulator===e,this.resizeManipulators.forEach((function(t){t.interactive=t===e}))}},{key:"testData",value:function(){var e=this;return{plane:this.analysisViewData.plane,setPointerMoveTimerMs:function(t){e._pointerMoveTimerMs=t}}}}]),i}(Ht.f);function Gt(e,t,i,a){var n=function(e,t,i,a){var n=(0,Z.f)(Q.WM.get(),t,i);return(0,Z.f)(n,n,t),(0,z.Yq)(e,n,a)}(i,(0,C.n)(a),e.direction,(0,z.Ue)()),r=(0,L.c)();return(0,z.BR)(n,e,r)?{type:"shift",creatingPointerId:t,hasBeenDragged:!1,shiftPlane:n,depth:0,startPoint:r}:null}function Qt(e){return"mouse"!==e.pointerType||0===e.button}Ut.disableEngineLayers=!1,(0,o._)([(0,c.Cb)()],Ut.prototype,"_clock",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0})],Ut.prototype,"view",void 0),(0,o._)([(0,c.Cb)()],Ut.prototype,"analysisViewData",void 0),(0,o._)([(0,c.Cb)({readOnly:!0})],Ut.prototype,"state",null),(0,o._)([(0,c.Cb)({readOnly:!0})],Ut.prototype,"cursor",null),(0,o._)([(0,c.Cb)()],Ut.prototype,"analysis",null),(0,o._)([(0,c.Cb)()],Ut.prototype,"removeIncompleteOnCancel",void 0),(0,o._)([(0,c.Cb)({readOnly:!0})],Ut.prototype,"layersMode",void 0),(0,o._)([(0,c.Cb)({value:null})],Ut.prototype,"inputState",null),(0,o._)([(0,c.Cb)()],Ut.prototype,"_isPlacingSlicePlane",null),(0,o._)([(0,c.Cb)()],Ut.prototype,"_creatingPointerId",null),Ut=St=(0,o._)([(0,p.j)("esri.views.3d.analysis.Slice.SliceTool")],Ut);var Bt=(0,C.a)(),jt=(0,W.s1)(),Ft=Ut,Yt=i(86700),qt=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e))._handles=new P.Z,n._gridVisualElement=null,n._outlineVisualElement=null,n.showGrid=!1,n.preview=!0,n}return(0,n.Z)(i,[{key:"initialize",value:function(){var e=this,t=this.analysisViewData;if((0,u.Wi)(t))throw new Error("expected internal object to be valid");this._gridVisualElement=ut(this.view),this._outlineVisualElement=lt(this.view),this._handles.add([(0,M.YP)((function(){return{visible:(0,u.pC)(t.plane)&&e.analysisViewData.visible,active:e.analysisViewData.active,preview:e.preview,showGrid:e.showGrid}}),(function(t){return e._updateMaterials(t)}),M.tX),(0,M.YP)((function(){return t.plane}),(function(t){return e._updatePlane(t)}),M.tX)],"internal")}},{key:"destroy",value:function(){this._handles.destroy(),this._gridVisualElement=(0,u.SC)(this._gridVisualElement),this._outlineVisualElement=(0,u.SC)(this._outlineVisualElement),this.set("view",null)}},{key:"_updatePlane",value:function(e){if(!(0,u.Wi)(e)){this._gridVisualElement.attached=!0,this._outlineVisualElement.attached=!0;var t=(0,Z.s)(Q.WM.get(),(0,Z.l)(e.basis1),(0,Z.l)(e.basis2),1),i=(0,O.E)(Q.MP.get(),t),a=Je(e,Q.MP.get()),n=(0,O.m)(i,a,i);this._outlineVisualElement.transform=n,this._gridVisualElement.transform=n}}},{key:"_updateMaterials",value:function(e){var t=e.visible,i=e.active,a=e.preview,n=e.showGrid;this._outlineVisualElement.color=ee,this._outlineVisualElement.width=a?2:$,this._outlineVisualElement.stipplePattern=i?null:(0,Yt.z5)(5),this._gridVisualElement.backgroundColor=te,this._gridVisualElement.gridColor=n?ie:B.Z,this._gridVisualElement.visible=t,this._outlineVisualElement.visible=t}}]),i}(l.Z);(0,o._)([(0,c.Cb)()],qt.prototype,"view",void 0),(0,o._)([(0,c.Cb)()],qt.prototype,"analysis",void 0),(0,o._)([(0,c.Cb)()],qt.prototype,"analysisViewData",void 0),(0,o._)([(0,c.Cb)()],qt.prototype,"showGrid",void 0),(0,o._)([(0,c.Cb)()],qt.prototype,"preview",void 0),qt=(0,o._)([(0,p.j)("esri.views.3d.analysis.Slice.SliceVisualization")],qt);var Xt=i(70209),Kt=function(e){(0,r.Z)(i,e);var t=(0,s.Z)(i);function i(e){var n;return(0,a.Z)(this,i),(n=t.call(this,e)).type="slice-view-3d",n.analysis=null,n.tool=null,n.analysisVisualization=null,n.analysisController=null,n.plane=null,n.active=!0,n}return(0,n.Z)(i,[{key:"initialize",value:function(){this.analysisVisualization=new qt({view:this.view,analysis:this.analysis,analysisViewData:this}),this.analysisController=new Vt({view:this.view,analysis:this.analysis,analysisViewData:this}),this.addHandles((0,Xt.Lp)(this,Ft))}},{key:"destroy",value:function(){(0,Xt.Yq)(this),this.analysisVisualization=(0,u.SC)(this.analysisVisualization),this.analysisController=(0,u.SC)(this.analysisController)}},{key:"showGrid",get:function(){var e,t;return null!==(e=null===(t=this.analysisVisualization)||void 0===t?void 0:t.showGrid)&&void 0!==e&&e},set:function(e){this.analysisVisualization&&(this.analysisVisualization.showGrid=e)}},{key:"editable",get:function(){return!this.analysisVisualization.preview},set:function(e){this.analysisVisualization.preview=!e}},{key:"testData",get:function(){return{visualization:this.analysisVisualization,controller:this.analysisController,tool:(0,u.Wg)(this.tool)}}}]),i}((0,h.p)(l.Z));(0,o._)([(0,c.Cb)({readOnly:!0})],Kt.prototype,"type",void 0),(0,o._)([(0,c.Cb)({constructOnly:!0,nonNullable:!0})],Kt.prototype,"analysis",void 0),(0,o._)([(0,c.Cb)()],Kt.prototype,"tool",void 0),(0,o._)([(0,c.Cb)()],Kt.prototype,"plane",void 0),(0,o._)([(0,c.Cb)()],Kt.prototype,"active",void 0),(0,o._)([(0,c.Cb)()],Kt.prototype,"showGrid",null),(0,o._)([(0,c.Cb)()],Kt.prototype,"editable",null);var Jt=Kt=(0,o._)([(0,p.j)("esri.views.3d.analysis.SliceAnalysisView3D")],Kt)},51328:function(e,t,i){i.d(t,{J4:function(){return y},_N:function(){return f},gv:function(){return w}});var a,n=i(1413),r=i(92026),s=i(17842),o=(i(11186),i(71353)),l=(i(79803),i(55652)),u=i(40885),c=(i(40927),i(51378)),d=(i(74509),i(81703)),p=i(88153),h=i(54463),v=i(76783);i(5693);function f(e,t){return g(e,(function(){return t}))}function g(e,t){var i=(0,o.c)(),a=(0,o.c)(),u=!1;return function(o){var p=t(o);if("start"===o.action){var h=(0,s.md)(o.screenStart,(0,s.c$)(c.qW.get())),v=(0,d.u4)(e.state.camera,h,_);(0,r.pC)(v)&&(u=(0,l.BR)(p,v,i))}if(!u)return null;var f=(0,s.md)(o.screenEnd,(0,s.c$)(c.qW.get())),g=(0,d.u4)(e.state.camera,f,_);return(0,r.Wi)(g)?null:(0,l.BR)(p,g,a)?(0,n.Z)((0,n.Z)({},o),{},{renderStart:i,renderEnd:a,plane:p,ray:g}):null}}function y(e){var t=null;return function(i){switch(i.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,r.pC)(t)&&(t.remove(),t=null)}return i}}function w(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=(0,p.Z8)(e.state.viewingMode);i.options.selectionMode=!0,i.options.store=h.eC.MIN,i.options.hud=!1;var l,u=(0,s.s1)(),c={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},d=(0,o.c)(),f=(0,r.Pt)(t,e.spatialReference),g=function(t){e.map.ground&&e.map.ground.opacity<1?c.exclude.add(v.cy):c.exclude.delete(v.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,s.md)(t,u),i,c);var n,r=i.results.min;if(r.getIntersectionPoint(d))n=r.intersector===h.q7.TERRAIN?a.GROUND:a.OTHER;else{if(!i.results.ground.getIntersectionPoint(d))return null;n=a.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(d,f),surfaceType:n}};return function(e){if("start"===e.action){var t=g(e.screenStart);l=(0,r.pC)(t)?t.location:null}if((0,r.Wi)(l))return null;var i=g(e.screenEnd);return(0,r.pC)(i)&&(0,r.pC)(i.location)?(0,n.Z)((0,n.Z)({},e),{},{mapStart:l,mapEnd:i.location,surfaceType:i.surfaceType}):null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(a||(a={}));(0,o.c)(),(0,o.c)();var _=(0,u.Ue)()},24405:function(e,t,i){i.d(t,{V:function(){return c},e:function(){return l}});var a=i(74165),n=i(93433),r=i(15861),s=i(92026),o=i(80031);function l(e){return u.apply(this,arguments)}function u(){return u=(0,r.Z)((0,a.Z)().mark((function e(t){var i,r,l,u,c,d,p,h,v,f,g,y=arguments;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(l=y.length>1&&void 0!==y[1]?y[1]:t.popupTemplate,!(0,s.Wi)(l)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,l.getRequiredFields(t.fieldsIndex);case 5:if(u=e.sent,c=l.lastEditInfoEnabled,d=t.objectIdField,p=t.typeIdField,h=t.globalIdField,v=t.relationships,!u.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!c){e.next=19;break}return e.next=16,(0,o.CH)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return f=e.t0,g=(0,o.Q0)(t.fieldsIndex,[].concat((0,n.Z)(u),(0,n.Z)(f))),e.abrupt("return",(p&&g.push(p),g&&d&&null!==(i=t.fieldsIndex)&&void 0!==i&&i.has(d)&&!g.includes(d)&&g.push(d),g&&h&&null!==(r=t.fieldsIndex)&&void 0!==r&&r.has(h)&&!g.includes(h)&&g.push(h),v&&v.forEach((function(e){var i,a=e.keyField;g&&a&&(null===(i=t.fieldsIndex)||void 0===i?void 0:i.has(a))&&!g.includes(a)&&g.push(a)})),g));case 23:case"end":return e.stop()}}),e)}))),u.apply(this,arguments)}function c(e,t){return e.popupTemplate?e.popupTemplate:(0,s.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,s.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=96.b94e2b06.chunk.js.map