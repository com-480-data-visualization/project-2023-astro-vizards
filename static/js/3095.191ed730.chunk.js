"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[3095],{86591:function(e,t,r){r.d(t,{Z:function(){return p}});var i,n=r(15671),a=r(43144),s=r(60136),o=r(29388),u=r(27366),l=r(46784),c=r(84652),h=r(49861),f=r(25243),d=r(69912),v=i=function(e){(0,s.Z)(r,e);var t=(0,o.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this,e)).variableName=null,i.dimensionName=null,i.values=[],i.isSlice=!1,i}return(0,a.Z)(r,[{key:"clone",value:function(){return new i({variableName:this.variableName,dimensionName:this.dimensionName,values:(0,c.d9)(this.values),isSlice:this.isSlice})}}]),r}(l.wq);(0,u._)([(0,h.Cb)({type:String,json:{write:!0}})],v.prototype,"variableName",void 0),(0,u._)([(0,h.Cb)({type:String,json:{write:!0}})],v.prototype,"dimensionName",void 0),(0,u._)([(0,h.Cb)({type:f.V5.array(f.V5.oneOf([f.V5.native(Number),f.V5.array(f.V5.native(Number))])),json:{write:!0}})],v.prototype,"values",void 0),(0,u._)([(0,h.Cb)({type:Boolean,json:{write:!0}})],v.prototype,"isSlice",void 0);var p=v=i=(0,u._)([(0,d.j)("esri.layers.support.DimensionalDefinition")],v)},55635:function(e,t,r){r.d(t,{OE:function(){return v},Gc:function(){return y},Qg:function(){return p},Rq:function(){return h},gX:function(){return m},z2:function(){return f},ET:function(){return d},Vx:function(){return _}});r(59486);var i=r(92026),n=r(15671),a=r(43144),s=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:15e3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5e3;(0,n.Z)(this,e),this._timer=null,this._cachedBlocks=new Map,this._size=-1,this._duration=t,this._interval=Math.min(t,r)}return(0,a.Z)(e,[{key:"decreaseRefCount",value:function(e,t){var r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){var n=i.get(r);return n.refCount--,n.refCount<=0&&(i.delete(r),n.controller&&n.controller.abort()),n.refCount}return 0}},{key:"getBlock",value:function(e,t){var r=e+"/"+t,i=this._cachedBlocks;if(i.has(r)){var n=i.get(r);return n.ts=Date.now(),n.refCount++,i.delete(r),i.set(r,n),n.block}return null}},{key:"putBlock",value:function(e,t,r,i){var n=this._cachedBlocks,a=e+"/"+t;if(n.has(a)){var s=n.get(a);s.ts=Date.now(),s.refCount++}else n.set(a,{block:r,ts:Date.now(),refCount:1,controller:i});this._trim(),this._updateTimer()}},{key:"deleteBlock",value:function(e,t){var r=this._cachedBlocks,i=e+"/"+t;r.has(i)&&r.delete(i)}},{key:"updateMaxSize",value:function(e){this._size=e,this._trim()}},{key:"empty",value:function(){this._cachedBlocks.clear(),this._clearTimer()}},{key:"getCurrentSize",value:function(){return this._cachedBlocks.size}},{key:"_updateTimer",value:function(){var e=this;if(null==this._timer){var t=this._cachedBlocks;this._timer=setInterval((function(){for(var r=Array.from(t),i=Date.now(),n=0;n<r.length&&r[n][1].ts<=i-e._duration;n++)t.delete(r[n][0]);0===t.size&&e._clearTimer()}),this._interval)}}},{key:"_trim",value:function(){var e=this._cachedBlocks;if(!(-1===this._size||this._size>=e.size))for(var t=Array.from(e),r=0;r<t.length-this._size;r++)e.delete(t[r][0])}},{key:"_clearTimer",value:function(){null!=this._timer&&(clearInterval(this._timer),this._timer=null)}}]),e}(),o=r(80394),u=r(585),l=new Map,c=new s;function h(e,t){return null==t?e:"".concat(e,"?sliceId=").concat(t)}function f(e,t){var r={extent:null,rasterInfo:t,cache:new Map},i=l.get(e);return i?(i.push(r),i.length-1):(l.set(e,[r]),0)}function d(e,t){var r=l.get(e);r&&(r[t]=null,r.some((function(e){return null!=e}))||l.delete(e))}function v(e,t,r){var i,n=l.get(e);if(!n)return null==t?c.decreaseRefCount(e,r):0;if(null==t||null==n[t])return c.decreaseRefCount(e,r);var a=null===(i=n[t])||void 0===i?void 0:i.cache,s=null===a||void 0===a?void 0:a.get(r);if(a&&s){if(s.refCount--,0===s.refCount){a.delete(r);for(var o=0;o<n.length;o++){var u;null===(u=n[o])||void 0===u||u.cache.delete(r)}s.controller&&s.controller.abort()}return s.refCount}return 0}function p(e,t,r){var i,n=l.get(e);if(!n)return null==t?c.getBlock(e,r):null;if(null==t||null==n[t]){for(var a=0;a<n.length;a++){var s,o=null===(s=n[a])||void 0===s?void 0:s.cache.get(r);if(o)return o.refCount++,o.block}return c.getBlock(e,r)}var u=null===(i=n[t])||void 0===i?void 0:i.cache.get(r);if(u)return u.refCount++,u.block;for(var h=0;h<n.length;h++){var f;if(h!==t&&n[h]){var d=null===(f=n[h])||void 0===f?void 0:f.cache,v=null===d||void 0===d?void 0:d.get(r);if(d&&v)return v.refCount++,d.set(r,v),v.block}}return null}function m(e,t,r,i){var n,a=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=l.get(e);if(s)if(null!=t&&null!=s[t]){var o={refCount:1,block:i,isResolved:!1,isRejected:!1,controller:a};i.then((function(){return o.isResolved=!0})).catch((function(){return o.isRejected=!0})),null===(n=s[t])||void 0===n||n.cache.set(r,o)}else c.putBlock(e,r,i,a);else null==t&&c.putBlock(e,r,i,a)}function y(e,t,r){var i,n=l.get(e);n?null!=t&&null!=n[t]?null===(i=n[t])||void 0===i||i.cache.delete(r):c.deleteBlock(e,r):null==t&&c.deleteBlock(e,r)}function g(e,t){var r,i=l.get(e);return i&&null!==(r=i[t])&&void 0!==r?r:null}function _(e,t,r,n,a,s){var l,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,h=g(e,t);if(h){var f=h.extent,d=h.cache,v=h.rasterInfo;if(!f||f.xmin!==r.xmin||f.xmax!==r.xmax||f.ymin!==r.ymin||f.ymax!==r.ymax){n=null!==(l=n)&&void 0!==l?l:0;for(var p=r.clone().normalize(),m=v.spatialReference,y=v.transform,_=new Set,b=0;b<p.length;b++){var x=p[b];if(!(x.xmax-x.xmin<=n||x.ymax-x.ymin<=n)){var w=(0,o.tB)(x,m,c);(0,i.pC)(y)&&(w=y.inverseTransform(w));var T=new u.Z({x:n,y:n,spatialReference:x.spatialReference});if(null==a&&!(a=(0,o.VO)(T,m,x,c)))return;var k=(0,o.kr)(a,v,s||"closest"),P=k.pyramidLevel,C=k.pyramidResolution;if(k.excessiveReading)return;for(var I=v.storageInfo,Z=I.origin,R={x:Math.max(0,Math.floor((w.xmin-Z.x)/C.x)),y:Math.max(0,Math.floor((Z.y-w.ymax)/C.y))},S=Math.ceil((w.xmax-w.xmin)/C.x-.1),U=Math.ceil((w.ymax-w.ymin)/C.y-.1),F=P>0?I.pyramidBlockWidth:I.blockWidth,M=P>0?I.pyramidBlockHeight:I.blockHeight,z=Math.max(0,Math.floor(R.x/F)-1),D=Math.max(0,Math.floor(R.y/M)-1),V=Math.floor((R.x+S-1)/F)+1,B=Math.floor((R.y+U-1)/M)+1,E=D;E<=B;E++)for(var G=z;G<=V;G++)_.add("".concat(P,"/").concat(E,"/").concat(G))}}d.forEach((function(e,t){if(!_.has(t)){var r=d.get(t);(null==r||r.isResolved||r.isRejected)&&d.delete(t)}})),h.extent={xmin:r.xmin,ymin:r.ymin,xmax:r.xmax,ymax:r.ymax}}}}},21969:function(e,t,r){r.d(t,{MO:function(){return u},Tj:function(){return m},Ur:function(){return l},W2:function(){return v},WU:function(){return y},WY:function(){return p},gk:function(){return b},jj:function(){return g},nb:function(){return d}});var i=r(1413),n=r(93433),a=r(92026),s=r(86591);function o(e,t,r){var i=t.shift();if(0===r.length){r.push({sliceId:-1,multidimensionalDefinition:[]})}for(var a=r.length,s=function(){var t,a=r.shift().multidimensionalDefinition;null===(t=i.values)||void 0===t||t.forEach((function(t){r.push({sliceId:-1,multidimensionalDefinition:[].concat((0,n.Z)(a),[{variableName:e,dimensionName:i.name,values:[t]}])})}))},u=0;u<a;u++)s();t.length&&o(e,t,r)}function u(e,t){var r=[],a=0;return(t?e.variables.filter((function(e){return e.name.toLowerCase()===t.toLowerCase()})):(0,n.Z)(e.variables).sort((function(e,t){return e.name>t.name?1:-1}))).forEach((function(e){var t=[],s=(0,n.Z)(e.dimensions).sort((function(e,t){return e.name>t.name?-1:1}));o(e.name,s,t),t.forEach((function(e){r.push((0,i.Z)((0,i.Z)({},e),{},{sliceId:a++}))}))})),r}function l(e,t,r){var i=e;if(t&&(t=(0,n.Z)(t).sort((function(e,t){return e.dimensionName<t.dimensionName?-1:1}))).forEach((function(e){var t=e.dimensionName,r=e.values,n=e.isSlice;r.length&&(i=i.filter((function(e){var i=e.multidimensionalDefinition.find((function(e){return e.dimensionName===t}));if(null==i)return!1;var a=i.values[0];return"number"==typeof a?"number"==typeof r[0]?r.includes(a):r.some((function(e){return e[0]<=a&&e[1]>=a})):"number"==typeof r[0]?r.some((function(e){return a[0]<=e&&a[1]>=e})):n?r.some((function(e){return e[0]===a[0]&&e[0]===a[1]})):r.some((function(e){return e[0]>=a[0]&&e[0]<=a[1]||e[1]>=a[0]&&e[1]<=a[1]||e[0]<a[0]&&e[1]>a[1]}))})))})),i.length&&r&&(0,a.pC)(r.start)&&(0,a.pC)(r.end)){var s=r.start.getTime(),o=r.end.getTime(),u=i[0].multidimensionalDefinition.findIndex((function(e){return"StdTime"===e.dimensionName}));u>-1&&(i=i.filter((function(e){var t=e.multidimensionalDefinition[u].values[0];return s<=t&&o>=t})))}return i.map((function(e){return e.sliceId}))}function c(e,t){return Array.isArray(e)?t[0]===t[1]?e[0]===t[0]||e[1]===t[0]:e[0]>=t[0]&&e[0]<=t[1]&&e[1]>=t[0]&&e[1]<=t[1]:e>=t[0]&&e<=t[1]}function h(e){return 1===e.length?[e[0],e[0]]:[e[0],e[e.length-1]]}function f(e,t,r){var a,s;if(null===t||void 0===t||null===(a=t.subsetDefinitions)||void 0===a||!a.length)return e;if(r){var o,u=t.variables;if(u.length&&!u.includes(r))return null;var l=t.subsetDefinitions.find((function(t){return t.dimensionName===e.name&&t.variableName===r}));if(null===l||void 0===l||null===(o=l.values)||void 0===o||!o.length)return e;s=h(l.values)}else{var f;s=null===(f=t.dimensions.find((function(t){return t.name===e.name})))||void 0===f?void 0:f.extent}var d=s;if(!d||null===d||void 0===d||!d.length)return e;var v=e.values.filter((function(e){return c(e,d)}));return(0,i.Z)((0,i.Z)({},e),{},{extent:(0,n.Z)(d),values:v})}function d(e,t,r){var i;if(null===t||void 0===t||null===(i=t.subsetDefinitions)||void 0===i||!i.length)return!1;var n=t.variables;if(n.length&&e.some((function(e){var t=e.variableName;return t&&!n.includes(t)})))return!0;for(var a=function(){var i=e[s],n=t.subsetDefinitions.find((function(e){return(""===i.variableName||e.variableName===i.variableName)&&e.dimensionName===i.dimensionName}));if(null!==n&&void 0!==n&&n.values.length){var a=h(n.values);if(i.isSlice||2!==i.values.length||Array.isArray(i.values[0])||i.values[0]===i.values[1]||!r){if(i.values.some((function(e){return!c(e,a)})))return{v:!0}}else if(!function(e,t){return e[0]<=t[0]&&e[1]>=t[0]||e[0]<=t[1]&&e[1]>=t[1]||e[0]>=t[0]&&e[1]<=t[1]}(i.values,a))return{v:!0}}},s=0;s<e.length;s++){var o=a();if("object"===typeof o)return o.v}return!1}function v(e,t){if((0,a.Wi)(e))return{isOutside:!1};var r=t.geometry,i=t.timeExtent,n=t.multidimensionalDefinition,o=null;if((0,a.pC)(i)&&(o=function(e,t){var r,i,n=e.dimensions.find((function(e){return"StdTime"===e.name}));if(null==n||(0,a.Wi)(t.start)&&(0,a.Wi)(t.end))return t;t=t.clone();var o=t.toJSON(),u=o.start,l=o.end,c=u===l?[u]:null!=u&&null!=l?[u,l]:[null!==u&&void 0!==u?u:l];return 2===c.length&&null!==n&&void 0!==n&&n.extent.length&&(c[0]=Math.max(c[0],n.extent[0]),c[1]=Math.min(c[1],null!==(r=n.extent[1])&&void 0!==r?r:n.extent[0]),c[1]<c[0])||d([new s.Z({variableName:"",dimensionName:"StdTime",isSlice:1===c.length,values:c})],e,!0)?null:(t.start=new Date(c[0]),t.end=new Date(null!==(i=c[1])&&void 0!==i?i:c[0]),t)}(e,i),(0,a.Wi)(o)))return{isOutside:!0};var u=e.areaOfInterest;if(u&&r){var l="point"===r.type?r:"extent"===r.type?r.center:"polygon"===r.type?r.centroid:null;if(l&&!u.contains(l))return{isOutside:!0}}return(0,a.pC)(n)&&n.length&&d(n,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:r,timeExtent:o,multidimensionalDefinition:n}}}function p(e){var t,r,i,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=e.multidimensionalInfo,o=e.keyProperties;if((0,a.Wi)(s))return null;var u=n.variableName,l=n.multidimensionalSubset,c=n.multidimensionalDefinition,h=(0,a.pC)(c)?null===(t=c[0])||void 0===t?void 0:t.variableName:null,f=u||h||(null===o||void 0===o?void 0:o.DefaultVariable),d=s.variables;return(null===l||void 0===l||null===(r=l.variables)||void 0===r?void 0:r.length)&&(d=d.filter((function(e){var t=e.name;return l.variables.includes(t)}))),f&&null!==(i=d.find((function(e){return e.name===f})))&&void 0!==i?i:d[0]}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=p(e,t);if(!r)return null;var i=[],n=r.dimensions,a=r.name;if(0===n.length)return[new s.Z({variableName:a,dimensionName:"",values:[],isSlice:!0})];for(var o=0;o<n.length;o++){var u,l=f(n[o],t.multidimensionalSubset,a);if(!l)return null;var c=l.values,h=l.extent,d=null!==(u=null===c||void 0===c?void 0:c[0])&&void 0!==u?u:h[0];"stdz"===l.name.toLowerCase()&&!l.hasRanges&&Math.abs(h[1])<=Math.abs(h[0])&&(d=null!==c&&void 0!==c&&c.length?c[c.length-1]:h[1]),i.push(new s.Z({variableName:a,dimensionName:l.name,values:[d],isSlice:!t.useRangeForRangedDimensionInfo||!!l.hasRanges}))}return i}function y(e){return!((0,a.Wi)(e)||!e.length)&&e.some((function(e){if(null==e.values)return!0;var t=e.values.length;return 0===t||t>1||!e.isSlice&&Array.isArray(e.values[0])}))}function g(e,t){var r;if((0,a.Wi)(t)||(0,a.Wi)(e))return null;var n=t.variables.map((function(e){return(0,i.Z)({},e)}));return null!==e&&void 0!==e&&null!==(r=e.variables)&&void 0!==r&&r.length&&(n=n.filter((function(t){var r=t.name;return e.variables.includes(r)}))).forEach((function(t){t.dimensions=t.dimensions.map((function(r){return f(r,e,t.name)})).filter(a.pC)})),n}function _(e){var t,r,i,n=null===(t=e.values)||void 0===t?void 0:t.length;if(n)return n;var a=e.extent,s=e.unit,o=e.interval||1,u=a?a[1]-a[0]:0;if("ISO8601"!==s)return Math.round(u/o);switch(null!==(r=null===(i=e.intervalUnit)||void 0===i?void 0:i.toLowerCase())&&void 0!==r?r:"seconds"){case"seconds":n=Math.round(u/1e3/o);break;case"minutes":n=Math.round(u/6e4/o);break;case"hours":n=Math.round(u/36e5/o);break;case"days":n=Math.round(u/864e5/o);break;case"months":var l=new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear(),c=new Date(a[1][0]).getUTCMonth(),h=new Date(a[1][1]).getUTCMonth();n=0===l?h-c+1:h+11-c+12*(l-1)+1;break;case"years":n=Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/o);break;case"decades":n=Math.round((new Date(a[1]).getUTCFullYear()-new Date(a[0]).getUTCFullYear())/10/o);break;default:n=0}return n}function b(e,t){for(var r=0,i=e[0].variableName,a=(0,n.Z)(t.variables).sort((function(e,t){return e.name>t.name?1:-1})),s=function(){var t=a[o],s=(0,n.Z)(t.dimensions).sort((function(e,t){return e.name>t.name?-1:1}));if(t.name!==i)return r+=s.map((function(e){return _(e)})).reduce((function(e,t){return e*t})),"continue";for(var u=s.map((function(e){return _(e)})),l=s.length,c=function(t){var i=e.find((function(e){return e.dimensionName===s[t].name}));if(null==i)return{v:{v:null}};var n=function(e,t){var r,i=t.values;if(null!==i&&void 0!==i&&i.length)return Array.isArray(i[0])!==Array.isArray(e)?-1:Array.isArray(i[0])?i.findIndex((function(t){return t[0]===e[0]&&t[1]===e[1]})):i.indexOf(e);var n=t.extent;if(Array.isArray(e)||e<n[0]||e>n[1])return-1;var a=t.interval||1;if("ISO8601"!==t.unit)return Math.round((e-n[0])/a);var s=n[0],o=-1;switch((null===(r=t.intervalUnit)||void 0===r?void 0:r.toLowerCase())||"seconds"){case"seconds":o=Math.round((e-s)/1e3/a);break;case"minutes":o=Math.round((e-s)/6e4/a);break;case"hours":o=Math.round((e-s)/36e5/a);break;case"days":o=Math.round((e-s)/864e5/a);break;case"months":var u=new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear(),l=new Date(s).getUTCMonth(),c=new Date(e).getUTCMonth();o=0===u?c-l:c+11-l+12*(u-1);break;case"years":o=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/a);break;case"decades":o=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/10/a)}return o}(i.values[0],s[t]);if(-1===n)return{v:{v:null}};u.shift(),r+=t===l-1?n:n*u.reduce((function(e,t){return e*t}))},h=0;h<l;h++){var f=c(h);if("object"===typeof f)return f.v}return"break"},o=0;o<a.length;o++){var u=s();if("continue"!==u){if("break"===u)break;if("object"===typeof u)return u.v}}return r}},55067:function(e,t,r){r.d(t,{Z:function(){return m}});var i=r(37762),n=r(15671),a=r(43144),s=r(11752),o=r(61120),u=r(60136),l=r(29388),c=r(93169),h=r(80613),f=r(64510),d=r(52424),v=r(40655),p=function(e,t){return e.key.level-t.key.level!=0?e.key.level-t.key.level:e.key.row-t.key.row!=0?e.key.row-t.key.row:e.key.col-t.key.col},m=function(e){(0,u.Z)(r,e);var t=(0,l.Z)(r);function r(e){var i;return(0,n.Z)(this,r),(i=t.call(this))._tileInfoView=e,i}return(0,a.Z)(r,[{key:"requiresDedicatedFBO",get:function(){return!1}},{key:"renderChildren",value:function(e){this.sortChildren(p),this.setStencilReference(e),(0,s.Z)((0,o.Z)(r.prototype),"renderChildren",this).call(this,e)}},{key:"createRenderParams",value:function(e){var t=e.state,i=(0,s.Z)((0,o.Z)(r.prototype),"createRenderParams",this).call(this,e);return i.requiredLevel=this._tileInfoView.getClosestInfoForScale(t.scale).level,i.displayLevel=this._tileInfoView.tileInfo.scaleToZoom(t.scale),i}},{key:"prepareRenderPasses",value:function(e){var t=this,i=(0,s.Z)((0,o.Z)(r.prototype),"prepareRenderPasses",this).call(this,e);return i.push(e.registerRenderPass({name:"stencil",brushes:[v.Z],drawPhase:h.jx.DEBUG|h.jx.MAP|h.jx.HIGHLIGHT,target:function(){return t.getStencilTarget()}})),(0,c.Z)("esri-tiles-debug")&&i.push(e.registerRenderPass({name:"tileInfo",brushes:[d.Z],drawPhase:h.jx.DEBUG,target:function(){return t.children}})),i}},{key:"getStencilTarget",value:function(){return this.children}},{key:"setStencilReference",value:function(e){var t,r=1,n=(0,i.Z)(this.children);try{for(n.s();!(t=n.n()).done;){t.value.stencilRef=r++}}catch(a){n.e(a)}finally{n.f()}}}]),r}(f.Z)},83095:function(e,t,r){r.r(t),r.d(t,{default:function(){return ht}});var i=r(74165),n=r(15861),a=r(15671),s=r(43144),o=r(60136),u=r(29388),l=r(27366),c=r(52639),h=r(32718),f=r(92026),d=r(66978),v=r(94172),p=r(49861),m=(r(25243),r(63780),r(69912)),y=r(21969),g=r(34930),_=r(95986),b=r(29439),x=r(11752),w=r(61120),T=r(93433),k=r(65156),P=r(86226),C=r(1413),I=r(22753),Z=r(23588),R=r(15245),S=r(17314),U=r(87422),F=r(8548),M=r(48673),z={bandCount:3,outMin:0,outMax:1,minCutOff:[0,0,0],maxCutOff:[255,255,255],factor:[1/255,1/255,1/255],useGamma:!1,gamma:[1,1,1],gammaCorrection:[1,1,1],colormap:null,colormapOffset:null,stretchType:"none",type:"stretch"},D=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return(0,a.Z)(this,r),(e=t.call(this))._textureInvalidated=!0,e._colormapTextureInvalidated=!0,e._rasterTexture=null,e._rasterTextureBandIds=null,e._transformGridTexture=null,e._colormapTexture=null,e._colormap=null,e._supportsBilinearTexture=!0,e._processedTexture=null,e.functionTextures=[],e.projected=!1,e.stencilRef=0,e.coordScale=[1,1],e._processed=!1,e._symbolizerParameters=null,e.height=null,e.isRendereredSource=!1,e.pixelRatio=1,e.resolution=0,e.rotation=0,e._source=null,e.rawPixelData=null,e._suspended=!1,e._bandIds=null,e._interpolation=null,e._transformGrid=null,e.width=null,e.x=0,e.y=0,e.source=i,e.transformGrid=n,e.interpolation=s,e}return(0,s.Z)(r,[{key:"destroy",value:function(){this._disposeTextures()}},{key:"processedTexture",get:function(){return this._processedTexture},set:function(e){this._processedTexture!==e&&(this._disposeTextures(!0),this._processedTexture=e)}},{key:"rasterTexture",get:function(){return this._rasterTexture},set:function(e){var t;this._rasterTexture!==e&&(null!==(t=this._rasterTexture)&&void 0!==t&&t.dispose(),this._rasterTexture=e)}},{key:"processed",get:function(){return this._processed},set:function(e){this._processed=e,e||((0,f.M2)(this.processedTexture),this.invalidateTexture())}},{key:"symbolizerParameters",get:function(){return this._symbolizerParameters||z},set:function(e){this._symbolizerParameters!==e&&(this._symbolizerParameters=e,this._colormapTextureInvalidated=!0,this.commonUniforms=null)}},{key:"source",get:function(){return this._source},set:function(e){this._source!==e&&(this._source=e,this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this.projected=!1,this.invalidateTexture())}},{key:"suspended",get:function(){return this._suspended},set:function(e){this._suspended&&!e&&this.stage&&(this.ready(),this.requestRender()),this._suspended=e}},{key:"bandIds",get:function(){return this._bandIds},set:function(e){this._bandIds=e,this._isBandIdschanged(e)&&(this.projected=!1,this.invalidateTexture())}},{key:"interpolation",get:function(){return this._interpolation||"nearest"},set:function(e){this._interpolation=e,this._rasterTexture&&this._rasterTexture.setSamplingMode("bilinear"===this._getTextureSamplingMethod(e||"nearest")?F.cw.LINEAR:F.cw.NEAREST)}},{key:"transformGrid",get:function(){return this._transformGrid},set:function(e){this._transformGrid=e,this._transformGridTexture=(0,f.M2)(this._transformGridTexture)}},{key:"invalidateTexture",value:function(){this._textureInvalidated||(this._textureInvalidated=!0,this.requestRender())}},{key:"_createTransforms",value:function(){return{dvs:(0,Z.c)()}}},{key:"setTransform",value:function(e){var t=(0,I.g)(this.transforms.dvs),r=e.toScreenNoRotation([0,0],[this.x,this.y]),i=(0,b.Z)(r,2),n=i[0],a=i[1],s=this.resolution/this.pixelRatio/e.resolution,o=s*this.width,u=s*this.height,l=Math.PI*this.rotation/180;(0,I.h)(t,t,(0,R.f)(n,a)),(0,I.h)(t,t,(0,R.f)(o/2,u/2)),(0,I.r)(t,t,-l),(0,I.h)(t,t,(0,R.f)(-o/2,-u/2)),(0,I.k)(t,t,(0,R.f)(o,u)),(0,I.m)(this.transforms.dvs,e.displayViewMat3,t)}},{key:"getTextures",value:function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=t.forProcessing,i=void 0!==r&&r,n=t.useProcessedTexture,a=void 0!==n&&n,s=a&&null!==(e=this._processedTexture)&&void 0!==e?e:this._rasterTexture,o=[],u=[];return s?a?(u.push(s),o.push("u_image"),this._colormapTexture&&(u.push(this._colormapTexture),o.push("u_colormap")),{names:o,textures:u}):(this._transformGridTexture&&(u.push(this._transformGridTexture),o.push("u_transformGrid")),u.push(s),o.push("u_image"),this._colormapTexture&&!i&&(u.push(this._colormapTexture),o.push("u_colormap")),{names:o,textures:u}):{names:o,textures:u}}},{key:"onAttach",value:function(){this.invalidateTexture()}},{key:"onDetach",value:function(){this.invalidateTexture()}},{key:"updateTexture",value:function(e){var t=e.context;if(this.stage){var r=this._isValidSource(this.source);r&&this._colormapTextureInvalidated&&(this._colormapTextureInvalidated=!1,this._updateColormapTexture(t)),this._textureInvalidated&&(this._textureInvalidated=!1,this._createOrDestroyRasterTexture(t),this._rasterTexture&&(r?this.transformGrid&&!this._transformGridTexture&&(this._transformGridTexture=(0,M.Br)(t,this.transformGrid)):this._rasterTexture.setData(null)),this.suspended||(this.ready(),this.requestRender()))}else this._disposeTextures()}},{key:"updateProcessedTexture",value:function(){var e=this.functionTextures;0!==e.length&&(this.processedTexture=e.shift(),e.forEach((function(e){return null===e||void 0===e?void 0:e.dispose()})),e.length=0)}},{key:"_createOrDestroyRasterTexture",value:function(e){var t,r,i=(0,f.pC)(this.source)?(0,S.qF)(this.source,this.bandIds):null;if(this._isValidSource(i)){var n=!this._isBandIdschanged(this.bandIds);if(this._rasterTexture){if(n)return;this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null}this._supportsBilinearTexture=!(null===(t=e.capabilities.textureFloat)||void 0===t||!t.textureFloatLinear);var a=this._getTextureSamplingMethod(this.interpolation),s=this.isRendereredSource||!(null!==(r=e.capabilities.textureFloat)&&void 0!==r&&r.textureFloat);this._rasterTexture=(0,M.s9)(e,i,a,s),this.projected=!1,this._processed=!1,this._rasterTextureBandIds=this.bandIds?(0,T.Z)(this.bandIds):null}else this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTextureBandIds=null,this._rasterTexture=null)}},{key:"_isBandIdschanged",value:function(e){var t=this._rasterTextureBandIds;return!(null==t&&null==e||t&&e&&t.join("")===e.join(""))}},{key:"_isValidSource",value:function(e){var t;return(0,f.pC)(e)&&(null===(t=e.pixels)||void 0===t?void 0:t.length)>0}},{key:"_getTextureSamplingMethod",value:function(e){var t=this.symbolizerParameters,r=t.type,i=t.colormap,n="lut"===r||"stretch"===r&&(0,f.pC)(i);return!this._supportsBilinearTexture||n||"bilinear"!==e&&"cubic"!==e?"nearest":"bilinear"}},{key:"_updateColormapTexture",value:function(e){var t=this._colormap,r=this.symbolizerParameters.colormap;return r?t?r.length!==t.length||r.some((function(e,r){return e!==t[r]}))?(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),this._colormapTexture=(0,M.iC)(e,r),void(this._colormap=r)):void 0:(this._colormapTexture=(0,M.iC)(e,r),void(this._colormap=r)):(this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null),void(this._colormap=null))}},{key:"_disposeTextures",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this._transformGridTexture&&(this._transformGridTexture.dispose(),this._transformGridTexture=null),!e&&this._colormapTexture&&(this._colormapTexture.dispose(),this._colormapTexture=null,this._colormap=null,this._colormapTextureInvalidated=!0),!e&&this._rasterTexture&&(this._rasterTexture.dispose(),this._rasterTexture=null,this._rasterTextureBandIds=null),this._processedTexture&&(this._processedTexture.dispose(),this._processedTexture=null)}}]),r}(U.s);function V(e){var t=[];return e&&(t.push("applyProjection"),1===e.spacing[0]&&t.push("lookupProjection")),t}function B(e,t,r){var i,n=!(null!==(i=r.capabilities.textureFloat)&&void 0!==i&&i.textureFloatLinear),a=[];return"cubic"===e?a.push("bicubic"):"bilinear"===e&&(t?(a.push("bilinear"),a.push("nnedge")):n&&a.push("bilinear")),a}var E={vsPath:"raster/common",fsPath:"raster/lut",attributes:new Map([["a_position",0],["a_texcoord",1]])};var G={createProgram:function(e,t,r){var i=r?[]:V(t.transformGrid);return{defines:i,program:e.painter.materialManager.getProgram(E,i)}},bindTextureAndUniforms:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=r.getTextures({useProcessedTexture:n}),s=a.names,o=a.textures;(0,M.RA)(e.context,t,s,o),(0,M.N9)(t,i,r.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",r.transforms.dvs);var u=r.symbolizerParameters,l=u.colormap,c=u.colormapOffset,h=(0,M.Ue)(l,c);(0,M.N9)(t,i,h)}},L={vsPath:"raster/common",fsPath:"raster/hillshade",attributes:new Map([["a_position",0],["a_texcoord",1]])};var O={createProgram:function(e,t,r){var i=t.symbolizerParameters.colormap,n=[].concat((0,T.Z)(r?[]:V(t.transformGrid)),(0,T.Z)(B(t.interpolation,null!=i,e.context)));return null!=i&&n.push("applyColormap"),{defines:n,program:e.painter.materialManager.getProgram(L,n)}},bindTextureAndUniforms:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=r.getTextures({useProcessedTexture:n}),s=a.names,o=a.textures;(0,M.RA)(e.context,t,s,o),(0,M.N9)(t,i,r.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",r.transforms.dvs);var u=r.symbolizerParameters,l=u.colormap,c=u.colormapOffset;if(null!=l){var h=(0,M.Ue)(l,c);(0,M.N9)(t,i,h)}var f=(0,M.Fm)(u);(0,M.N9)(t,i,f)}},A={vsPath:"raster/common",fsPath:"raster/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};var N={createProgram:function(e,t,r){var i=t.symbolizerParameters.colormap,n=[].concat((0,T.Z)(r?[]:V(t.transformGrid)),(0,T.Z)(B(t.interpolation,null!=i,e.context)));return t.isRendereredSource&&!r?n.push("noop"):null!=i&&n.push("applyColormap"),{defines:n,program:e.painter.materialManager.getProgram(A,n)}},bindTextureAndUniforms:function(e,t,r,i){var n=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=r.getTextures({useProcessedTexture:n}),s=a.names,o=a.textures;(0,M.RA)(e.context,t,s,o),(0,M.N9)(t,i,r.commonUniforms),t.setUniformMatrix3fv("u_dvsMat3",r.transforms.dvs);var u=r.symbolizerParameters,l=u.colormap,c=u.colormapOffset;if(null!=l){var h=(0,M.Ue)(l,c);(0,M.N9)(t,i,h)}var f=(0,M.xW)(u);(0,M.N9)(t,i,f)}},j=new Map;j.set("lut",G),j.set("hillshade",O),j.set("stretch",N);var q=[1,1],W=[2,0,0,0,2,0,-1,-1,0];function Y(e,t,r){var i,n,a=e.context,s=e.rasterFunction,o=e.hasBranches,u=s.parameters.raster,l=o?null!==(i=null===u||void 0===u?void 0:u.id)&&void 0!==i?i:-1:0,c=null!==(n=r.functionTextures[l])&&void 0!==n?n:r.rasterTexture;(0,M.RA)(a,t,["u_image"],[c])}function Q(e,t,r){var i=e.rasterFunction.parameters.rasters;if(i){if(i.length<2)return Y(e,t,r);var n=i.filter((function(e){return"Constant"!==e.name})).map((function(e){return null!=e.id&&"Identity"!==e.name?r.functionTextures[e.id]:r.rasterTexture}));if((0,M.RA)(e.context,t,["u_image","u_image1","u_image2"].slice(0,n.length),n),n.length!==i.length)if(2===i.length){var a=i.findIndex((function(e){return"Constant"===e.name})),s=0===a?[0,1,0,1,0,0,0,0,0]:[1,0,0,0,1,0,0,0,0],o=i[a].parameters.value;t.setUniform1f("u_image1Const",o),t.setUniformMatrix3fv("u_imageSwap",s)}else if(3===i.length){var u=[];if(i.forEach((function(e,t){return"Constant"===e.name&&u.push(t)})),1===u.length){var l=i[u[0]].parameters.value;t.setUniform1f("u_image1Const",l);var c=0===u[0]?[0,1,0,0,0,1,1,0,0]:1===u[0]?[1,0,0,0,0,1,0,1,0]:[1,0,0,0,1,0,0,0,1];t.setUniformMatrix3fv("u_imageSwap",c)}else if(2===u.length){var h=i[u[0]].parameters.value;t.setUniform1f("u_image1Const",h);var f=i[u[1]].parameters.value;t.setUniform1f("u_image2Const",f);var d=i.findIndex((function(e){return"Constant"!==e.name})),v=0===d?[1,0,0,0,1,0,0,0,1]:1===d?[0,1,0,1,0,0,0,0,1]:[0,0,1,1,0,0,0,1,0];t.setUniformMatrix3fv("u_imageSwap",v)}}}}function H(e){e.setUniform2fv("u_coordScale",q),e.setUniformMatrix3fv("u_dvsMat3",W)}var J={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/aspect",attributes:new Map([["a_position",0],["a_texcoord",1]])};var X={createProgram:function(e,t){return e.painter.materialManager.getProgram(J,[])},bindTextureAndUniforms:function(e,t,r){Y(e,t,r),H(t);var i=r.width,n=r.height,a=r.resolution;t.setUniform2fv("u_srcImageSize",[i,n]),t.setUniform2fv("u_cellSize",[a,a])}},K={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/bandarithmetic",attributes:new Map([["a_position",0],["a_texcoord",1]])};var $={createProgram:function(e,t){var r=e.painter,i=e.rasterFunction.parameters.indexType;return r.materialManager.getProgram(K,[i])},bindTextureAndUniforms:function(e,t,r){Y(e,t,r),H(t);var i=e.rasterFunction.parameters.bandIndexMat3;t.setUniformMatrix3fv("u_bandIndexMat3",i)}},ee={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/compositeband",attributes:new Map([["a_position",0],["a_texcoord",1]])};var te={createProgram:function(e,t){return e.painter.materialManager.getProgram(ee,[])},bindTextureAndUniforms:function(e,t,r){Q(e,t,r),H(t)}},re={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/convolution",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ie={createProgram:function(e,t){var r=e.painter,i=e.rasterFunction.parameters,n=[{name:"rows",value:i.kernelRows},{name:"cols",value:i.kernelCols}];return r.materialManager.getProgram(re,n)},bindTextureAndUniforms:function(e,t,r){Y(e,t,r),H(t),t.setUniform2fv("u_srcImageSize",[r.width,r.height]);var i=e.rasterFunction.parameters,n=i.kernel,a=i.clampRange;t.setUniform1fv("u_kernel",n),t.setUniform2fv("u_clampRange",a)}},ne={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/extractband",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ae={createProgram:function(e,t){return e.painter.materialManager.getProgram(ne,[])},bindTextureAndUniforms:function(e,t,r){Y(e,t,r),H(t);var i=e.rasterFunction.parameters.bandIndexMat3;t.setUniformMatrix3fv("u_bandIndexMat3",i)}},se=r(49800),oe={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/local",attributes:new Map([["a_position",0],["a_texcoord",1]])},ue=new Set(["sinh","cosh","tanh","asinh","acosh","atanh"]);var le={createProgram:function(e){var t=e.painter,r=e.rasterFunction.parameters,i=r.imageCount,n=r.operationName,a=r.rasters,s=r.isOutputRounded,o=n.toLowerCase();e.context.type===se.zO.WEBGL1&&ue.has(o)&&(o="polyfill".concat(o));var u=[o];2===i&&u.push("twoImages");var l=a.filter((function(e){return"Constant"===e.name}));return l.length&&(u.push("oneConstant"),2===l.length&&u.push("twoConstant")),s&&u.push("roundOutput"),t.materialManager.getProgram(oe,u)},bindTextureAndUniforms:function(e,t,r){Q(e,t,r),H(t);var i=e.rasterFunction.parameters.domainRange;t.setUniform2fv("u_domainRange",i)}},ce={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/mask",attributes:new Map([["a_position",0],["a_texcoord",1]])};var he={createProgram:function(e,t){var r=e.painter,i=e.rasterFunction.parameters.bandCount>1?["multiBand"]:[];return r.materialManager.getProgram(ce,i)},bindTextureAndUniforms:function(e,t,r){Y(e,t,r),H(t);var i=e.rasterFunction.parameters,n=i.includedRanges,a=i.noDataValues;t.setUniform1fv("u_includedRanges",n),t.setUniform1fv("u_noDataValues",a)}},fe={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/ndvi",attributes:new Map([["a_position",0],["a_texcoord",1]])};var de={createProgram:function(e,t){var r=e.painter,i=e.rasterFunction.parameters.scaled?["scaled"]:[];return r.materialManager.getProgram(fe,i)},bindTextureAndUniforms:function(e,t,r){Y(e,t,r),H(t);var i=e.rasterFunction.parameters.bandIndexMat3;t.setUniformMatrix3fv("u_bandIndexMat3",i)}},ve={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/remap",attributes:new Map([["a_position",0],["a_texcoord",1]])};var pe={createProgram:function(e,t){return e.painter.materialManager.getProgram(ve,[])},bindTextureAndUniforms:function(e,t,r){Y(e,t,r),H(t);var i=e.rasterFunction.parameters,n=i.noDataRanges,a=i.rangeMaps,s=i.allowUnmatched,o=i.clampRange;t.setUniform1fv("u_noDataRanges",n),t.setUniform1fv("u_rangeMaps",a),t.setUniform1f("u_unmatchMask",s?1:0),t.setUniform2fv("u_clampRange",o)}},me=r(6394),ye={vsPath:"raster/common",fsPath:"raster/reproject",attributes:new Map([["a_position",0],["a_texcoord",1]])};var ge={createProgram:function(e,t){var r,i=e.painter,n=[],a=!(null!==(r=e.context.capabilities.textureFloat)&&void 0!==r&&r.textureFloatLinear),s=t.interpolation,o=t.transformGrid;return"cubic"===s?n.push("bicubic"):"bilinear"===s&&a&&n.push("bilinear"),o&&(n.push("applyProjection"),1===o.spacing[0]&&n.push("lookupProjection")),i.materialManager.getProgram(ye,n)},bindTextureAndUniforms:function(e,t,r){var i=r.getTextures({forProcessing:!0}),n=i.names,a=i.textures;(0,M.RA)(e.context,t,n,a),t.setUniform1f("u_scale",1),t.setUniform2fv("u_offset",[0,0]),t.setUniform2fv("u_coordScale",[1,1]),t.setUniformMatrix3fv("u_dvsMat3",[2,0,0,0,2,0,-1,-1,0]),t.setUniform1i("u_flipY",0),t.setUniform1f("u_opacity",1);var s=r.width,o=r.height,u=r.source,l=r.transformGrid;t.setUniform2fv("u_srcImageSize",[u.width,u.height]),t.setUniform2fv("u_targetImageSize",[s,o]),t.setUniform2fv("u_transformSpacing",l?l.spacing:me.Z),t.setUniform2fv("u_transformGridSize",l?l.size:me.Z)}},_e={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/slope",attributes:new Map([["a_position",0],["a_texcoord",1]])};var be={createProgram:function(e,t){var r=e.painter,i="percent-rise"===e.rasterFunction.parameters.slopeType?["percentRise"]:[];return r.materialManager.getProgram(_e,i)},bindTextureAndUniforms:function(e,t,r){Y(e,t,r),H(t);var i=r.width,n=r.height,a=r.resolution,s=e.rasterFunction.parameters,o=s.zFactor,u=s.slopeType,l=s.pixelSizePower,c=s.pixelSizeFactor;t.setUniform2fv("u_srcImageSize",[i,n]),t.setUniform2fv("u_cellSize",[a,a]),t.setUniform1f("u_zFactor",o),t.setUniform1f("u_pixelSizePower","adjusted"===u?l:0),t.setUniform1f("u_pixelSizeFactor","adjusted"===u?c:0)}},xe={vsPath:"raster/rfx/vs",fsPath:"raster/rfx/stretch",attributes:new Map([["a_position",0],["a_texcoord",1]])};var we={createProgram:function(e,t){var r=e.rasterFunction.parameters,i=r.useGamma,n=r.bandCount,a=r.isOutputRounded,s=[];return i&&s.push("useGamma"),n>1&&s.push("multiBand"),a&&s.push("roundOutput"),e.painter.materialManager.getProgram(xe,s)},bindTextureAndUniforms:function(e,t,r){Y(e,t,r),H(t);var i=r.width,n=r.height,a=e.rasterFunction.parameters;t.setUniform2fv("u_srcImageSize",[i,n]),t.setUniform1f("u_minOutput",a.outMin),t.setUniform1f("u_maxOutput",a.outMax),t.setUniform1fv("u_factor",a.factor),t.setUniform1fv("u_minCutOff",a.minCutOff),t.setUniform1fv("u_maxCutOff",a.maxCutOff),t.setUniform1fv("u_gamma",a.gamma),t.setUniform1fv("u_gammaCorrection",a.gammaCorrection)}},Te=r(371),ke=new Map;function Pe(e,t,r){var i={width:t,height:r,target:F.No.TEXTURE_2D,pixelFormat:F.VI.RGBA,internalFormat:e.type===se.zO.WEBGL2?F.lP.RGBA32F:F.VI.RGBA,samplingMode:F.cw.NEAREST,dataType:F.Br.FLOAT,isImmutable:e.type===se.zO.WEBGL2,wrapMode:F.e8.CLAMP_TO_EDGE,flipped:!1};return new Te.x(e,i)}function Ce(e,t,r,i){var n=e.rasterFunction.name.toLowerCase(),a="reproject"===n?ge:function(e){return ke.get(e.toLowerCase())}(n);if(null!=a){var s=function(e,t,r,i){var n=e.context,a=e.requestRender,s=e.allowDelayedRender,o=i.createProgram(e,r);if(s&&(0,f.pC)(a)&&!o.compiled)return a(),null;var u=r.width,l=r.height;return n.bindFramebuffer(t),n.setViewport(0,0,u,l),n.useProgram(o),o}(e,r,i,a);if(s){a.bindTextureAndUniforms(e,s,i),t.draw();var o=i.width,u=i.height,l=Pe(e.context,o,u);if(r.copyToTexture(0,0,o,u,0,0,l),"reproject"===n)i.rasterTexture=l,i.projected=!0;else{var c=e.hasBranches?e.rasterFunction.id:0;i.functionTextures[c]=l}}}}ke.set("aspect",X),ke.set("bandarithmetic",$),ke.set("compositeband",te),ke.set("convolution",ie),ke.set("extractband",ae),ke.set("local",le),ke.set("mask",he),ke.set("ndvi",de),ke.set("remap",pe),ke.set("slope",be),ke.set("stretch",we);var Ie=r(94109),Ze=r(25866),Re=r(3886),Se=r(53634),Ue=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).name="raster",e._quad=null,e._rendererUniformInfos=new Map,e._fbo=null,e}return(0,s.Z)(r,[{key:"dispose",value:function(){(0,f.M2)(this._quad),(0,f.M2)(this._fbo)}},{key:"prepareState",value:function(e){var t=e.context,r="raster"===e.renderPass;t.setBlendingEnabled(!r),t.setBlendFunctionSeparate(F.zi.ONE,F.zi.ONE_MINUS_SRC_ALPHA,F.zi.ONE,F.zi.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0),t.setStencilWriteMask(0),t.setStencilTestEnabled(!r)}},{key:"draw",value:function(e,t){if(function(e){return(0,f.pC)(e.source)}(t)&&!t.suspended){var r=e.renderPass;if("raster-bitmap"!==r)return"raster"===r?this._process(e,t):void this._drawBitmap(e,t,!0);this._drawBitmap(e,t)}}},{key:"_process",value:function(e,t){var r="Reproject"===e.rasterFunction.name;if(r?!t.rasterTexture||!t.projected:!t.processed){var i=e.timeline,n=e.context;i.begin(this.name);var a=n.getBoundFramebufferObject(),s=n.getViewport();r||(t.processedTexture=(0,f.M2)(t.processedTexture)),n.setStencilFunction(F.wb.EQUAL,t.stencilRef,255),t.updateTexture(e),this._initQuad(n);var o=this._getRasterFBO(n,t.width,t.height),u=o.isStandardRasterTileSize,l=o.fbo;Ce(e,this._quad,l,t),u||l.dispose(),n.bindFramebuffer(a),n.setViewport(s.x,s.y,s.width,s.height),i.end(this.name)}}},{key:"_drawBitmap",value:function(e,t){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],i=e.timeline,n=e.context;if(i.begin(this.name),n.setStencilFunction(F.wb.EQUAL,t.stencilRef,255),t.updateTexture(e),r&&!t.processedTexture){if(t.updateProcessedTexture(),!t.processedTexture)return void i.end(this.name);t.processed=!0}this._initBitmapCommonUniforms(t);var a=t.symbolizerParameters.type,s=function(e){return j.get(e)}(a),o=e.requestRender,u=e.allowDelayedRender,l=s.createProgram(e,t,r),c=l.defines,h=l.program;if(u&&(0,f.pC)(o)&&!h.compiled)o();else{n.useProgram(h);var d=this._getUniformInfos(a,n,h,c);this._quad||(this._quad=new Ze.Z(n,[0,0,1,0,0,1,1,1])),s.bindTextureAndUniforms(e,h,t,d,r),this._quad.draw(),i.end(this.name)}}},{key:"_initBitmapCommonUniforms",value:function(e){if(!e.commonUniforms){var t=(0,M.zS)(1,[0,0]),r=e.transformGrid,i=e.width,n=e.height,a=(0,M.Tc)(r,[i,n],[e.source.width,e.source.height],1,!1);e.commonUniforms=(0,C.Z)((0,C.Z)((0,C.Z)({},t),a),{},{u_coordScale:e.coordScale})}}},{key:"_getRasterFBO",value:function(e,t,r){var i=t===Ie.I_||r===Ie.I_;return i?(this._fbo||(this._fbo=this._createNewFBO(e,t,r)),{isStandardRasterTileSize:i,fbo:this._fbo}):{isStandardRasterTileSize:i,fbo:this._createNewFBO(e,t,r)}}},{key:"_createNewFBO",value:function(e,t,r){var i=Pe(e,t,r);return new Se.X(e,{colorTarget:F.Lm.TEXTURE,depthStencilTarget:F.OU.NONE,width:t,height:r},i)}},{key:"_initQuad",value:function(e){this._quad||(this._quad=new Ze.Z(e,[0,0,1,0,0,1,1,1]))}},{key:"_getUniformInfos",value:function(e,t,r,i){var n=i.length>0?e+"-"+i.join("-"):e;if(this._rendererUniformInfos.has(n))return this._rendererUniformInfos.get(n);var a=(0,M.v)(t,r);return this._rendererUniformInfos.set(n,a),a}}]),r}(Re.Z),Fe=r(72900),Me=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n,s,o,u){var l,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return(0,a.Z)(this,r),(l=t.call(this,e,i,n,s,o,u)).bitmap=null,l.bitmap=new D(c,null,null),l.bitmap.coordScale=[o,u],l.bitmap.once("isReady",(function(){return l.ready()})),l}return(0,s.Z)(r,[{key:"destroy",value:function(){(0,x.Z)((0,w.Z)(r.prototype),"destroy",this).call(this),this.bitmap.destroy(),this.bitmap=null,this.stage=null}},{key:"stencilRef",get:function(){return this.bitmap.stencilRef},set:function(e){this.bitmap.stencilRef=e}},{key:"setTransform",value:function(e){(0,x.Z)((0,w.Z)(r.prototype),"setTransform",this).call(this,e),this.bitmap.transforms.dvs=this.transforms.dvs}},{key:"_createTransforms",value:function(){return{dvs:(0,Z.c)(),tileMat3:(0,Z.c)()}}},{key:"onAttach",value:function(){this.bitmap.stage=this.stage}},{key:"onDetach",value:function(){this.bitmap.stage=null}}]),r}(Fe.I),ze=r(80613),De=r(55067),Ve=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e}return(0,s.Z)(r,[{key:"createTile",value:function(e){var t=this._getTileBounds(e),r=(0,b.Z)(this._tileInfoView.tileInfo.size,2),i=r[0],n=r[1],a=this._tileInfoView.getTileResolution(e.level);return new Me(e,a,t[0],t[3],i,n)}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"imagery (tile)",brushes:[Ue],target:function(){return t.children.map((function(e){return e.bitmap}))},drawPhase:ze.jx.MAP});return[].concat((0,T.Z)((0,x.Z)((0,w.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i])}},{key:"doRender",value:function(e){if(this.visible&&e.drawPhase===ze.jx.MAP){var t=this.rasterFunctionChain;if(!t)return e.renderPass="raster-bitmap",void(0,x.Z)((0,w.Z)(r.prototype),"doRender",this).call(this,e);var i=(0,b.Z)(this._tileInfoView.tileInfo.size,2),n=i[0],a=i[1];if(e.renderPass="raster",e.rasterFunction={name:"Reproject",parameters:{targetImageSize:[n,a]},pixelType:"f32",id:0,isNoopProcess:!1},(0,x.Z)((0,w.Z)(r.prototype),"doRender",this).call(this,e),null!==t&&void 0!==t&&t.functions.length)for(var s=t.functions,o=t.hasBranches,u=0;u<s.length;u++){var l=s[u];"Constant"!==l.name&&"Identity"!==l.name&&(e.renderPass="raster",e.rasterFunction=l,e.hasBranches=o,(0,x.Z)((0,w.Z)(r.prototype),"doRender",this).call(this,e))}e.rasterFunction=null,e.renderPass="bitmap",(0,x.Z)((0,w.Z)(r.prototype),"doRender",this).call(this,e)}}},{key:"_getTileBounds",value:function(e){var t=this._tileInfoView.getTileBounds((0,k.Ue)(),e);if(this.isCustomTilingScheme&&e.world){var r=this._tileInfoView.tileInfo,i=(0,P.ut)(r.spatialReference);if(i){var n=r.lodAt(e.level);if(!n)return t;var a=n.resolution,s=i/a%r.size[0],o=s?(r.size[0]-s)*a:0;t[0]-=o*e.world,t[2]-=o*e.world}}return t}}]),r}(De.Z),Be=r(97326),Ee=(r(59486),r(41691)),Ge=r(585),Le=r(96212),Oe=r(22824),Ae=r(55635),Ne=r(80394),je=(r(5131),r(37995)),qe=(r(73828),r(32344)),We=r(85269),Ye=r(90316),Qe=r(53866),He=[0,0],Je=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._emptyTilePixelBlock=null,e._tileStrategy=null,e._tileInfoView=null,e._fetchQueue=null,e._blockCacheRegistryUrl=null,e._blockCacheRegistryId=null,e._srcResolutions=[],e.previousLOD=null,e._needBlockCacheUpdate=!1,e._globalSymbolizerParams=null,e._symbolizerParams=null,e._abortController=null,e._isCustomTilingScheme=!1,e._rasterFunctionState="na",e._globalUpdateRequested=!1,e.attached=!1,e.timeExtent=null,e.redrawOrRefetch=(0,d.Ds)((0,n.Z)((0,i.Z)().mark((function t(){var r,n,a,s,o,u=arguments;return(0,i.Z)().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=u.length>0&&void 0!==u[0]?u[0]:{},e.previousLOD&&!e.layerView.suspended){t.next=3;break}return t.abrupt("return");case 3:if(n=e._rasterFunctionState,t.t0=r.reprocess,!t.t0){t.next=9;break}return t.next=8,e.updatingHandles.addPromise(e.layer.updateRasterFunction());case 8:e.updateRasterFunctionParameters();case 9:return a=e._rasterFunctionState,s=(0,Be.Z)(e),o=s.type,t.abrupt("return",r.refetch||"raster"!==o&&r.reprocess||"cpu"===a||"cpu"===n?e.updatingHandles.addPromise(e.doRefresh()):e.updatingHandles.addPromise(e._redrawImage(r.signal)));case 11:case"end":return t.stop()}}),t)})))),e}return(0,s.Z)(r,[{key:"useWebGLForProcessing",get:function(){var e;return null===(e=this._get("useWebGLForProcessing"))||void 0===e||e},set:function(e){this._set("useWebGLForProcessing",e)}},{key:"useProgressiveUpdate",get:function(){return null==this._get("useProgressiveUpdate")||this._get("useProgressiveUpdate")},set:function(e){var t=this;if(this._tileStrategy&&this.useProgressiveUpdate!==e){this._tileStrategy.destroy(),this.container.removeAllChildren();var r=this._getCacheSize(e);this._tileStrategy=new We.Z({cachePolicy:"purge",acquireTile:function(e){return t.acquireTile(e)},releaseTile:function(e){return t.releaseTile(e)},cacheSize:r,tileInfoView:this._tileInfoView}),this._set("useProgressiveUpdate",e),this.layerView.requestUpdate()}}},{key:"update",value:function(e){this._fetchQueue.pause(),this._fetchQueue.state=e.state,this._tileStrategy.update(e),this._fetchQueue.resume();var t=e.state,r=t.extent,i=t.resolution,n=t.scale,a=this._tileInfoView.getClosestInfoForScale(n);if(this.layer.raster){var s;if(!this.useProgressiveUpdate||this._needBlockCacheUpdate){var o=this._srcResolutions[a.level],u=r.toJSON?r:Qe.Z.fromJSON(r);(0,Ae.Vx)(this._blockCacheRegistryUrl,this._blockCacheRegistryId,u,i,o,this.layer.raster.ioConfig.sampling)}this._needBlockCacheUpdate=!1,(null===(s=this.previousLOD)||void 0===s?void 0:s.level)!==a.level&&(this.previousLOD=a,null==this._symbolizerParams||this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._tileStrategy.updateCacheSize(0))}}},{key:"moveEnd",value:function(){var e=this;!this.layerView.hasTilingEffects&&this.useProgressiveUpdate||(this._abortController&&this._abortController.abort(),this._abortController=new AbortController,0===this._fetchQueue.length&&this._redrawImage(this._abortController.signal).then((function(){e._globalUpdateRequested=!1,e.layerView.requestUpdate()})));var t=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy.updateCacheSize(t),this.layerView.requestUpdate()}},{key:"updating",get:function(){var e;return(null===(e=this._fetchQueue)||void 0===e?void 0:e.updating)||this._globalUpdateRequested||!(!this.updatingHandles||!this.updatingHandles.updating)}},{key:"attach",value:function(){var e=this;(0,Ye.hc)("2d").supportsTextureFloat||(this.useWebGLForProcessing=!1),this._initializeTileInfo(),this._tileInfoView=new je.Z(this.layerView.tileInfo,this.layerView.fullExtent);var t=this._computeFetchConcurrency();this._fetchQueue=new qe.Z({tileInfoView:this._tileInfoView,concurrency:t,process:function(t,r){return e._fetchTile1(t,r)}});var r=this._getCacheSize(this.useProgressiveUpdate);this._tileStrategy=new We.Z({cachePolicy:"purge",acquireTile:function(t){return e.acquireTile(t)},releaseTile:function(t){return e.releaseTile(t)},cacheSize:r,tileInfoView:this._tileInfoView}),this._updateBlockCacheRegistry()}},{key:"detach",value:function(){this._tileStrategy.destroy(),this._fetchQueue.clear(),this.container.removeAllChildren(),this._fetchQueue=this._tileStrategy=this._tileInfoView=null,(0,Ae.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryUrl=this._blockCacheRegistryId=null}},{key:"acquireTile",value:function(e){var t=this.container.createTile(e);return this._enqueueTileFetch(t),this.layerView.requestUpdate(),this._needBlockCacheUpdate=!0,this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,t}},{key:"releaseTile",value:function(e){var t=this;this._fetchQueue.abort(e.key.id),this.container.removeChild(e),e.once("detach",(function(){e.destroy(),t.layerView.requestUpdate()})),this.layerView.requestUpdate()}},{key:"createEmptyTilePixelBlock",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=null==e||e.join(",")===this._tileInfoView.tileInfo.size.join(",");if(t&&(0,f.pC)(this._emptyTilePixelBlock))return this._emptyTilePixelBlock;var r=e=e||this._tileInfoView.tileInfo.size,i=(0,b.Z)(r,2),n=i[0],a=i[1],s=new Le.Z({width:n,height:a,pixels:[new Uint8Array(n*a)],mask:new Uint8Array(n*a),pixelType:"u8"});return t&&(this._emptyTilePixelBlock=s),s}},{key:"_getBandIds",value:function(){if(!("rasterFunctionChain"in this.container)||!this.container.rasterFunctionChain)return this.layer.bandIds;var e=this.layer,t=e.bandIds,r=e.raster,i="rasterFunction"in r?r.rasterFunction.rawInputBandIds:null;return null!==t&&void 0!==t&&t.length&&null!==i&&void 0!==i&&i.length&&1!==r.rasterInfo.bandCount?t.map((function(e){return i[Math.min(e,i.length-1)]})):t||i}},{key:"updateRasterFunctionParameters",value:function(){}},{key:"_fetchTile1",value:function(e,t){var r=(0,f.pC)(t)?t.signal:null,i=this.canUseWebGLForProcessing(),n=this.layerView,a=n.tileInfo,s=!a.isWrappable&&(0,f.pC)((0,Ne.ut)(n.view.spatialReference)),o=i&&this.layer.raster.hasUniqueSourceStorageInfo,u={allowPartialFill:!0,datumTransformation:n.datumTransformation,interpolation:i?"nearest":this.layer.interpolation,registryId:this._blockCacheRegistryId,requestRawData:o,skipRasterFunction:"raster"===this.type&&null!=this.container.rasterFunctionChain,signal:(0,f.Wg)(r),srcResolution:this._srcResolutions[e.level],timeExtent:n.timeExtent,tileInfo:a,disableWrapAround:s};return this.fetchTile(e,u)}},{key:"_getCacheSize",value:function(e){return e?40:0}},{key:"_initializeTileInfo",value:function(){var e=this.layerView,t=e.view.spatialReference,r=new Ge.Z({x:e.fullExtent.xmin,y:e.fullExtent.ymax,spatialReference:t});if(this._canUseLayerLODs()){var i=this.layer.tileInfo.lods,n=i.map((function(e){return e.scale})),a=Oe.Z.create({spatialReference:t,size:Ie.I_,scales:n}),s=t.isGeographic?.01*1e-5:.01;if(this._isCustomTilingScheme=Math.abs(a.origin.x-r.x)>s,(0===a.origin.x||a.origin.x>r.x)&&(a.origin=r),!this._isCustomTilingScheme){var o=Oe.Z.create({spatialReference:t,size:Ie.I_}).lods.map((function(e){return e.scale}));this._isCustomTilingScheme=n.some((function(e){return!o.some((function(t){return Math.abs(t-e)<.001}))}))}return e.set("tileInfo",a),void(this._srcResolutions=i.map((function(e){var t=e.resolution;return{x:t,y:t}})))}var u=(0,Ne.vF)(this.layer.rasterInfo,t,Ie.I_),l=u.scales,c=u.srcResolutions,h=u.isCustomTilingScheme,f=Oe.Z.create({spatialReference:t,size:Ie.I_,scales:l});(0===f.origin.x||f.origin.x>r.x)&&(f.origin=r),this._isCustomTilingScheme=h,e.set("tileInfo",f),this._srcResolutions=null!==c&&void 0!==c?c:[]}},{key:"_canUseLayerLODs",value:function(){var e,t=this.layer,r=this.layerView;if("Map"!==t.raster.tileType)return!1;var i=t.tileInfo.lods,n=null===(e=r.view.constraints)||void 0===e?void 0:e.effectiveLODs;if((null===n||void 0===n?void 0:n.length)!==i.length||!n.every((function(e,t){var r=e.scale;return Math.abs(r-i[t].scale)<.001})))return!1;for(var a=[],s=0;s<i.length-1;s++)a.push(Math.round(10*i[s].resolution/i[s+1].resolution)/10);return a.some((function(e){return e!==e[0]}))}},{key:"_computeFetchConcurrency",value:function(){var e=this.layer.rasterInfo.storageInfo.blockBoundary,t=e[e.length-1];return(t.maxCol-t.minCol+1)*(t.maxRow-t.minRow+1)>64?2:10}},{key:"_enqueueTileFetch",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.updatingHandles.addPromise(this._enqueueTileFetch1(t,r));case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_enqueueTileFetch1",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,o,u,l,c=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._fetchQueue.has(t.key.id)){e.next=30;break}return e.prev=1,e.next=4,this._fetchQueue.push(t.key);case 4:if(n=e.sent,a=this._getBandIds(),s=!this.useProgressiveUpdate||this.layerView.hasTilingEffects&&!this._globalSymbolizerParams,!this._globalUpdateRequested||this.layerView.moving||0!==this._fetchQueue.length){e.next=18;break}return s=!1,e.prev=9,e.next=12,this._redrawImage(null===(o=this._abortController)||void 0===o?void 0:o.signal);case 12:e.next=17;break;case 14:e.prev=14,e.t0=e.catch(9),(0,d.D_)(e.t0)&&h.Z.getLogger(this.declaredClass).error(e.t0);case 17:this._globalUpdateRequested=!1;case 18:return!this.canUseWebGLForProcessing()&&"rasterVF"!==this.type||this.layerView.hasTilingEffects||null!=this._symbolizerParams||this._updateSymbolizerParams(),u=this._tileInfoView.getTileCoords(He,t.key),l=this._tileInfoView.getTileResolution(t.key),e.next=22,this.updateTileSource(t,{source:n,symbolizerParams:this._symbolizerParams,globalSymbolizerParams:this._globalSymbolizerParams,suspended:s,bandIds:a,coords:u,resolution:l});case 22:t.once("attach",(function(){return c.layerView.requestUpdate()})),this.container.addChild(t),e.next=29;break;case 26:e.prev=26,e.t1=e.catch(1),(0,d.D_)(e.t1)||h.Z.getLogger(this.declaredClass).error(e.t1);case 29:this.layerView.requestUpdate();case 30:case"end":return e.stop()}}),e,this,[[1,26],[9,14]])})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_redrawImage",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,a=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==this.container.children.length){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.layer.updateRenderer();case 4:if(!this.layerView.hasTilingEffects){e.next=9;break}return e.next=7,this._updateGlobalSymbolizerParams(t);case 7:e.next=10;break;case 9:this._updateSymbolizerParams(),this._globalSymbolizerParams=null;case 10:return r=this.container.children.map(function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",a.updateTileSymbolizerParameters(t,{local:a._symbolizerParams,global:a._globalSymbolizerParams}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),e.next=13,(0,d.as)(r);case 13:this.container.requestRender();case 14:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateGlobalSymbolizerParams",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t){var r,n,a,s,o;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r={srcResolution:this._srcResolutions[this.previousLOD.level],registryId:this._blockCacheRegistryId,signal:t},e.next=3,this.layer.fetchPixels(this.layerView.view.extent,this.layerView.view.width,this.layerView.view.height,r);case 3:if((n=e.sent)&&n.pixelBlock){e.next=6;break}return e.abrupt("return");case 6:a=this.previousLOD.resolution,s=this._getBandIds(),o=this.layer.symbolizer.generateWebGLParameters({pixelBlock:(0,S.qF)(n.pixelBlock,s),isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:a,y:a},bandIds:s}),!this.canUseWebGLForProcessing()&&o&&"stretch"===o.type&&this.layer.renderer&&"raster-stretch"===this.layer.renderer.type&&(o.factor=o.factor.map((function(e){return 255*e})),o.outMin=Math.round(255*o.outMin),o.outMax=Math.round(255*o.outMax)),this._globalSymbolizerParams=o;case 8:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_updateSymbolizerParams",value:function(){var e=this.previousLOD.resolution,t=this._getBandIds();this._symbolizerParams=this.layer.symbolizer.generateWebGLParameters({pixelBlock:null,isGCS:this.layerView.view.spatialReference.isGeographic,resolution:{x:e,y:e},bandIds:t})}},{key:"_updateBlockCacheRegistry",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=this.layer,r=this.layerView,i=t.url,n=t.raster,a=t.normalizeRasterFetchOptions({multidimensionalDefinition:t.multidimensionalDefinition,timeExtent:r.timeExtent}).multidimensionalDefinition,s=n.rasterInfo.multidimensionalInfo?n.getSliceIndex(a):null,o=(0,Ae.Rq)(i,s);if(o!==this._blockCacheRegistryUrl){if(null!=this._blockCacheRegistryUrl&&(0,Ae.ET)(this._blockCacheRegistryUrl,this._blockCacheRegistryId),this._blockCacheRegistryId=(0,Ae.z2)(o,n.rasterInfo),e){var u=r.view,l=this._tileInfoView.getClosestInfoForScale(u.scale),c=this._srcResolutions[l.level];(0,Ae.Vx)(o,this._blockCacheRegistryId,u.extent,u.resolution,c,n.ioConfig.sampling)}this._blockCacheRegistryUrl=o}}},{key:"doRefresh",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(){var t,r=this;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.attached){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,this.layer.updateRenderer();case 4:return this.layerView.hasTilingEffects||this._updateSymbolizerParams(),this._updateBlockCacheRegistry(!0),this._fetchQueue.reset(),t=[],this._globalUpdateRequested=this.layerView.hasTilingEffects||!this.useProgressiveUpdate,this._tileStrategy.tiles.forEach((function(e){return t.push(r._enqueueTileFetch(e))})),e.next=12,(0,d.as)(t);case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()}]),r}(Ee.r);(0,l._)([(0,p.Cb)()],Je.prototype,"_fetchQueue",void 0),(0,l._)([(0,p.Cb)()],Je.prototype,"_globalUpdateRequested",void 0),(0,l._)([(0,p.Cb)()],Je.prototype,"attached",void 0),(0,l._)([(0,p.Cb)()],Je.prototype,"container",void 0),(0,l._)([(0,p.Cb)()],Je.prototype,"layer",void 0),(0,l._)([(0,p.Cb)()],Je.prototype,"layerView",void 0),(0,l._)([(0,p.Cb)()],Je.prototype,"type",void 0),(0,l._)([(0,p.Cb)()],Je.prototype,"useWebGLForProcessing",null),(0,l._)([(0,p.Cb)()],Je.prototype,"useProgressiveUpdate",null),(0,l._)([(0,p.Cb)()],Je.prototype,"timeExtent",void 0),(0,l._)([(0,p.Cb)()],Je.prototype,"updating",null),Je=(0,l._)([(0,m.j)("esri.views.2d.layers.imagery.BaseImageryTileSubView2D")],Je);var Xe=r(31666),Ke=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).type="raster",e}return(0,s.Z)(r,[{key:"attach",value:function(){(0,x.Z)((0,w.Z)(r.prototype),"attach",this).call(this),this.container=new Ve(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this.updateRasterFunctionParameters()}},{key:"detach",value:function(){(0,x.Z)((0,w.Z)(r.prototype),"detach",this).call(this),this.container.removeAllChildren(),this.container=null}},{key:"canUseWebGLForProcessing",value:function(){return this.useWebGLForProcessing&&this.layer.symbolizer.canRenderInWebGL&&!("majority"===this.layer.interpolation&&(0,Xe.JV)(this.layer))}},{key:"fetchTile",value:function(e,t){return this.layer.fetchTile(e.level,e.row,e.col,t)}},{key:"updateRasterFunctionParameters",value:function(){var e=this.layer,t=e.raster,r=e.type,i=this.container;if("Function"!==t.datasetFormat||"wcs"===r)return i.rasterFunctionChain=null,i.children.forEach((function(e){var t=e.bitmap;t&&(t.suspended=!0,t.processed=!1,t.projected&&(t.invalidateTexture(),t.rasterTexture=null))})),void(this._rasterFunctionState="na");var n=this._rasterFunctionState,a=t.rasterFunction,s=t.primaryRasters,o=a.supportsGPU&&(!s||s.rasters.length<=1),u=o?a.getFlatWebGLFunctionChain():null,l=this.layer.renderer,c=!o||!(null!==u&&void 0!==u&&u.functions.length)||"raster-stretch"===l.type&&l.dynamicRangeAdjustment||!this.canUseWebGLForProcessing();i.rasterFunctionChain=c?null:u;var h=null==a?"na":i.rasterFunctionChain?"gpu":"cpu";i.children.forEach((function(e){var t=e.bitmap;t&&(t.suspended=n!==h,t.processed=!1,t.processedTexture=null)})),this._rasterFunctionState=h}},{key:"updateTileSource",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,o,u,l,c,h,d,v,p,m,y,g;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(a=this._getBandIds(),s=this._getLayerInterpolation(),o=this.canUseWebGLForProcessing(),u=r.source,l=r.globalSymbolizerParams,c=r.suspended,h=r.coords,d=r.resolution,v=this.layerView.hasTilingEffects?l:r.symbolizerParams,p=t.bitmap,n=(0,b.Z)(h,2),p.x=n[0],p.y=n[1],p.resolution=d,!(u&&(0,f.pC)(u)&&(0,f.pC)(u.pixelBlock))){e.next=14;break}if(m={extent:u.extent,pixelBlock:u.pixelBlock},p.rawPixelData=m,!o){e.next=7;break}p.source=u.pixelBlock,p.isRendereredSource=!1,e.next=11;break;case 7:return e.next=9,this.layer.applyRenderer(m,"stretch"===(null===l||void 0===l?void 0:l.type)?l:void 0);case 9:y=e.sent,p.source=y,p.isRendereredSource=!0;case 11:p.symbolizerParameters=o?v:null,o?p.transformGrid||(p.transformGrid=u.transformGrid):p.transformGrid=null,e.next=16;break;case 14:g=this.createEmptyTilePixelBlock(),p.source=g,p.symbolizerParameters=o?v:null,p.transformGrid=null;case 16:p.bandIds=o?a:null,p.width=this._tileInfoView.tileInfo.size[0],p.height=this._tileInfoView.tileInfo.size[1],p.interpolation=s,p.suspended=c,p.invalidateTexture();case 17:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateTileSymbolizerParameters",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,o,u,l,c;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=r.local,a=r.global,s=this._getBandIds(),o=this._getLayerInterpolation(),u=this.canUseWebGLForProcessing(),l=t.bitmap,c=l.rawPixelData,u||!(0,f.pC)(c)){e.next=8;break}return e.next=4,this.layer.applyRenderer(c,"stretch"===(null===a||void 0===a?void 0:a.type)?a:void 0);case 4:l.source=e.sent,l.isRendereredSource=!0,e.next=9;break;case 8:l.isRendereredSource&&(0,f.pC)(c)&&(l.source=c.pixelBlock),l.isRendereredSource=!1;case 9:l.symbolizerParameters=u?this.layerView.hasTilingEffects?a:n:null,l.bandIds=u?s:null,l.interpolation=o,l.suspended=!1;case 13:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"_getLayerInterpolation",value:function(){var e=this.layer.renderer.type;if("raster-colormap"===e||"unique-value"===e||"class-breaks"===e)return"nearest";var t=this.layer.interpolation,r=this.layer.renderer;return"raster-stretch"===r.type&&null!=r.colorRamp?"bilinear"===t||"cubic"===t?"bilinear":"nearest":t}}]),r}(Je);(0,l._)([(0,p.Cb)()],Ke.prototype,"container",void 0),(0,l._)([(0,p.Cb)()],Ke.prototype,"layer",void 0),(0,l._)([(0,p.Cb)()],Ke.prototype,"type",void 0);var $e=Ke=(0,l._)([(0,m.j)("esri.views.2d.layers.imagery.ImageryTileView2D")],Ke),et=r(64145),tt=r(57874),rt=r(60831),it=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(e,i,n,s,o,u){var l,c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;return(0,a.Z)(this,r),(l=t.call(this,e,i,n,s,o,u)).tileData=new rt.F(c),l.tileData.coordScale=[o,u],l.tileData.once("isReady",(function(){return l.ready()})),l}return(0,s.Z)(r,[{key:"destroy",value:function(){(0,x.Z)((0,w.Z)(r.prototype),"destroy",this).call(this),this.tileData.destroy(),this.tileData=null,this.stage=null}},{key:"stencilRef",get:function(){return this.tileData.stencilRef},set:function(e){this.tileData.stencilRef=e}},{key:"_createTransforms",value:function(){return{dvs:(0,Z.c)(),tileMat3:(0,Z.c)()}}},{key:"setTransform",value:function(e){(0,x.Z)((0,w.Z)(r.prototype),"setTransform",this).call(this,e);var t=this.resolution/(e.resolution*e.pixelRatio),i=this.transforms.tileMat3,n=(0,b.Z)(this.tileData.offset,2),a=n[0],s=n[1],o=[this.x+a*this.resolution,this.y-s*this.resolution],u=e.toScreenNoRotation([0,0],o),l=(0,b.Z)(u,2),c=l[0],h=l[1],f=this.tileData.symbolizerParameters.symbolTileSize,d=Math.round((this.width-this.tileData.offset[0])/f)*f,v=Math.round((this.height-this.tileData.offset[1])/f)*f,p=d/this.rangeX*t,m=v/this.rangeY*t;(0,I.s)(i,p,0,0,0,m,0,c,h,1),(0,I.m)(this.transforms.dvs,e.displayViewMat3,i),this.tileData.transforms.dvs=this.transforms.dvs}},{key:"onAttach",value:function(){this.tileData.stage=this.stage}},{key:"onDetach",value:function(){this.tileData.stage=null}}]),r}(Fe.I),nt=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments)).isCustomTilingScheme=!1,e.symbolTypes=["triangle"],e}return(0,s.Z)(r,[{key:"createTile",value:function(e){var t=this._tileInfoView.getTileBounds((0,k.Ue)(),e),r=(0,b.Z)(this._tileInfoView.tileInfo.size,2),i=r[0],n=r[1],a=this._tileInfoView.getTileResolution(e.level);return new it(e,a,t[0],t[3],i,n)}},{key:"prepareRenderPasses",value:function(e){var t=this,i=e.registerRenderPass({name:"imagery (vf tile)",brushes:[tt.Z],target:function(){return t.children.map((function(e){return e.tileData}))},drawPhase:ze.jx.MAP});return[].concat((0,T.Z)((0,x.Z)((0,w.Z)(r.prototype),"prepareRenderPasses",this).call(this,e)),[i])}},{key:"doRender",value:function(e){var t=this;this.visible&&e.drawPhase===ze.jx.MAP&&this.symbolTypes.forEach((function(i){e.renderPass=i,(0,x.Z)((0,w.Z)(r.prototype),"doRender",t).call(t,e)}))}}]),r}(De.Z),at=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._handle=null,e.type="rasterVF",e}return(0,s.Z)(r,[{key:"canUseWebGLForProcessing",value:function(){return!1}},{key:"fetchTile",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=(0,C.Z)((0,C.Z)({},r),{},{interpolation:"nearest",requestProjectedLocalDirections:!0}),e.next=3,this.layer.fetchTile(t.level,t.row,t.col,r);case 3:if(n=e.sent,e.t0="vector-magdir"===this.layer.rasterInfo.dataType&&null!==n&&void 0!==n&&n.pixelBlock,!e.t0){e.next=9;break}return e.next=8,this.layer.convertVectorFieldData(n.pixelBlock,r);case 8:n.pixelBlock=e.sent;case 9:return e.abrupt("return",n);case 10:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"updateTileSource",value:function(e,t){var r=t.symbolizerParams,i=e.tileData;i.key=e.key,i.width=this._tileInfoView.tileInfo.size[0],i.height=this._tileInfoView.tileInfo.size[1];var n=r.symbolTileSize,a=t.source;if(i.offset=this._getTileSymbolOffset(i.key,n),(0,f.pC)(a)&&(0,f.pC)(a.pixelBlock)){var s={extent:a.extent,pixelBlock:a.pixelBlock};i.rawPixelData=s,i.symbolizerParameters=r,i.source=this._sampleVectorFieldData(a.pixelBlock,r,i.offset)}else{var o=[Math.round((this._tileInfoView.tileInfo[0]-i.offset[0])/n),Math.round((this._tileInfoView.tileInfo[1]-i.offset[1])/n)],u=this.createEmptyTilePixelBlock(o);i.source=u,i.symbolizerParameters=r}return i.invalidateVAO(),Promise.resolve()}},{key:"updateTileSymbolizerParameters",value:function(e,t){var r,i=t.local,n=i.symbolTileSize,a=e.tileData;a.offset=this._getTileSymbolOffset(a.key,n);var s=a.symbolizerParameters.symbolTileSize;a.symbolizerParameters=i;var o=null===(r=a.rawPixelData)||void 0===r?void 0:r.pixelBlock;return(0,f.pC)(o)&&s!==n&&(a.source=this._sampleVectorFieldData(o,a.symbolizerParameters,a.offset)),Promise.resolve()}},{key:"attach",value:function(){var e=this;(0,x.Z)((0,w.Z)(r.prototype),"attach",this).call(this),this.container=new nt(this._tileInfoView),this.container.isCustomTilingScheme=this._isCustomTilingScheme,this._updateSymbolType(this.layer.renderer),this._handle=(0,v.YP)((function(){return e.layer.renderer}),(function(t){return e._updateSymbolType(t)}))}},{key:"detach",value:function(){var e;(0,x.Z)((0,w.Z)(r.prototype),"detach",this).call(this),this.container.removeAllChildren(),null!==(e=this._handle)&&void 0!==e&&e.remove(),this._handle=null,this.container=null}},{key:"_getTileSymbolOffset",value:function(e,t){var r=e.col*this._tileInfoView.tileInfo.size[0]%t,i=e.row*this._tileInfoView.tileInfo.size[1]%t;return[r>t/2?t-r:-r,i>t/2?t-i:-i]}},{key:"_sampleVectorFieldData",value:function(e,t,r){var i=t.symbolTileSize;return(0,et.nb)(e,"vector-uv",i,r)}},{key:"_updateSymbolType",value:function(e){"vector-field"===e.type&&(this.container.symbolTypes="wind-barb"===e.style?["scalar","triangle"]:"simple-scalar"===e.style?["scalar"]:["triangle"])}}]),r}(Je);(0,l._)([(0,p.Cb)()],at.prototype,"container",void 0),(0,l._)([(0,p.Cb)()],at.prototype,"layer",void 0),(0,l._)([(0,p.Cb)()],at.prototype,"type",void 0);var st=at=(0,l._)([(0,m.j)("esri.views.2d.layers.imagery.VectorFieldTileView2D")],at),ot=r(55245),ut=r(67581),lt=r(13107),ct=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._useWebGLForProcessing=!0,e._useProgressiveUpdate=!0,e.subview=null,e}return(0,s.Z)(r,[{key:"useWebGLForProcessing",get:function(){return this._useWebGLForProcessing},set:function(e){this._useWebGLForProcessing=e,this.subview&&"useWebGLForProcessing"in this.subview&&(this.subview.useWebGLForProcessing=e)}},{key:"useProgressiveUpdate",get:function(){return this._useWebGLForProcessing},set:function(e){this._useProgressiveUpdate=e,this.subview&&"useProgressiveUpdate"in this.subview&&(this.subview.useProgressiveUpdate=e)}},{key:"update",value:function(e){var t;null!==(t=this.subview)&&void 0!==t&&t.update(e),this.notifyChange("updating")}},{key:"isUpdating",value:function(){return!this.subview||this.subview.updating}},{key:"attach",value:function(){var e=this;this.layer.increaseRasterJobHandlerUsage(),this._updateSubview(),this.addAttachHandles([(0,v.YP)((function(){var t=e.layer;return{bandIds:t.bandIds,renderer:t.renderer,interpolation:t.interpolation,multidimensionalDefinition:t.multidimensionalDefinition,rasterFunction:"imagery-tile"===t.type?t.rasterFunction:null}}),(function(t,r){var i,n,a=t.interpolation!==(null===r||void 0===r?void 0:r.interpolation)&&("majority"===t.interpolation||"majority"===(null===r||void 0===r?void 0:r.interpolation))&&(0,Xe.JV)(e.layer),s=t.renderer!==(null===r||void 0===r?void 0:r.renderer)&&(null===r||void 0===r||null===(i=r.renderer)||void 0===i?void 0:i.type)!==(null===(n=t.renderer)||void 0===n?void 0:n.type);s&&e._updateSubview();var o=t.multidimensionalDefinition!==(null===r||void 0===r?void 0:r.multidimensionalDefinition),u=t.rasterFunction!==(null===r||void 0===r?void 0:r.rasterFunction),l=u&&!e._useWebGLForProcessing,c=o||a||s||l;e.subview.redrawOrRefetch({refetch:c,reprocess:u}).catch((function(t){(0,d.D_)(t)||h.Z.getLogger(e.declaredClass).error(t)})),e.notifyChange("updating")})),(0,v.YP)((function(){var t;return null!==(t=e.layer.blendMode)&&void 0!==t?t:"normal"}),(function(t){e.subview.container.blendMode=t}),v.tX),(0,v.YP)((function(){var t;return null!==(t=e.layer.effect)&&void 0!==t?t:null}),(function(t){e.subview.container.effect=t}),v.tX),(0,v.YP)((function(){var t;return null!==(t=e.layer.multidimensionalSubset)&&void 0!==t?t:null}),(function(t,r){var i=e.layer.multidimensionalDefinition;(0,f.pC)(i)&&(0,y.nb)(i,t)!==(0,y.nb)(i,r)&&(e.subview.redrawOrRefetch({refetch:!0}).catch((function(t){(0,d.D_)(t)||h.Z.getLogger(e.declaredClass).error(t)})),e.notifyChange("updating"))}),v.Z_),(0,v.YP)((function(){return e.timeExtent}),(function(){e.subview.timeExtent=e.timeExtent,e.subview.redrawOrRefetch({refetch:!0}).catch((function(t){(0,d.D_)(t)||h.Z.getLogger(e.declaredClass).error(t)}))}),v.nn)])}},{key:"detach",value:function(){var e;this.layer.decreaseRasterJobHandlerUsage(),this._detachSubview(this.subview),null!==(e=this.subview)&&void 0!==e&&e.destroy(),this.subview=null}},{key:"moveStart",value:function(){this.requestUpdate()}},{key:"viewChange",value:function(){this.requestUpdate()}},{key:"moveEnd",value:function(){this.subview.moveEnd()}},{key:"hitTest",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",[{type:"graphic",layer:this.layer,mapPoint:t,graphic:new c.Z({attributes:{},geometry:t.clone()})}]);case 1:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()},{key:"doRefresh",value:function(){return this.subview?this.subview.doRefresh():Promise.resolve()}},{key:"_updateSubview",value:function(){var e="vector-field"===this.layer.renderer.type?"rasterVF":"flow"===this.layer.renderer.type?"flow":"raster";if(this.subview){var t;if(this.subview.type===e)return void this._attachSubview(this.subview);this._detachSubview(this.subview),null!==(t=this.subview)&&void 0!==t&&t.destroy(),this.subview=null}var r,i=this.layer;if("useWebGLForProcessing"in(r="rasterVF"===e?new st({layer:i,layerView:this}):"flow"===e?new g.Z({layer:i,layerView:this}):new $e({layer:i,layerView:this}))&&(r.useWebGLForProcessing=this._useWebGLForProcessing),"useProgressiveUpdate"in r&&(r.useProgressiveUpdate=this._useProgressiveUpdate),"previousLOD"in r){var n=this.subview;r.previousLOD=n&&"previousLOD"in n?n.previousLOD:null}this._attachSubview(r),this.subview=r,this.requestUpdate()}},{key:"_attachSubview",value:function(e){e&&!e.attached&&(e.attach(),e.attached=!0,this.container.addChildAt(e.container,0),e.container.blendMode=this.layer.blendMode,e.container.effect=this.layer.effect)}},{key:"_detachSubview",value:function(e){(null===e||void 0===e?void 0:e.attached)&&(this.container.removeChild(e.container),e.detach(),e.attached=!1)}}]),r}((0,ot.Z)((0,lt.Z)((0,_.y)(ut.Z))));(0,l._)([(0,p.Cb)()],ct.prototype,"subview",void 0),(0,l._)([(0,p.Cb)()],ct.prototype,"useWebGLForProcessing",null),(0,l._)([(0,p.Cb)()],ct.prototype,"useProgressiveUpdate",null);var ht=ct=(0,l._)([(0,m.j)("esri.views.2d.layers.ImageryTileLayerView2D")],ct)},31666:function(e,t,r){r.d(t,{JV:function(){return a},oq:function(){return n}});var i=new(r(43404).X)({esriGeometryPoint:"point",esriGeometryMultipoint:"multipoint",esriGeometryPolyline:"polyline",esriGeometryPolygon:"polygon",esriGeometryMultiPatch:"multipatch",mesh:"mesh"});function n(e){return i.toJSON(e)}function a(e){var t=e.raster.rasterInfo,r=t.bandCount,i=t.attributeTable,n=t.colormap,a=t.pixelType;return 1===r&&(null!=i||null!=n||"u8"===a||"s8"===a)}},55245:function(e,t,r){r.d(t,{Z:function(){return g}});var i=r(74165),n=r(15861),a=r(15671),s=r(43144),o=r(60136),u=r(29388),l=r(27366),c=r(52639),h=r(10064),f=r(92026),d=r(49861),v=(r(25243),r(63780),r(69912)),p=r(45948),m=r(80394),y=r(24405),g=function(e){var t=function(e){(0,o.Z)(r,e);var t=(0,u.Z)(r);function r(){var e;return(0,a.Z)(this,r),(e=t.apply(this,arguments))._rasterFieldPrefix="Raster.",e.layer=null,e.view=null,e.tileInfo=null,e}return(0,s.Z)(r,[{key:"fullExtent",get:function(){return this._getfullExtent()}},{key:"_getfullExtent",value:function(){return this.projectFullExtent(this.view.spatialReference)}},{key:"hasTilingEffects",get:function(){return this.layer.renderer&&"dynamicRangeAdjustment"in this.layer.renderer&&this.layer.renderer.dynamicRangeAdjustment}},{key:"datumTransformation",get:function(){return(0,m._D)((0,f.Wg)(this.layer.fullExtent),this.view.spatialReference,!0)}},{key:"supportsSpatialReference",value:function(e){return!!this.projectFullExtent(e)}},{key:"projectFullExtent",value:function(e){var t=(0,f.Wg)(this.layer.fullExtent),r=(0,m._D)(t,e,!1);return(0,m.tB)(t,e,r)}},{key:"fetchPopupFeatures",value:function(){var e=(0,n.Z)((0,i.Z)().mark((function e(t,r){var n,a,s,o,u,l,d,v,p,m,g,_,b,x,w,T,k;return(0,i.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=this.layer,t){e.next=3;break}throw new h.Z("imageryTileLayerView:fetchPopupFeatures","Nothing to fetch without area",{layer:n});case 3:if(a=n.popupEnabled,s=(0,y.V)(n,r),a&&!(0,f.Wi)(s)){e.next=6;break}throw new h.Z("imageryTileLayerView:fetchPopupFeatures","Missing required popupTemplate or popupEnabled",{popupEnabled:a,popupTemplate:s});case 6:return o=[],e.next=9,n.identify(t,{timeExtent:this.timeExtent});case 9:if(u=e.sent,l=u.value,d=u.magdirValue,v="",l&&l.length){if(v="imagery-tile"===n.type&&n.hasStandardTime()&&null!=l[0]?l.map((function(e){return n.getStandardTimeValue(e)})).join(", "):l.join(", "),(p={ObjectId:0})["Raster.ServicePixelValue"]=v,m=n.rasterInfo.attributeTable,(0,f.pC)(m)&&(g=m.fields,_=m.features,b=g.find((function(e){return"value"===e.name.toLowerCase()})),x=b?_.find((function(e){return String(e.attributes[b.name])===v})):null,x))for(w in x.attributes)x.attributes.hasOwnProperty(w)&&(p[this._rasterFieldPrefix+w]=x.attributes[w]);"vector-magdir"!==(T=n.rasterInfo.dataType)&&"vector-uv"!==T||(p["Raster.Magnitude"]=null===d||void 0===d?void 0:d[0],p["Raster.Direction"]=null===d||void 0===d?void 0:d[1]),(k=new c.Z(this.fullExtent.clone(),null,p)).layer=n,k.sourceLayer=k.layer,o.push(k)}return e.abrupt("return",o);case 15:case"end":return e.stop()}}),e,this)})));return function(t,r){return e.apply(this,arguments)}}()}]),r}(e);return(0,l._)([(0,d.Cb)()],t.prototype,"layer",void 0),(0,l._)([(0,d.Cb)(p.qG)],t.prototype,"timeExtent",void 0),(0,l._)([(0,d.Cb)()],t.prototype,"view",void 0),(0,l._)([(0,d.Cb)()],t.prototype,"fullExtent",null),(0,l._)([(0,d.Cb)()],t.prototype,"tileInfo",void 0),(0,l._)([(0,d.Cb)({readOnly:!0})],t.prototype,"hasTilingEffects",null),(0,l._)([(0,d.Cb)()],t.prototype,"datumTransformation",null),t=(0,l._)([(0,v.j)("esri.views.layers.ImageryTileLayerView")],t)}}}]);
//# sourceMappingURL=3095.191ed730.chunk.js.map