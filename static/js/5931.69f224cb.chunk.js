"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5931],{34785:function(e,t,r){r.d(t,{W:function(){return v}});var n=r(29439),a=r(74165),u=r(15861),s=r(15671),i=r(43144),o=r(19545),c=r(76200),l=r(92026),p=r(66978),d=r(64326),f=r(70032),h=r(98995),v=function(){function e(t,r,n,a){var u;(0,s.Z)(this,e),this._parsedUrl=t,this._portalItem=r,this._apiKey=n,this.signal=a,this._rootDocument=null;var i=null===(u=this._parsedUrl)||void 0===u?void 0:u.path.match(/^(.*)\/SceneServer\/layers\/([\d]*)\/?$/i);i&&(this._urlParts={root:i[1],layerId:parseInt(i[2],10)})}return(0,i.Z)(e,[{key:"fetch",value:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(){var t,r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._urlParts){e.next=2;break}return e.abrupt("return",null);case 2:if(null===(t=this._portalItem)||void 0===t){e.next=6;break}e.t0=t,e.next=9;break;case 6:return e.next=8,this._portalItemFromServiceItemId();case 8:e.t0=e.sent;case 9:if(r=e.t0,!(0,l.Wi)(r)){e.next=12;break}return e.abrupt("return",this._loadFromUrl());case 12:return e.next=14,this._findAndLoadRelatedPortalItem(r);case 14:return n=e.sent,e.abrupt("return",(0,l.Wi)(n)?null:this._loadFeatureLayerFromPortalItem(n));case 16:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"fetchPortalItem",value:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(){var t,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this._urlParts){e.next=2;break}return e.abrupt("return",null);case 2:if(null===(t=this._portalItem)||void 0===t){e.next=6;break}e.t0=t,e.next=9;break;case 6:return e.next=8,this._portalItemFromServiceItemId();case 8:e.t0=e.sent;case 9:return r=e.t0,e.abrupt("return",(0,l.Wi)(r)?null:this._findAndLoadRelatedPortalItem(r));case 11:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_fetchRootDocument",value:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(){var t,r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(0,l.pC)(this._rootDocument)){e.next=2;break}return e.abrupt("return",this._rootDocument);case 2:if(!(0,l.Wi)(this._urlParts)){e.next=4;break}return e.abrupt("return",(this._rootDocument={},{}));case 4:return t={query:{f:"json",token:this._apiKey},responseType:"json",signal:this.signal},r="".concat(this._urlParts.root,"/SceneServer"),e.prev=5,e.next=8,(0,c.default)(r,t);case 8:n=e.sent,this._rootDocument=n.data,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),this._rootDocument={};case 15:return e.abrupt("return",this._rootDocument);case 16:case"end":return e.stop()}}),e,this,[[5,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"_fetchServiceOwningPortalUrl",value:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(){var t,r,n,u,s;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=null===(t=this._parsedUrl)||void 0===t?void 0:t.path,null===(n=r?null===o.id||void 0===o.id?void 0:o.id.findServerInfo(r):null)||void 0===n||!n.owningSystemUrl){e.next=3;break}return e.abrupt("return",n.owningSystemUrl);case 3:return u=r?r.replace(/(.*\/rest)\/.*/i,"$1")+"/info":null,e.prev=4,e.next=7,(0,c.default)(u,{query:{f:"json"},responseType:"json",signal:this.signal});case 7:if(!(s=e.sent.data.owningSystemUrl)){e.next=10;break}return e.abrupt("return",s);case 10:e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),(0,p.r9)(e.t0);case 15:return e.abrupt("return",null);case 16:case"end":return e.stop()}}),e,this,[[4,12]])})));return function(){return e.apply(this,arguments)}}()},{key:"_findAndLoadRelatedPortalItem",value:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(t){return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,t.fetchRelatedItems({relationshipType:"Service2Service",direction:"reverse"},{signal:this.signal});case 3:if(e.t0=e.sent.find((function(e){return"Feature Service"===e.type})),e.t0){e.next=6;break}e.t0=null;case 6:return e.abrupt("return",e.t0);case 9:return e.prev=9,e.t1=e.catch(0),e.abrupt("return",((0,p.r9)(e.t1),null));case 12:case"end":return e.stop()}}),e,this,[[0,9]])})));return function(t){return e.apply(this,arguments)}}()},{key:"_loadFeatureLayerFromPortalItem",value:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(t){var r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.load({signal:this.signal});case 2:return e.next=4,this._findMatchingAssociatedSublayerUrl(null!==(r=t.url)&&void 0!==r?r:"");case 4:return n=e.sent,e.abrupt("return",new d.default({url:n,portalItem:t}).load({signal:this.signal}));case 6:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_loadFromUrl",value:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(){var t,r;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._findMatchingAssociatedSublayerUrl("".concat(null===(t=this._urlParts)||void 0===t?void 0:t.root,"/FeatureServer"));case 2:return r=e.sent,e.abrupt("return",new d.default({url:r}).load({signal:this.signal}));case 4:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"_findMatchingAssociatedSublayerUrl",value:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(t){var r,u,s,i,o,l,p,d,f,h,v,b,m;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return u=t.replace(/^(.*FeatureServer)(\/[\d]*\/?)?$/i,"$1"),s={query:{f:"json"},responseType:"json",authMode:"no-prompt",signal:this.signal},i=null===(r=this._urlParts)||void 0===r?void 0:r.layerId,o=this._fetchRootDocument(),l=(0,c.default)(u,s),e.next=7,Promise.all([l,o]);case 7:if(p=e.sent,d=(0,n.Z)(p,2),f=d[0],h=d[1],v=h&&h.layers,b=f.data&&f.data.layers,Array.isArray(b)){e.next=15;break}throw new Error("expected layers array");case 15:if(!Array.isArray(v)){e.next=25;break}m=0;case 17:if(!(m<Math.min(v.length,b.length))){e.next=23;break}if(v[m].id!==i){e.next=20;break}return e.abrupt("return","".concat(u,"/").concat(b[m].id));case 20:m++,e.next=17;break;case 23:e.next=27;break;case 25:if(!(null!=i&&i<b.length)){e.next=27;break}return e.abrupt("return","".concat(u,"/").concat(b[i].id));case 27:throw new Error("could not find matching associated sublayer");case 28:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_portalItemFromServiceItemId",value:function(){var e=(0,u.Z)((0,a.Z)().mark((function e(){var t,r,n;return(0,a.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this._fetchRootDocument();case 2:if(t=e.sent.serviceItemId){e.next=5;break}return e.abrupt("return",null);case 5:return r=new h.default({id:t,apiKey:this._apiKey}),e.next=8,this._fetchServiceOwningPortalUrl();case 8:return n=e.sent,(0,l.pC)(n)&&(r.portal=new f.Z({url:n})),e.prev=10,e.abrupt("return",r.load({signal:this.signal}));case 14:return e.prev=14,e.t0=e.catch(10),e.abrupt("return",((0,p.r9)(e.t0),null));case 17:case"end":return e.stop()}}),e,this,[[10,14]])})));return function(){return e.apply(this,arguments)}}()}]),e}()},24405:function(e,t,r){r.d(t,{V:function(){return l},e:function(){return o}});var n=r(74165),a=r(93433),u=r(15861),s=r(92026),i=r(80031);function o(e){return c.apply(this,arguments)}function c(){return c=(0,u.Z)((0,n.Z)().mark((function e(t){var r,u,o,c,l,p,d,f,h,v,b,m=arguments;return(0,n.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=m.length>1&&void 0!==m[1]?m[1]:t.popupTemplate,!(0,s.Wi)(o)){e.next=3;break}return e.abrupt("return",[]);case 3:return e.next=5,o.getRequiredFields(t.fieldsIndex);case 5:if(c=e.sent,l=o.lastEditInfoEnabled,p=t.objectIdField,d=t.typeIdField,f=t.globalIdField,h=t.relationships,!c.includes("*")){e.next=13;break}return e.abrupt("return",["*"]);case 13:if(!l){e.next=19;break}return e.next=16,(0,i.CH)(t);case 16:e.t0=e.sent,e.next=20;break;case 19:e.t0=[];case 20:return v=e.t0,b=(0,i.Q0)(t.fieldsIndex,[].concat((0,a.Z)(c),(0,a.Z)(v))),e.abrupt("return",(d&&b.push(d),b&&p&&null!==(r=t.fieldsIndex)&&void 0!==r&&r.has(p)&&!b.includes(p)&&b.push(p),b&&f&&null!==(u=t.fieldsIndex)&&void 0!==u&&u.has(f)&&!b.includes(f)&&b.push(f),h&&h.forEach((function(e){var r,n=e.keyField;b&&n&&(null===(r=t.fieldsIndex)||void 0===r?void 0:r.has(n))&&!b.includes(n)&&b.push(n)})),b));case 23:case"end":return e.stop()}}),e)}))),c.apply(this,arguments)}function l(e,t){return e.popupTemplate?e.popupTemplate:(0,s.pC)(t)&&t.defaultPopupTemplateEnabled&&(0,s.pC)(e.defaultPopupTemplate)?e.defaultPopupTemplate:null}}}]);
//# sourceMappingURL=5931.69f224cb.chunk.js.map