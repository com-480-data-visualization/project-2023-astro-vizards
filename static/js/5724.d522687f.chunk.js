"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5724],{25810:function(e,t,n){n.d(t,{Z:function(){return m}});var i=n(43144),r=n(15671),a=n(60136),o=n(29388),s=n(27366),l=(n(59486),n(48805)),u=n(11582),c=n(17768),d=n(46784),p=n(49861),h=n(89125),f=(n(63780),n(69912)),v=n(25243),y=n(585),g=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,r.Z)(this,n),(i=t.call(this,e)).type="length",i.startPoint=null,i.endPoint=null,i.measureType=l.n.Direct,i.offset=0,i.orientation=0,i}return(0,i.Z)(n)}((0,d.eC)(u.j));(0,s._)([(0,p.Cb)({type:["length"],json:{write:{isRequired:!0}}})],g.prototype,"type",void 0),(0,s._)([(0,p.Cb)({type:y.Z,json:{write:!0}})],g.prototype,"startPoint",void 0),(0,s._)([(0,p.Cb)({type:y.Z,json:{write:!0}})],g.prototype,"endPoint",void 0),(0,s._)([(0,p.Cb)({type:l.V,nonNullable:!0,json:{write:{isRequired:!0}}})],g.prototype,"measureType",void 0),(0,s._)([(0,p.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}})],g.prototype,"offset",void 0),(0,s._)([(0,p.Cb)({type:Number,nonNullable:!0,json:{write:{isRequired:!0}}}),(0,h.p)((function(e){return c.BV.normalize((0,v.q9)(e),0,!0)}))],g.prototype,"orientation",void 0);var m=g=(0,s._)([(0,f.j)("esri.analysis.LengthDimension")],g)},48805:function(e,t,n){var i;n.d(t,{V:function(){return r},n:function(){return i}}),function(e){e.Horizontal="horizontal",e.Vertical="vertical",e.Direct="direct"}(i||(i={}));var r=[i.Horizontal,i.Vertical,i.Direct]},65724:function(e,t,n){n.r(t),n.d(t,{default:function(){return zr}});var i,r=n(74165),a=n(15861),o=n(37762),s=n(15671),l=n(43144),u=n(60136),c=n(29388),d=n(27366),p=n(85015),h=n(80987),f=n(32718),v=n(92026),y=n(94172),g=n(49861),m=(n(25243),n(63780),n(69912)),_=n(98074),S=n(48805),w=n(100),C=n(68860),b=n(74177),k=n(29439),Z=n(16889),P=n(47898),D=n(14226),x=n(81949),M=n(11186),A=n(71353),E=n(14320),R=n(51378),T=n(65618),O=n(37818),L=n(9052),z=n(79803),G=n(92975),H=n(25003);function V(e,t,n){var r=W(e,t,n,i.Direct);return(0,v.pC)(r)?(0,P.yG)(r.direct,r.unit):null}function W(e,t,n,r){var a=(0,H.m)(n),o=(0,C.j5)(a);if((0,v.Wi)(o))return null;var s=t[2]-e[2];if(r===i.Vertical)return{verticalSigned:s,unit:o};if(!(0,z.SH)(e,n,N,a)||!(0,z.SH)(t,n,q,a))return null;if(r===i.Direct)return{direct:(0,M.i)(q,N),unit:o};if((0,M.s)(U,e[0],e[1],t[2]),!(0,z.SH)(U,n,U,a))return null;var l=(0,M.i)(U,q);return r===i.Horizontal?{horizontal:l,unit:o}:{direct:(0,M.i)(q,N),horizontal:l,vertical:Math.abs(s),unit:o}}!function(e){e[e.Direct=0]="Direct",e[e.Horizontal=1]="Horizontal",e[e.Vertical=2]="Vertical"}(i||(i={}));var I,F=(0,A.c)(),j=(0,A.c)(),N=(0,A.c)(),q=(0,A.c)(),U=(0,A.c)();function B(e){var t=e.elevationAlignedStartPoint,n=e.elevationAlignedEndPoint,i=e.dimension;return{elevationAlignedStartPoint:t,elevationAlignedEndPoint:n,offset:i.offset,measureType:i.measureType,orientation:i.orientation}}function Q(e,t){var n=e.elevationAlignedStartPoint,i=e.elevationAlignedEndPoint,r=e.offset,a=e.measureType,o=e.orientation,s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;if((0,v.Wi)(n)||(0,v.Wi)(i))return null;var l=J((0,v.pC)(s)?s.directSegment:new L.y,{elevationAlignedStartPoint:n,elevationAlignedEndPoint:i},t),u=(0,v.pC)(s)?s.primaryOffsetAxis:(0,A.c)();ee(u,{measureType:a,elevationAlignedStartPoint:n,elevationAlignedEndPoint:i,directSegment:l,orientation:o,renderCoordsHelper:t});var c=(0,v.pC)(s)?s.dimensionSegment:new L.y;return ne({elevationAlignedStartPoint:n,elevationAlignedEndPoint:i})&&a===S.n.Vertical?((0,M.c)(c.startRenderSpace,l.startRenderSpace),(0,M.c)(c.endRenderSpace,l.endRenderSpace)):ie(c,{offsetAxis:u,offset:r,relativeToSegment:l,renderCoordsHelper:t}),{directSegment:l,dimensionSegment:c,primaryOffsetAxis:u,spatialReference:t.spatialReference}}function Y(e,t,n,i){return t===I.Start?((0,M.c)(e.startRenderSpace,n.startRenderSpace),(0,M.c)(e.endRenderSpace,i.startRenderSpace)):((0,M.c)(e.startRenderSpace,n.endRenderSpace),(0,M.c)(e.endRenderSpace,i.endRenderSpace)),e}function X(e,t,n,i){switch(t){case S.n.Direct:return J(e,n,i);case S.n.Horizontal:case S.n.Vertical:var r,a=n.elevationAlignedStartPoint,o=n.elevationAlignedEndPoint,s=n.dimension,l=n.geometry;s.measureType===S.n.Direct?(r=function(e,t){var n=e.directSegment.eval(.5,R.WM.get()),i=t.worldUpAtPosition(n,R.WM.get()),r=e.dimensionSegment.eval(.5,R.WM.get()),a=(0,M.w)(R.WM.get(),r,n);return!(0,M.F)(a,A.Z)&&(0,M.e)(a,i)>0}(l,i)===a.z>o.z,t===S.n.Horizontal&&(r=!r)):r=!function(e){var t=e.dimensionSegment,n=t.startRenderSpace,i=t.endRenderSpace,r=e.directSegment,a=r.startRenderSpace,o=r.endRenderSpace;return(0,M.E)(a,n)<(0,M.E)(o,i)}(l);var u=r?[a,o]:[o,a],c=(0,k.Z)(u,2),d=c[0],p=c[1],h=(0,O.WG)(p,K);return t===S.n.Horizontal?h.z=d.z:(h.x=d.x,h.y=d.y),i.toRenderCoords(d,e.startRenderSpace),i.toRenderCoords(h,e.endRenderSpace),e}}function J(e,t,n){return n.toRenderCoords(t.elevationAlignedStartPoint,e.startRenderSpace),n.toRenderCoords(t.elevationAlignedEndPoint,e.endRenderSpace),e}!function(e){e[e.Start=0]="Start",e[e.End=1]="End"}(I||(I={}));var K=(0,T.Tx)(0,0,0,null);var $=new L.y;function ee(e,t){var n=t.measureType,i=t.elevationAlignedStartPoint,r=t.elevationAlignedEndPoint,a=t.directSegment,o=a.startRenderSpace,s=a.endRenderSpace,l=t.directSegment,u=t.renderCoordsHelper,c=l.eval(.5,R.WM.get()),d=u.worldUpAtPosition(c,R.WM.get()),p=u.worldBasisAtPosition(c,E.R.Y,R.WM.get());switch(n){case S.n.Horizontal:(0,M.c)(e,d);break;case S.n.Vertical:(0,M.e)(o,d)<(0,M.e)(s,d)?(0,M.w)(e,s,o):(0,M.w)(e,o,s),(0,M.f)(e,e,d),(0,M.f)(e,e,d);break;case S.n.Direct:var h=(0,v.Pt)(t.orientation,0);if(ne({elevationAlignedStartPoint:i,elevationAlignedEndPoint:r}))(0,D.d)(te,-(0,Z.Vl)(h),d),(0,M.m)(e,p,te);else{var f=(0,M.w)(R.WM.get(),s,o),y=(0,M.f)(R.WM.get(),f,d);(0,M.f)(y,y,f),(0,D.d)(te,(0,Z.Vl)(h),f),(0,M.m)(e,y,te)}}return(0,M.F)(e,A.Z)?(0,M.c)(e,p):(0,M.n)(e,e)}var te=(0,x.c)();function ne(e){var t=e.elevationAlignedStartPoint,n=e.elevationAlignedEndPoint;return(0,v.pC)(t)&&(0,v.pC)(n)&&t.x===n.x&&t.y===n.y}function ie(e,t){var n=t.offsetAxis,i=t.offset,r=t.relativeToSegment,a=r.startRenderSpace,o=r.endRenderSpace,s=t.relativeToSegment,l=function(e,t,n){var i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=(0,M.e)(t,n),a=(0,M.e)(e,n),o=Math.abs(r-a)+i;return r>a?[o,i]:[i,o]}(a,o,n,i/t.renderCoordsHelper.unitInMeters),u=(0,k.Z)(l,2),c=u[0],d=u[1];return(0,M.z)(e.startRenderSpace,s.startRenderSpace,n,c),(0,M.z)(e.endRenderSpace,s.endRenderSpace,n,d),e}function re(e,t,n){var i=t.directSegment.eval(.5,R.WM.get());return n.worldUpAtPosition(i,e)}function ae(e,t){var n=t.directSegment,i=n.startRenderSpace,r=n.endRenderSpace;return(0,M.w)(e,r,i)}function oe(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{invert:!1},i=t.dimensionSegment,r=i.startRenderSpace,a=i.endRenderSpace;return n.invert?(0,M.w)(e,r,a):(0,M.w)(e,a,r)}function se(e,t){var n=e.directSegment.eval(.5,R.WM.get());return t.headingAtPosition(n,e.primaryOffsetAxis)}var le=(0,A.c)();function ue(e){var t=e.elevationAlignedStartPoint,n=e.elevationAlignedEndPoint;if((0,v.Wi)(t)||(0,v.Wi)(n))return!1;var i=function(e,t){var n=e.spatialReference;return(0,G.fS)(n,t.spatialReference)?(F[0]=e.x,F[1]=e.y,F[2]=e.hasZ?e.z:0,j[0]=t.x,j[1]=t.y,j[2]=t.hasZ?t.z:0,V(F,j,n)):null}(t,n);return(0,v.pC)(i)&&(0,P.nn)(i,"meters").value>ce}var ce=1e5;function de(e){return(0,v.pC)(e.geometry)}var pe=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e))._handles=new w.Z,i}return(0,l.Z)(n,[{key:"initialize",value:function(){var e,t=this,n=this.analysisViewData.computations,i=(0,o.Z)(n);try{for(i.s();!(e=i.n()).done;){var r=e.value;this._addComputation(r)}}catch(a){i.e(a)}finally{i.f()}this.addHandles(n.on("change",(function(e){var n,i=e.added,r=e.removed,s=(0,o.Z)(r);try{for(s.s();!(n=s.n()).done;){var l=n.value;t._removeComputation(l)}}catch(a){s.e(a)}finally{s.f()}var u,c=(0,o.Z)(i);try{for(c.s();!(u=c.n()).done;){var d=u.value;t._addComputation(d)}}catch(a){c.e(a)}finally{c.f()}})))}},{key:"destroy",value:function(){this._handles=(0,v.SC)(this._handles)}},{key:"analysis",get:function(){return this.analysisViewData.analysis}},{key:"_defaultUnit",get:function(){return(0,b.R)(this.view)}},{key:"_addComputation",value:function(e){var t=this;this._handles.has(e)||this._handles.add((0,y.YP)((function(){return B(e)}),(function(n){var i=n.measureType;if(ue(n)&&i!==S.n.Direct){var r=Math.round((0,C.En)(ce,"meters","kilometers"));return f.Z.getLogger(t.declaredClass).warnOnce("A ".concat(i," dimension in the analysis (id: '").concat(t.analysis.id,"') will not display, because only direct dimensions can measure lengths greater than ").concat(r,' km. Update the measureType of the affected dimension to "direct" to display it.')),void(e.geometry=null)}var a=Q(n,t.view.renderCoordsHelper,e.geometry);e.geometry=a,e.result.length=function(e,t,n){if((0,v.Wi)(e))return null;var i=V(e.dimensionSegment.startRenderSpace,e.dimensionSegment.endRenderSpace,e.spatialReference);if((0,v.Wi)(i))return null;var r=t===S.n.Vertical?(0,C.ov)(i.value,i.unit,n):(0,C.iS)(i.value,i.unit,n);return(0,P.nn)(i,r)}(a,i,t._defaultUnit)}),y.tX),e)}},{key:"_removeComputation",value:function(e){this._handles.remove(e)}}]),n}(p.Z);(0,d._)([(0,g.Cb)({constructOnly:!0})],pe.prototype,"analysisViewData",void 0),(0,d._)([(0,g.Cb)({constructOnly:!0})],pe.prototype,"view",void 0),(0,d._)([(0,g.Cb)()],pe.prototype,"analysis",null),(0,d._)([(0,g.Cb)()],pe.prototype,"_defaultUnit",null),pe=(0,d._)([(0,m.j)("esri.views.3d.analysis.Dimension.support.DimensionController")],pe);var he=n(1413),fe=n(84702),ve=n(42537),ye=n(93433),ge=n(51995),me=(n(59486),n(17768)),_e=n(17842),Se=n(55652),we={main:new ge.Z([255,127,0])},Ce=(0,l.Z)((function e(){(0,s.Z)(this,e),this.color=we.main,this.opacity=.5,this.radius=5})),be=(0,l.Z)((function e(){(0,s.Z)(this,e),this.color=new ge.Z([127,127,127]),this.opacity=.5,this.radius=5})),ke=(0,l.Z)((function e(){(0,s.Z)(this,e),this.lineSizeFraction=.8})),Ze=(0,l.Z)((function e(){(0,s.Z)(this,e),this.color=we.main,this.opacity=.5,this.linePaddingPx=4,this.focusedLinePaddingPx=6,this.lengthFraction=.5,this.minLengthMeters=.1})),Pe=(0,l.Z)((function e(){(0,s.Z)(this,e),this.calloutOffsetPx=18,this.calloutOpacity=.5,this.calloutWidth=2,this.discScale=.3,this.focusMultiplier=2})),De=(0,l.Z)((function e(){(0,s.Z)(this,e),this.lineSizeFraction=.25})),xe=(0,l.Z)((function e(){(0,s.Z)(this,e),this.marginPx=20,this.minScreenLengthFontSizeFactor=5})),Me=(0,l.Z)((function e(){(0,s.Z)(this,e),this.color=new ge.Z([255,127,0,.5])})),Ae=new((0,l.Z)((function e(){(0,s.Z)(this,e),this.pointManipulators=new Ce,this.offsetManipulator=new Ze,this.orientationManipulator=new Pe,this.markers=new ke,this.labels=new xe,this.offsetLine=new De,this.constraint=new Me,this.constraintThresholdPx=10,this.initialOffsetPx=50,this.orientationSnapThresholdDegrees=5,this.disabledPointIndicator=new be,this.smallScreenLengthLineSizeFactor=2,this.pointerMoveTimeoutMs=2500}))),Ee=n(35284),Re=n(83639),Te=n(40508),Oe=n(51328),Le=n(2522),ze=n(70619),Ge=n(5693),He=n(99034),Ve=n(585),We=function(){function e(t){(0,s.Z)(this,e),this.start=t.start,this.end=t.end,this.offset=t.offset,this.heading=t.heading,this.rotation=t.rotation,this.direct=t.direct,this.horizontal=t.horizontal,this.vertical=t.vertical}return(0,l.Z)(e,[{key:"manipulatorName",value:function(e){var t=this;return Object.keys(this).find((function(n){return t.hasOwnProperty(n)&&e===t[n]}))}},{key:"values",value:function(){return[this.start,this.end,this.offset,this.heading,this.rotation,this.direct,this.horizontal,this.vertical]}},{key:"forEachMeasureTypeManipulator",value:function(e){var t,n=(0,o.Z)(S.V);try{for(n.s();!(t=n.n()).done;){var i=t.value;e(this.manipulatorForMeasureType(i),i)}}catch(r){n.e(r)}finally{n.f()}}},{key:"manipulatorForMeasureType",value:function(e){switch(e){case S.n.Direct:return this.direct;case S.n.Horizontal:return this.horizontal;case S.n.Vertical:return this.vertical}}}]),e}();function Ie(e,t){var n=t.lineSizePt,i=t.material,r=Ae.orientationManipulator,a=r.calloutOffsetPx,o=r.calloutOpacity,s=r.calloutWidth,l=r.discScale,u=r.focusMultiplier;return{calloutLength:.25*Le._Z*Ae.markers.lineSizeFraction*(0,_e.F2)(n)+a,calloutOpacity:o,calloutWidth:s,customStateMask:it,discScale:l,focusMultiplier:u,material:i,metadata:e}}function Fe(e,t){return(0,Re.Ju)(e,Ie(t.metadata,t))}function je(e,t){(0,Re.Bz)(e,Ie(e.metadata,t))}function Ne(e,t){var n=t.computation,i=t.view;return[(0,Ge.Xd)(e,(function(e,t,r){qe({cancel:r,computation:n,settingHeading:!1,steps:t,view:i})})),e.events.on("immediate-click",(function(e){!function(e,t,n){var i=t.dimension,r=t.geometry;if(90===i.orientation||270===i.orientation)return i.orientation=0,void e.stopPropagation();if((0,v.Wi)(r))return;var a=n.renderCoordsHelper,o=Q((0,he.Z)((0,he.Z)({},B(t)),{},{orientation:90}),a),s=Q((0,he.Z)((0,he.Z)({},B(t)),{},{orientation:270}),a);if((0,v.Wi)(o)||(0,v.Wi)(s))return;var l=se(o,a),u=se(s,a),c=Qe(r,n),d=me.BV.shortestSignedDiff(c,l),p=me.BV.shortestSignedDiff(c,u);i.orientation=Math.abs(d)<Math.abs(p)?90:270,e.stopPropagation()}(e,n,i)}))]}function qe(e){var t=e.cancel,n=e.computation,i=e.settingHeading,r=e.steps,a=e.view;if(de(n)){var o=a.renderCoordsHelper,s=n.dimension,l=n.geometry,u=(0,A.c)(),c=Ke((0,A.c)(),l,l.directSegment,o),d=$e(R.WM.get(),{forHeading:i,geometry:l,renderCoordsHelper:o}),p=(0,Se.Yq)(c,d,(0,Se.Ue)()),h=(0,v.Pt)(s.orientation,i?function(){return se(l,a.renderCoordsHelper)}:0);r.next((0,Oe._N)(a,p)).next((function(e){"start"===e.action&&(0,M.c)(u,e.renderStart);var t=(0,Se.mJ)(p),n=(0,Re.Gd)(u,e.renderEnd,c,t),r=h-(0,Z.BV)(n);i||(r=function(e){var t=me.BV.normalize(e)%90;return t<Ae.orientationSnapThresholdDegrees?e-t:90-t<Ae.orientationSnapThresholdDegrees?e+(90-t):e}(r)),s.orientation=r})),t.next((0,Ge.di)(s,["orientation"]))}}function Ue(e,t){var n=t.computation,i=t.manipulatorMeasureType,r=t.view,a=S.n.Direct,o=0,s=0;return[e.events.on("grab-changed",(function(t){if("start"===t.action&&de(n)){var l=n.dimension,u=n.geometry;a=l.measureType,o=l.offset,s=l.orientation;var c=(0,M.c)(R.WM.get(),e.renderLocation);l.measureType=i,l.offset=function(e,t,n,i){var r=n.directSegment,a=ee(R.WM.get(),{measureType:t,directSegment:r,renderCoordsHelper:i}),o=ie($,{offsetAxis:a,offset:0,relativeToSegment:r,renderCoordsHelper:i}).eval(.5,R.WM.get()),s=(0,M.w)(R.WM.get(),e,o);return(0,M.e)(s,a)*i.unitInMeters}(c,i,u,r.renderCoordsHelper),l.orientation=0}})),(0,Ge.Xd)(e,(function(e,t,l){if(de(n)){var u=n.geometry,c=n.dimension,d=r.renderCoordsHelper,p=X(st,i,n,d),h=ee(R.WM.get(),{measureType:i,directSegment:u.directSegment,renderCoordsHelper:d}),f=(0,Oe.J4)(e);t.next(f).next(Be(r,c,p,h)),l.next(f).next((function(e){return c.measureType=a,c.offset=o,c.orientation=s,e}))}}))]}function Be(e,t,n,i){var r=(0,M.b)(R.WM.get(),n.endRenderSpace,n.startRenderSpace);(0,M.f)(r,r,i);var a,o=(0,Se.Yq)(n.startRenderSpace,r,(0,Se.Ue)()),s=(0,Se.Yq)(n.startRenderSpace,i,(0,Se.Ue)()),l=t.offset,u=0,c=new Ge.hM;return c.next((0,Oe._N)(e,o)).next((function(n){"start"===n.action&&(u=(0,Se.jH)(s,n.renderStart));var i=((0,Se.jH)(s,n.renderEnd)-u)*e.renderCoordsHelper.unitInMeters;t.offset=l+i,a=n})),function(e){return c.execute(e),a}}function Qe(e,t){var n=e.directSegment,i=t.renderCoordsHelper,r=re(R.WM.get(),e,i),a=ae(R.WM.get(),e),o=(0,M.f)(R.WM.get(),a,r),s=t.state.camera.viewForward;(0,M.e)(o,s)>0&&(0,M.g)(o,o,-1);var l=n.eval(.5,R.WM.get());return i.headingAtPosition(l,o)}function Ye(e,t,n,i){var r=i.forHeading,a=t.dimension,o=t.geometry,s=o.primaryOffsetAxis,l=(0,M.g)(Xe,s,a.offset>=0?1:-1),u=$e(Je,{forHeading:r,geometry:o,renderCoordsHelper:n});(0,M.f)(u,u,l);var c=(0,Re.Aq)(l,u,A.Z,ot);e.modelTransform=c,e.renderLocation=Ke(rt,o,o.dimensionSegment,n)}var Xe=(0,A.c)(),Je=(0,A.c)();function Ke(e,t,n,i){var r=n.startRenderSpace,a=n.endRenderSpace,o=function(e,t){var n=ae(et,e),i=re(tt,e,t);return(0,M.e)(n,i)>0}(t,i)?r:a;return(0,M.c)(e,o)}function $e(e,t){var n=t.forHeading,i=t.geometry,r=t.renderCoordsHelper;return n?re(e,i,r):oe(e,i,{invert:!0})}var et=(0,A.c)(),tt=(0,A.c)();function nt(e){return(0,_e.F2)(e)+Ae.offsetManipulator.focusedLinePaddingPx}var it=He.jg.Custom1,rt=(0,A.c)(),at=(0,A.c)(),ot=(0,x.c)(),st=new L.y,lt=n(25810),ut=n(41691),ct=n(84652);var dt,pt=n(66978);n(93169);function ht(e,t,n){var i=n.constraint,r=n.elevationAlignedStartPoint,a=n.elevationAlignedEndPoint,o=n.unconstrainedGeometry,s=n.view,l=e.dimension,u=e.previousConstraint,c=e.preConstraintProperties;if(!(0,v.Wi)(r)&&!(0,v.Wi)(a)){var d=function(){"startPoint"in t?l.startPoint=t.startPoint:"endPoint"in t&&(l.endPoint=t.endPoint)};if((0,v.Wi)(i))d(),(0,v.pC)(u)&&(0,v.pC)(c)&&(l.measureType=c.measureType,l.orientation=c.orientation);else switch(l.measureType=S.n.Direct,i){case dt.Horizontal:if(i!==u&&(l.orientation=0),"startPoint"in t){var p=t.startPoint;(0,v.pC)(p)&&(p.z=a.z),l.startPoint=p}else if("endPoint"in t){var h=t.endPoint;(0,v.pC)(h)&&(h.z=r.z),l.endPoint=h}break;case dt.Vertical:if(i!==u&&(l.orientation=Qe(o,s)),"startPoint"in t){var f=t.startPoint;(0,v.pC)(f)&&(f.x=a.x,f.y=a.y),l.startPoint=f}else if("endPoint"in t){var y=t.endPoint;(0,v.pC)(y)&&(y.x=r.x,y.y=r.y),l.endPoint=y}break;case dt.Direct:i!==u&&(0,v.pC)(c)&&(l.orientation=c.orientation),d()}e.previousConstraint=i,e.unconstrainedGeometry=o}}!function(e){e[e.Horizontal=0]="Horizontal",e[e.Vertical=1]="Vertical",e[e.Direct=2]="Direct"}(dt||(dt={}));var ft,vt=n(96664),yt=n(74509),gt=n(11752),mt=n(61120),_t=n(90045),St=n(151),wt=n(70444),Ct=n(95773),bt=n(85981),kt=n(40885),Zt=n(62921),Pt=n(62389),Dt=n(19384),xt=n(56529),Mt=n(39077),At=n(4760),Et=n(58901),Rt=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e))._ray=(0,kt.Ue)(),i._isWorldDown=!1,i._start=(0,A.c)(),i._end=(0,A.f)(1,0,0),i._width=1,i._color=(0,St.f)(1,0,1,1),i._polygonOffset=!1,i._writeDepthEnabled=!0,i._innerWidth=0,i._innerColor=(0,St.f)(1,1,1,1),i._stipplePattern=null,i._stippleOffColor=null,i._stipplePreferContinuous=!0,i._falloff=0,i._extensionType=ft.LINE,i._laserlineStyle=null,i._laserlineEnabled=!1,i._renderOccluded=xt.yD.OccludeAndTransparent,i._fadedExtensions=Ht,i._laserline=new Pt.W({view:i.view}),i.applyProps(e),i}return(0,l.Z)(n,[{key:"destroy",value:function(){this._laserline.destroy(),(0,gt.Z)((0,mt.Z)(n.prototype),"destroy",this).call(this)}},{key:"createObject3DResourceFactory",value:function(e){var t=this;return{view:e,createResources:function(e){return t._createObject3DResources(e)},destroyResources:function(e){return t._destroyExternalResources(e)},recreateGeometry:function(e,n){return t._recreateObject3DGeometry(e,n)},cameraChanged:function(){return t._updateGeometry()}}}},{key:"createDrapedResourceFactory",value:function(e){var t=this;return{view:e,createResources:function(){return t._createDrapedResources()},destroyResources:function(e){return t._destroyExternalResources(e)},recreateGeometry:function(e){return t._recreateDrapedGeometry(e)}}}},{key:"updateVisibility",value:function(e){(0,gt.Z)((0,mt.Z)(n.prototype),"updateVisibility",this).call(this,e),this._laserline.visible=e}},{key:"onAttachedChange",value:function(){this._laserline.attached=this._laserlineAttached}},{key:"setStartEndFromWorldDownAtLocation",value:function(e){this._isWorldDown=!0,(0,M.c)(this._start,e),this.view.renderCoordsHelper.worldUpAtPosition(e,this._end),(0,M.b)(this._end,e,this._end),(0,kt.zk)(this._start,this._end,this._ray),this._updateGeometry()}},{key:"start",get:function(){return this._start},set:function(e){this._isWorldDown=!1,(0,M.k)(this._start,e)||((0,M.c)(this._start,e),(0,kt.zk)(this._start,this._end,this._ray),this._updateGeometry())}},{key:"end",get:function(){return this._end},set:function(e){this._isWorldDown=!1,(0,M.k)(this._end,e)||((0,M.c)(this._end,e),(0,kt.zk)(this._start,this._end,this._ray),this._updateGeometry())}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"color",get:function(){return this._color},set:function(e){(0,_t.g)(e,this._color)||((0,_t.c)(this._color,e),this._updateMaterial())}},{key:"polygonOffset",get:function(){return this._polygonOffset},set:function(e){e!==this._polygonOffset&&(this._polygonOffset=e,this._updateMaterial())}},{key:"writeDepthEnabled",get:function(){return this._writeDepthEnabled},set:function(e){this._writeDepthEnabled!==e&&(this._writeDepthEnabled=e,this._updateMaterial())}},{key:"innerWidth",get:function(){return this._innerWidth},set:function(e){e!==this._innerWidth&&(this._innerWidth=e,this._updateMaterial())}},{key:"innerColor",get:function(){return this._innerColor},set:function(e){(0,_t.g)(e,this._innerColor)||((0,_t.c)(this._innerColor,e),this._updateMaterial())}},{key:"stipplePattern",get:function(){return this._stipplePattern},set:function(e){var t=(0,v.pC)(e)!==(0,v.pC)(this._stipplePattern);this._stipplePattern=e,t?this.recreate():this._updateMaterial()}},{key:"stippleOffColor",get:function(){return this._stippleOffColor},set:function(e){((0,v.Wi)(e)||(0,v.Wi)(this._stippleOffColor)||!(0,_t.g)(e,this._stippleOffColor))&&(this._stippleOffColor=(0,v.pC)(e)?(0,St.c)(e):null,this._updateMaterial())}},{key:"stipplePreferContinuous",get:function(){return this._stipplePreferContinuous},set:function(e){e!==this._stipplePreferContinuous&&(this._stipplePreferContinuous=e,this._updateMaterial())}},{key:"falloff",get:function(){return this._falloff},set:function(e){e!==this._falloff&&(this._falloff=e,this._updateMaterial())}},{key:"extensionType",get:function(){return this._extensionType},set:function(e){e!==this._extensionType&&(this._extensionType=e,this.recreateGeometry())}},{key:"_laserlineAttached",get:function(){return this._laserlineEnabled&&(0,v.pC)(this._laserlineStyle)&&this.attached&&!this.isDraped}},{key:"laserlineStyle",get:function(){return this._laserlineStyle},set:function(e){this._laserlineStyle=e,this._laserline.attached=this._laserlineAttached,(0,v.pC)(e)&&(this._laserline.style=e)}},{key:"laserlineEnabled",get:function(){return this._laserlineEnabled},set:function(e){this._laserlineEnabled!==e&&(this._laserlineEnabled=e,this._laserline.attached=this._laserlineAttached)}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"_normalizedRenderOccluded",get:function(){return this.isDraped&&this._renderOccluded===xt.yD.OccludeAndTransparentStencil?xt.yD.OccludeAndTransparent:this._renderOccluded}},{key:"fadedExtensions",get:function(){return this._fadedExtensions},set:function(e){this._fadedExtensions=(0,v.Pt)(e,Ht),this.recreateGeometry()}},{key:"_updateMaterial",value:function(){var e,t,n=this.materialParameters;null!==(e=(0,v.WG)(this.object3dResources.resources))&&void 0!==e&&e.material.setParameters(n),null===(t=(0,v.WG)(this.drapedResources.resources))||void 0===t||t.material.setParameters(n)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,stippleOffColor:this._stippleOffColor,stipplePattern:this._stipplePattern,stipplePreferContinuous:this._stipplePreferContinuous,innerWidth:this._innerWidth,innerColor:this._innerColor,falloff:this._falloff,hasPolygonOffset:this._polygonOffset,renderOccluded:this._normalizedRenderOccluded,writeDepth:this._writeDepthEnabled}}},{key:"_createObject3DResources",value:function(e){var t=new Et.U(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:function(e){e(t),n.forEach(e)}}}},{key:"_destroyExternalResources",value:function(e){e.geometries=[],e.material.dispose()}},{key:"_recreateObject3DGeometry",value:function(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}},{key:"_createObject3DGeometry",value:function(e,t,n){var i=this._createGeometry(e);n.push(i),t.addGeometry(i),this._updateVerticesObject3D(t)}},{key:"_createDrapedResources",value:function(){var e=new Et.U(this.materialParameters);return{material:e,geometries:[this._createDrapedGeometry(e)]}}},{key:"_recreateDrapedGeometry",value:function(e){e.geometries=[this._createDrapedGeometry(e.material)]}},{key:"_createDrapedGeometry",value:function(e){var t=this._createGeometry(e);this._updateVerticesDraped(t);var n=new Mt.z(t,{boundingInfo:t.boundingInfo});return n.computeBoundingSphere(n.transformation,n.boundingSphere),n}},{key:"_createGeometry",value:function(e){var t=this.extensionType===ft.FADED,n=t?[(0,A.c)(),(0,A.c)(),(0,A.c)(),(0,A.c)()]:[(0,A.c)(),(0,A.c)()];return(0,ze.rh)(e,n,null,t?[1,1,1,0,1,1,1,1,1,1,1,1,1,1,1,0]:null)}},{key:"_updateGeometry",value:function(){if(this.isDraped)this.drapedResources.recreateGeometry();else{var e=(0,v.WG)(this.object3dResources.object);e&&this._updateVerticesObject3D(e)}}},{key:"_updateVerticesObject3D",value:function(e){var t=this._lineSegment;this._updateVertexAttributesObject3D(e,t),this._laserline.intersectsLine=t}},{key:"_updateVerticesDraped",value:function(e){this._updateVertexAttributesDraped(e,this._lineSegment)}},{key:"_lineSegment",get:function(){return this._extensionType===ft.FADED?this._updateLineSegmentFinite(zt):this._updateLineSegmentInfinite(this._extensionType,zt)}},{key:"_updateLineSegmentFinite",value:function(e){return(0,bt.zk)(this._start,this._end,e)}},{key:"_updateLineSegmentInfinite",value:function(e,t){var n=this.view.state.camera;switch((0,wt.iL)(this._ray,Tt),e){case ft.LINE:Tt.c0=-Number.MAX_VALUE;break;case ft.RAY:case ft.GROUND_RAY:var i=this._ray.origin,r=(0,v.Pt)(this.view.elevationProvider.getElevation(i[0],i[1],i[2],this.view.renderCoordsHelper.spatialReference,"ground"),0),a=this.view.renderCoordsHelper.getAltitude(i);this._isWorldDown&&a<r&&(0,M.o)(Tt.ray.direction,Tt.ray.direction),this._extensionType===ft.GROUND_RAY&&null!=r&&(Tt.c1=Math.abs(a-r))}if(!(0,Ct.zq)(n.frustum,Tt))return this._updateLineSegmentFinite(t);var o=(0,wt.Ws)(Tt,Ot),s=(0,wt.S$)(Tt,Lt);return(0,bt.zk)(o,s,t)}},{key:"_updateVertexAttributesObject3D",value:function(e,t){var n,i=null===(n=e.geometries[0].getMutableAttribute(At.T.POSITION))||void 0===n?void 0:n.data;if(i){var r,a=0,s=(0,o.Z)(this._lineVertices(t));try{for(s.s();!(r=s.n()).done;){var l=r.value;i[a++]=l[0],i[a++]=l[1],i[a++]=l[2]}}catch(u){s.e(u)}finally{s.f()}e.geometryVertexAttrsUpdated(e.geometries[0])}}},{key:"_updateVertexAttributesDraped",value:function(e,t){var n,i=null===(n=e.getMutableAttribute(At.T.POSITION))||void 0===n?void 0:n.data;if(i){var r,a=0,s=(0,o.Z)(this._lineVertices(t));try{for(s.s();!(r=s.n()).done;){var l=r.value;i[a++]=l[0],i[a++]=l[1],i[a++]=Dt.Rn}}catch(u){s.e(u)}finally{s.f()}e.invalidateBoundingInfo()}}},{key:"_lineVertices",value:(0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.extensionType!==ft.FADED){e.next=11;break}return e.next=3,(0,bt.KU)(t,-this.fadedExtensions.start,Ot);case 3:return e.next=5,(0,bt.KU)(t,0,Ot);case 5:return e.next=7,(0,bt.KU)(t,1,Ot);case 7:return e.next=9,(0,bt.KU)(t,1+this.fadedExtensions.end,Ot);case 9:e.next=15;break;case 11:return e.next=13,(0,bt.KU)(t,0,Ot);case 13:return e.next=15,(0,bt.KU)(t,1,Ot);case 15:case"end":return e.stop()}}),e,this)}))}]),n}(Zt.i),Tt=(0,wt.Ue)(),Ot=(0,A.c)(),Lt=(0,A.c)(),zt=(0,bt.Ue)();!function(e){e[e.LINE=0]="LINE",e[e.RAY=1]="RAY",e[e.GROUND_RAY=2]="GROUND_RAY",e[e.FADED=3]="FADED"}(ft||(ft={}));var Gt=1/3,Ht={start:Gt,end:Gt},Vt=n(88396),Wt=n(6394),It=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e))._location=(0,A.c)(),i._direction=(0,A.f)(1,0,0),i._width=1,i._offset=1,i._length=18,i._color=(0,St.f)(1,0,1,1),i._renderOccluded=xt.yD.OccludeAndTransparent,i.applyProps(e),i}return(0,l.Z)(n,[{key:"createObject3DResourceFactory",value:function(e){var t=this;return{view:e,createResources:function(e){return t._createObject3DResources(e)},destroyResources:function(e){return t._destroyObject3DResources(e)},recreateGeometry:function(e,n){return t._recreateObject3DGeometry(e,n)},cameraChanged:function(){return t._updateGeometry()}}}},{key:"createDrapedResourceFactory",value:function(e){var t=this;return{view:e,createResources:function(){return t._createDrapedResources()},destroyResources:function(e){return t._destroyDrapedResources(e)},recreateGeometry:function(e){return t._recreateDrapedGeometry(e)}}}},{key:"location",get:function(){return this._location},set:function(e){(0,M.k)(this._location,e)||((0,M.c)(this._location,e),this._updateGeometry())}},{key:"direction",get:function(){return this._direction},set:function(e){(0,M.k)(this._direction,e)||((0,M.c)(this._direction,e),this._updateGeometry())}},{key:"setDirectionFromPoints",value:function(e,t){(0,M.n)(this._direction,(0,M.b)(this._direction,t,e)),this._updateGeometry()}},{key:"width",get:function(){return this._width},set:function(e){e!==this._width&&(this._width=e,this._updateMaterial())}},{key:"offset",get:function(){return this._offset},set:function(e){e!==this._offset&&(this._offset=e,this._updateGeometry())}},{key:"length",get:function(){return this._length},set:function(e){e!==this._length&&(this._length=e,this._updateGeometry())}},{key:"color",get:function(){return this._color},set:function(e){(0,_t.g)(e,this._color)||((0,_t.c)(this._color,e),this._updateMaterial())}},{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial())}},{key:"_createObject3DResources",value:function(e){var t=new Et.U(this.materialParameters),n=new Array;return this._createObject3DGeometry(t,e,n),{material:t,geometries:n,forEach:function(e){e(t),n.forEach(e)}}}},{key:"_destroyObject3DResources",value:function(e){e.geometries.length=0,e.material.dispose()}},{key:"_recreateObject3DGeometry",value:function(e,t){e.geometries.length=0,this._createObject3DGeometry(e.material,t,e.geometries)}},{key:"_createObject3DGeometry",value:function(e,t,n){var i=this._createGeometries(e),r=(0,k.Z)(i,2),a=r[0],o=r[1];t.addGeometry(a),t.addGeometry(o),n.push(a),n.push(o),this._updateVerticesObject3D(t)}},{key:"_createDrapedResources",value:function(){var e=this,t=new Et.U(this.materialParameters),n=(0,y.YP)((function(){return e.view.state.contentPixelRatio}),(function(){e.drapedResources.recreateGeometry()}));return{material:t,geometries:this._createDrapedGeometry(t),pixelRatioHandle:n}}},{key:"_destroyDrapedResources",value:function(e){e.pixelRatioHandle.remove(),e.geometries=[],e.material.dispose()}},{key:"_recreateDrapedGeometry",value:function(e){e.geometries=this._createDrapedGeometry(e.material)}},{key:"_createDrapedGeometry",value:function(e){var t=this._createGeometries(e);this._updateVerticesDraped(t);var n,i=t.map((function(e){return new Mt.z(e,{boundingInfo:e.boundingInfo})})),r=(0,o.Z)(i);try{for(r.s();!(n=r.n()).done;){var a=n.value;a.computeBoundingSphere(a.transformation,a.boundingSphere)}}catch(s){r.e(s)}finally{r.f()}return i}},{key:"_createGeometries",value:function(e){return[(0,ze.rh)(e,[(0,A.c)(),(0,A.c)()]),(0,ze.rh)(e,[(0,A.c)(),(0,A.c)()])]}},{key:"_updateMaterial",value:function(){var e,t,n=this.materialParameters;null!==(e=(0,v.WG)(this.object3dResources.resources))&&void 0!==e&&e.material.setParameters(n),null===(t=(0,v.WG)(this.drapedResources.resources))||void 0===t||t.material.setParameters(n)}},{key:"materialParameters",get:function(){return{width:this._width,color:this._color,renderOccluded:this._renderOccluded}}},{key:"_updateGeometry",value:function(){if(this.isDraped)this.drapedResources.recreateGeometry();else{var e=(0,v.WG)(this.object3dResources.object);e&&this._updateVerticesObject3D(e)}}},{key:"_updateVerticesObject3D",value:function(e){var t=this.view.state.camera;t.projectToScreen(this.location,Ut),(0,M.a)(Ft,this.location,this.direction),t.projectToScreen(Ft,Bt),(0,Vt.f)(Bt,(0,Vt.a)(Bt,Bt,Ut)),this._updateVertexAttributesObject3D(t,e,0,Ut,Bt,1),this._updateVertexAttributesObject3D(t,e,1,Ut,Bt,-1)}},{key:"_updateVertexAttributesObject3D",value:function(e,t,n,i,r,a){var o,s=t.geometries[n],l=null===(o=s.getMutableAttribute(At.T.POSITION))||void 0===o?void 0:o.data;if(l){var u=this._computeStartEnd(r,i,a,this.offset,this.width,this.length),c=u.start,d=u.end;e.unprojectFromScreen((0,_e.c$)(c),Ft),l[0]=Ft[0],l[1]=Ft[1],l[2]=Ft[2],e.unprojectFromScreen((0,_e.c$)(d),Ft),l[3]=Ft[0],l[4]=Ft[1],l[5]=Ft[2],t.geometryVertexAttrsUpdated(s)}}},{key:"_updateVerticesDraped",value:function(e){var t=this.view,n=t.basemapTerrain.overlayManager,i=t.state.contentPixelRatio,r=this.location,a=this.width,o=this.length,s=this.offset,l=Qt;l.spatialReference=(0,v.Wg)(n.renderer.spatialReference),l.x=r[0],l.y=r[1];var u=n.overlayPixelSizeInMapUnits(l)*i,c=a*u,d=o*u,p=s*u;this._updateVertexAttributesDraped(e[0],c,d,p,-1),this._updateVertexAttributesDraped(e[1],c,d,p,1)}},{key:"_updateVertexAttributesDraped",value:function(e,t,n,i,r){var a,o=null===(a=e.getMutableAttribute(At.T.POSITION))||void 0===a?void 0:a.data;if(o){var s=this.location,l=this.direction,u=this._computeStartEnd(l,s,r,i,t,n),c=u.start,d=u.end;o[0]=c[0],o[1]=c[1],o[2]=Dt.Rn,o[3]=d[0],o[4]=d[1],o[5]=Dt.Rn,e.invalidateBoundingInfo()}}},{key:"_computeStartEnd",value:function(e,t,n,i,r,a){var o=(0,Vt.b)(jt,(0,Vt.s)(jt,e[1]*n,e[0]*-n),i+r/2),s=(0,Vt.j)(Nt,(0,Vt.j)(Nt,(0,Vt.j)(Nt,t,(0,Vt.b)(Nt,e,a/2)),o),o);return{start:s,end:(0,Vt.j)(qt,s,(0,Vt.b)(qt,e,-a))}}}]),n}(Zt.i),Ft=(0,A.c)(),jt=(0,Wt.a)(),Nt=(0,Wt.a)(),qt=(0,Wt.a)(),Ut=(0,_e.s1)(),Bt=(0,_e.s1)(),Qt=(0,T.Tx)(0,0,void 0,null),Yt=n(66730),Xt=n(98917),Jt=n(26279),Kt=n(46784),$t=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;return(0,s.Z)(this,n),(e=t.apply(this,arguments)).enabled=!0,e}return(0,l.Z)(n)}(Kt.wq);(0,d._)([(0,g.Cb)({type:Boolean})],$t.prototype,"enabled",void 0),$t=(0,d._)([(0,m.j)("esri.views.interactive.snapping.Settings.DefaultSnappingAlgorithm")],$t);var en=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).lineSnapper=new $t,i.parallelLineSnapper=new $t,i.rightAngleSnapper=new $t,i.rightAngleTriangleSnapper=new $t,i.shortLineThreshold=15,i.distance=5,i.pointThreshold=1e-6,i.intersectionParallelLineThreshold=1e-6,i.parallelLineThreshold=1e-6,i.verticalLineThreshold=.1,i.touchSensitivityMultiplier=1.5,i.pointOnLineThreshold=1e-6,i.orange=new ge.Z([255,127,0]),i.orangeTransparent=new ge.Z([255,127,0,.5]),i.lineHintWidthReference=3,i.lineHintWidthTarget=3,i.lineHintFadedExtensions=.3,i.parallelLineHintWidth=2,i.parallelLineHintLength=24,i.parallelLineHintOffset=1.5,i.rightAngleHintSize=24,i.rightAngleHintOutlineSize=1.5,i.satisfiesConstraintScreenThreshold=1,i}return(0,l.Z)(n)}(Kt.wq);(0,d._)([(0,g.Cb)({type:$t,constructOnly:!0,nonNullable:!0,json:{write:!0}})],en.prototype,"lineSnapper",void 0),(0,d._)([(0,g.Cb)({type:$t,constructOnly:!0,nonNullable:!0,json:{write:!0}})],en.prototype,"parallelLineSnapper",void 0),(0,d._)([(0,g.Cb)({type:$t,constructOnly:!0,nonNullable:!0,json:{write:!0}})],en.prototype,"rightAngleSnapper",void 0),(0,d._)([(0,g.Cb)({type:$t,constructOnly:!0,nonNullable:!0,json:{write:!0}})],en.prototype,"rightAngleTriangleSnapper",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],en.prototype,"shortLineThreshold",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:-1,max:50,step:1},json:{write:!0}})],en.prototype,"distance",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],en.prototype,"pointThreshold",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],en.prototype,"intersectionParallelLineThreshold",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],en.prototype,"parallelLineThreshold",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],en.prototype,"verticalLineThreshold",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],en.prototype,"touchSensitivityMultiplier",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1e-5},json:{write:!0}})],en.prototype,"pointOnLineThreshold",void 0),(0,d._)([(0,g.Cb)({type:ge.Z,nonNullable:!0})],en.prototype,"orange",void 0),(0,d._)([(0,g.Cb)({type:ge.Z,nonNullable:!0})],en.prototype,"orangeTransparent",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],en.prototype,"lineHintWidthReference",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],en.prototype,"lineHintWidthTarget",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:1},json:{write:!0}})],en.prototype,"lineHintFadedExtensions",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:10},json:{write:!0}})],en.prototype,"parallelLineHintWidth",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:50},json:{write:!0}})],en.prototype,"parallelLineHintLength",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],en.prototype,"parallelLineHintOffset",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:46},json:{write:!0}})],en.prototype,"rightAngleHintSize",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:6},json:{write:!0}})],en.prototype,"rightAngleHintOutlineSize",void 0),(0,d._)([(0,g.Cb)({type:Number,nonNullable:!0,range:{min:0,max:5},json:{write:!0}})],en.prototype,"satisfiesConstraintScreenThreshold",void 0);var tn=new(en=(0,d._)([(0,m.j)("esri.views.interactive.snapping.Settings.Defaults")],en)),nn=n(80371),rn=n(1700),an=n(64674),on=n(55054),sn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e,i){var r,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:nn.B.ALL;return(0,s.Z)(this,n),(r=t.call(this,i,a)).intersectionPoint=e,r}return(0,l.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&(0,M.k)(this.intersectionPoint,e.intersectionPoint)}}]),n}(on.r),ln=n(53397),un=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e,i,r){var a,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:nn.B.ALL;return(0,s.Z)(this,n),(a=t.call(this,r,o)).lineStart=e,a.lineEnd=i,a}return(0,l.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&(0,M.k)(this.lineStart,e.lineStart)&&(0,M.k)(this.lineEnd,e.lineEnd)}}]),n}(on.r),cn=n(61309),dn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e,i,r,a){var o,l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:nn.B.ALL;return(0,s.Z)(this,n),(o=t.call(this,a,l)).previousVertex=e,o.centerVertex=i,o.nextVertex=r,o}return(0,l.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&(0,M.k)(this.previousVertex,e.previousVertex)&&(0,M.k)(this.centerVertex,e.centerVertex)&&(0,M.k)(this.nextVertex,e.nextVertex)}}]),n}(on.r),pn=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"draw",value:function(e,t){var n,i=this._getUniqueHints(e),r=this.sortUniqueHints(i),a=[],s=(0,o.Z)(r);try{for(s.s();!(n=s.n()).done;){var l=n.value;l instanceof sn&&a.push(this.visualizeIntersectionPoint(l,t)),l instanceof ln.w&&a.push(this.visualizeLine(l,t)),l instanceof un&&a.push(this.visualizeParallelSign(l,t)),l instanceof dn&&a.push(this.visualizeRightAngleQuad(l,t)),l instanceof cn.n&&a.push(this.visualizePoint(l,t))}}catch(u){s.e(u)}finally{s.f()}return(0,ve.AL)(a)}},{key:"sortUniqueHints",value:function(e){return e}},{key:"_getUniqueHints",value:function(e){var t,n=[],i=(0,o.Z)(e);try{for(i.s();!(t=i.n()).done;){var r,a=t.value,s=!0,l=(0,o.Z)(n);try{for(l.s();!(r=l.n()).done;){var u=r.value;if(a.equals(u)){s=!1;break}}}catch(c){l.e(c)}finally{l.f()}s&&n.push(a)}}catch(c){i.e(c)}finally{i.f()}return n}}]),e}(),hn=n(11208),fn=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"sortUniqueHints",value:function(e){return e.sort((function(e,t){return(t instanceof ln.w?t.length:0)-(e instanceof ln.w?e.length:0)}))}},{key:"visualizeIntersectionPoint",value:function(e,t){var n=t.spatialReference,i=t.view;return(0,ve.ed)(new Yt.L({view:i,primitive:"circle",geometry:(0,rn.SH)(e.intersectionPoint,n),elevationInfo:e.isDraped?yt.tR:yt.jG,size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ge.Z.toUnitRGBA(tn.orange),pixelSnappingEnabled:!1}))}},{key:"visualizePoint",value:function(e,t){var n=t.view,i=t.spatialReference,r=this._alignPoint(e.point,e.domain,t);return(0,ve.ed)(new Yt.L({view:n,primitive:"circle",geometry:(0,rn.SH)(r,i),elevationInfo:this._hintElevationInfo(e,t),size:20,outlineSize:2,color:[0,0,0,0],outlineColor:ge.Z.toUnitRGBA(tn.orange),pixelSnappingEnabled:!1}))}},{key:"visualizeLine",value:function(e,t){var n=t.view,i=t.spatialReference,r=this._alignPoint(e.lineStart,e.domain,t),a=this._alignPoint(e.lineEnd,e.domain,t);return(0,ve.ed)(this._createLineSegmentHint(e.type,r,a,i,this._hintElevationInfo(e,t),n,e.isDraped,e.fadeLeft,e.fadeRight))}},{key:"visualizeParallelSign",value:function(e,t){var n=t.view,i=t.spatialReference,r=e.isDraped,a=this._hintElevationInfo(e,t),o=this._alignPoint(e.lineStart,e.domain,t),s=this._alignPoint(e.lineEnd,e.domain,t),l=vn(o,i,a,n,r),u=vn(s,i,a,n,r),c=(0,M.h)(u,l,u,.5),d=new It({view:n,attached:!1,offset:tn.parallelLineHintOffset,length:tn.parallelLineHintLength,width:tn.parallelLineHintWidth,color:ge.Z.toUnitRGBA(tn.orange),location:c,renderOccluded:r?xt.yD.OccludeAndTransparent:xt.yD.Opaque,isDraped:r,renderGroup:Jt.eZ.SnappingHint});return d.setDirectionFromPoints(l,c),d.attached=!0,(0,ve.ed)(d)}},{key:"visualizeRightAngleQuad",value:function(e,t){var n=t.view,i=t.spatialReference,r=this._hintElevationInfo(e,t),a=e.isDraped,o=this._alignPoint(e.previousVertex,e.domain,t),s=this._alignPoint(e.centerVertex,e.domain,t),l=this._alignPoint(e.nextVertex,e.domain,t),u=vn(o,i,r,n,a),c=vn(s,i,r,n,a),d=vn(l,i,r,n,a);return(0,ve.ed)(new Xt.R({view:n,attached:!0,color:a?ge.Z.toUnitRGBA(tn.orangeTransparent):ge.Z.toUnitRGBA(tn.orange),renderOccluded:a?xt.yD.OccludeAndTransparent:xt.yD.Transparent,outlineRenderOccluded:a?xt.yD.OccludeAndTransparent:xt.yD.Opaque,outlineColor:ge.Z.toUnitRGBA(tn.orange),outlineSize:tn.rightAngleHintOutlineSize,size:tn.rightAngleHintSize,isDraped:a,geometry:{previous:u,center:c,next:d},renderGroup:Jt.eZ.SnappingHint}))}},{key:"_createLineSegmentHint",value:function(e,t,n,i,r,a){var o=arguments.length>6&&void 0!==arguments[6]&&arguments[6],s=!(arguments.length>7&&void 0!==arguments[7])||arguments[7],l=!(arguments.length>8&&void 0!==arguments[8])||arguments[8],u=vn(t,i,r,a,o),c=vn(n,i,r,a,o),d=new Rt({view:a,extensionType:ft.FADED,start:u,end:c,isDraped:o,color:ge.Z.toUnitRGBA(tn.orange),renderOccluded:o?xt.yD.OccludeAndTransparent:xt.yD.Opaque,renderGroup:Jt.eZ.SnappingHint});switch(e){case an.ze.TARGET:d.width=tn.lineHintWidthTarget,d.fadedExtensions={start:0,end:tn.lineHintFadedExtensions};break;case an.ze.REFERENCE_EXTENSION:d.width=tn.lineHintWidthReference,d.fadedExtensions={start:0,end:0};break;case an.ze.REFERENCE:d.width=tn.lineHintWidthReference,d.fadedExtensions={start:s?tn.lineHintFadedExtensions:0,end:l?tn.lineHintFadedExtensions:0}}return d.attached=!0,d}},{key:"_alignPoint",value:function(e,t,n){var i=this._getSelfSnappingZ(t,n);return(0,v.Wi)(i)?e:(0,rn.$G)(e[0],e[1],i)}},{key:"_hintElevationInfo",value:function(e,t){return(0,v.pC)(this._getSelfSnappingZ(e.domain,t))?(0,v.Wg)(t.selfSnappingZ).elevationInfo:e.isDraped?yt.tR:yt.jG}},{key:"_getSelfSnappingZ",value:function(e,t){var n=t.selfSnappingZ;return e===nn.B.SELF&&(0,v.pC)(n)?n.value:null}}]),n}(pn);function vn(e,t,n,i,r){var a=arguments.length>5&&void 0!==arguments[5]?arguments[5]:(0,A.c)();if(r){var o=i.basemapTerrain.overlayManager.renderer.spatialReference;(0,z.SH)(e,t,a,o)}else(0,hn.RS)(e,t,n,i,a);return a}var yn=n(33837),gn=n(97326),mn=n(86950),_n=n(67077),Sn=n(86700),wn={main:new ge.Z([255,127,0]),selected:new ge.Z([255,255,255]),staged:new ge.Z([12,207,255]),outline:new ge.Z([0,0,0,.5]),selectedOutline:new ge.Z([255,255,255])},Cn=.3;function bn(e,t){var n=e.clone();return n.a*=t,n}function kn(e,t){var n=e.clone(),i=(0,mn._Y)(n);i.s*=t;var r=(0,mn.xr)(i);return n.r=r.r,n.g=r.g,n.b=r.b,n}function Zn(e,t){if(t)for(var n in t)e[n]=t[n]}var Pn=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.color=wn.main,this.height=90,this.coneHeight=40,this.coneWidth=23,this.width=3,this.renderOccluded=xt.yD.Opaque,Zn(this,t)})),Dn=function(){function e(t){(0,s.Z)(this,e),this.size=11,this.outlineSize=1,this.collisionPadding=9,this.color=wn.main,this.outlineColor=wn.outline,this.renderOccluded=xt.yD.Opaque,this.hoverOutlineColor=wn.selectedOutline,Zn(this,t)}return(0,l.Z)(e,[{key:"apply",value:function(e,t){var n=this[e];t.setParameters({color:Hn(n),transparent:"color"!==e||n.a<1,renderOccluded:this.renderOccluded})}}]),e}(),xn=function(){function e(t){(0,s.Z)(this,e),this.size=40,this.height=.2,this.offset=.25,this.collisionPadding=2,this.color=bn(wn.main,.5),this.hoverColor=wn.main,this.renderOccluded=xt.yD.Transparent,this.minSquaredEdgeLength=900,Zn(this,t)}return(0,l.Z)(e,[{key:"apply",value:function(e,t){var n=this[e];t.setParameters({color:Hn(n),transparent:n.a<1,renderOccluded:this.renderOccluded})}}]),e}(),Mn=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.vertex=new Dn({color:wn.main,outlineColor:wn.outline}),this.edge=new Dn({color:kn(bn(wn.main,2/3),.5),outlineColor:bn(wn.outline,.5),size:8,collisionPadding:8}),this.selected=new Dn({color:wn.selected,outlineColor:wn.outline}),this.edgeOffset=new xn,Zn(this,t)})),An=function(){function e(t){(0,s.Z)(this,e),this.color=wn.selected,this.width=1.5,this.stipplePattern=(0,Sn.z5)(5),this.stippleOffColor=wn.outline,this.falloff=0,this.innerWidth=1.5,this.innerColor=wn.selected,this.renderOccluded=xt.yD.OccludeAndTransparent,Zn(this,t)}return(0,l.Z)(e,[{key:"apply",value:function(e){e.color=Hn(this.color),e.width=this.width,e.stipplePattern=this.stipplePattern,e.stippleOffColor=Hn(this.stippleOffColor),e.falloff=this.falloff,e.innerWidth=this.innerWidth,e.innerColor=Hn(this.innerColor),e.renderOccluded=this.renderOccluded}}]),e}(),En=function(){function e(t){(0,s.Z)(this,e),this.color=wn.selected,this.size=4,this.outlineSize=1,this.outlineColor=wn.outline,this.shape="square",Zn(this,t)}return(0,l.Z)(e,[{key:"apply",value:function(e){e.color=Hn(this.color),e.size=this.size,e.outlineSize=this.outlineSize,e.outlineColor=Hn(this.outlineColor),e.primitive=this.shape}}]),e}(),Rn=function(){function e(t){(0,s.Z)(this,e),this.innerColor=wn.selected,this.innerWidth=1,this.glowColor=wn.main,this.glowWidth=8,this.glowFalloff=8,this.globalAlpha=Cn,this.globalAlphaContrastBoost=1.5,this.radius=3,this.heightFillColor=wn.main,Zn(this,t)}return(0,l.Z)(e,[{key:"apply",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n={glowColor:ge.Z.toUnitRGB(this.glowColor),glowFalloff:this.glowFalloff,glowWidth:this.glowWidth,innerColor:ge.Z.toUnitRGB(this.innerColor),innerWidth:this.innerWidth,globalAlpha:this.globalAlpha*t,globalAlphaContrastBoost:this.globalAlphaContrastBoost,intersectsLineRadius:this.radius};"style"in e?e.style=n:e.laserlineStyle=n}}]),e}(),Tn=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.outline=new An({color:wn.outline,renderOccluded:xt.yD.OccludeAndTransparentStencil,stippleOffColor:wn.selected,stipplePattern:(0,Sn.z5)(5),width:1.5,innerWidth:0}),this.staged=new An({color:wn.selected,renderOccluded:xt.yD.OccludeAndTransparentStencil,innerColor:wn.staged,stippleOffColor:wn.outline,stipplePattern:(0,Sn.z5)(5),width:1.5}),this.shadowStyle=new Rn({globalAlpha:Cn,glowColor:wn.main,glowFalloff:8,glowWidth:8,innerColor:wn.selected,innerWidth:1}),Zn(this,t)})),On=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.outline=new En({color:wn.selected,outlineColor:wn.outline,outlineSize:1,shape:"circle",size:4}),this.shadowStyle=new Rn({globalAlpha:Cn,glowColor:wn.main,glowFalloff:1.5,glowWidth:6,innerColor:wn.selected,innerWidth:1,radius:2}),Zn(this,t)})),Ln=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this)).extensionType=ft.GROUND_RAY,Zn((0,gn.Z)(i),e),i}return(0,l.Z)(n)}(An),zn=(0,l.Z)((function e(t){(0,s.Z)(this,e),this.lineGraphics=new Tn,this.pointGraphics=new On,this.heightPlane=new Rn({globalAlpha:Cn,glowColor:wn.main,glowFalloff:8,glowWidth:8,innerColor:wn.selected,innerWidth:1}),this.heightBox=new Rn({globalAlpha:Cn,glowColor:wn.main,glowFalloff:8,glowWidth:8,innerColor:wn.selected,innerWidth:0,heightFillColor:wn.main}),this.zVerticalLine=new Ln({color:bn(wn.main,.5),falloff:2,innerColor:bn(wn.selected,0),renderOccluded:xt.yD.OccludeAndTransparent,stipplePattern:null,width:5,extensionType:ft.GROUND_RAY}),this.laserlineAlphaMultiplier=1.5,this.heightPlaneAngleCutoff=20,Zn(this,t)})),Gn=function(){function e(t){(0,s.Z)(this,e),this.visualElements=new zn,this.reshapeManipulators=new Mn,this.zManipulator=new Pn,Zn(this,t)}return(0,l.Z)(e,[{key:"colorToVec4",value:function(e){return Hn(e)}}]),e}();function Hn(e){return(0,_n.b)(ge.Z.toUnitRGBA(e))}var Vn=new Gn,Wn=n(52168),In=n(78935),Fn=n(69691),jn=n(88699);var Nn=n(68401),qn=n(11606),Un=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).view=null,i._renderOccluded=xt.yD.OccludeAndTransparent,i._vertices=null,i._spatialReference=null,i._color=Vn.colorToVec4(Vn.reshapeManipulators.vertex.color),i._size=Vn.reshapeManipulators.vertex.size,i._outlineColor=Vn.colorToVec4(Vn.reshapeManipulators.vertex.outlineColor),i._outlineSize=Vn.reshapeManipulators.vertex.outlineSize,i._elevationInfo=null,i.applyProps(e),i}return(0,l.Z)(n,[{key:"renderOccluded",get:function(){return this._renderOccluded},set:function(e){e!==this._renderOccluded&&(this._renderOccluded=e,this._updateMaterial(),this._updateOutlineMaterial())}},{key:"vertices",get:function(){return this._vertices},set:function(e){this._vertices=e,this.recreateGeometry()}},{key:"spatialReference",get:function(){return this._spatialReference},set:function(e){this._spatialReference=e,this.recreateGeometry()}},{key:"color",get:function(){return this._color},set:function(e){(0,_t.g)(e,this._color)||((0,_t.c)(this._color,e),this._updateMaterial())}},{key:"size",get:function(){return this._size},set:function(e){e!==this._size&&(this._size=e,this._updateMaterial())}},{key:"outlineColor",get:function(){return this._outlineColor},set:function(e){(0,_t.g)(e,this._outlineColor)||((0,_t.c)(this._outlineColor,e),this._updateOutlineMaterial())}},{key:"outlineSize",get:function(){return this._outlineSize},set:function(e){e!==this._outlineSize&&(this._outlineSize=e,this._updateOutlineMaterial())}},{key:"elevationInfo",get:function(){return this._elevationInfo},set:function(e){this._elevationInfo=e,this.recreateGeometry()}},{key:"_vertexMaterialParameters",get:function(){return{color:this._color,transparent:this._color[3]<1,screenSizeScale:this.size,renderOccluded:this._renderOccluded}}},{key:"_vertexOutlineMaterialParameters",get:function(){return{color:this._outlineColor,transparent:this._outlineColor[3]<1,screenSizeScale:this.size+2*this.outlineSize,renderOccluded:this._renderOccluded}}},{key:"_updateMaterial",value:function(){this.attached&&this._vertexMaterial.setParameters(this._vertexMaterialParameters)}},{key:"_updateOutlineMaterial",value:function(){this.attached&&this._vertexOutlineMaterial.setParameters(this._vertexOutlineMaterialParameters)}},{key:"_createRenderGeometries",value:function(){var e=this.vertices;if((0,v.Wi)(e)||0===e.length)return[];for(var t=function(e,t,n,i,r){var a=(0,jn.bg)(3*e.length),o=(0,jn.bg)(a.length);e.forEach((function(e,t){a[3*t+0]=e[0],a[3*t+1]=e[1],a[3*t+2]=e.length>2?e[2]:0}));var s=(0,Fn.rR)(a,t,0,o,0,a,0,a.length/3,n,i,r),l=null!=s;return{numVertices:e.length,position:a,mapPositions:o,projectionSuccess:l,sampledElevation:s}}(e,this.spatialReference,this.view.elevationProvider,this.view.renderCoordsHelper,In.o.fromElevationInfo(this.elevationInfo)),n=[],i=t.numVertices,r=t.position,a=0;a<i;++a){var o=(0,M.s)(Bn,r[3*a+0],r[3*a+1],r[3*a+2]),s=Qn(this._vertexMaterial,.5,o),l=Qn(this._vertexOutlineMaterial,.5,o);n.push({vertexGeometry:s,vertexOutlineGeometry:l})}return n}},{key:"createGeometries",value:function(e){var t,n=this._createRenderGeometries(),i=(0,o.Z)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value,a=r.vertexGeometry,s=r.vertexOutlineGeometry;e.addGeometry(a),e.addGeometry(s)}}catch(l){i.e(l)}finally{i.f()}}},{key:"createExternalResources",value:function(){this._vertexMaterial=new qn.Q((0,he.Z)((0,he.Z)({},this._vertexMaterialParameters),{},{writeDepth:!0,cullFace:Nn.Vr.Back,screenSizeEnabled:!0})),this._vertexOutlineMaterial=new qn.Q((0,he.Z)((0,he.Z)({},this._vertexOutlineMaterialParameters),{},{transparent:!0,writeDepth:!0,cullFace:Nn.Vr.Front,screenSizeEnabled:!0,shadingEnabled:!1}))}},{key:"destroyExternalResources",value:function(){this._vertexMaterial=null,this._vertexOutlineMaterial=null}},{key:"forEachExternalMaterial",value:function(e){e(this._vertexMaterial),e(this._vertexOutlineMaterial)}}]),n}(Wn._),Bn=(0,A.c)();function Qn(e,t,n){return(0,ze.PI)(e,t,16,16,{offset:n})}var Yn=n(66156),Xn=n(14813),Jn=n(84954),Kn=n(95172),$n=n(70758),ei=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).layer=null,i.enabled=!0,i.updating=!1,i.availability=1,i}return(0,l.Z)(n)}(p.Z);(0,d._)([(0,g.Cb)({constructOnly:!0})],ei.prototype,"layer",void 0),(0,d._)([(0,g.Cb)()],ei.prototype,"enabled",void 0),(0,d._)([(0,g.Cb)()],ei.prototype,"updating",void 0),(0,d._)([(0,g.Cb)()],ei.prototype,"availability",void 0);var ti=ei=(0,d._)([(0,m.j)("esri.views.interactive.snapping.FeatureSnappingLayerSource")],ei),ni=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).enabled=!1,i.enabledToggled=!1,i.selfEnabled=!0,i.featureEnabled=!0,i.featureSources=new h.Z,i.distance=tn.distance,i.touchSensitivityMultiplier=tn.touchSensitivityMultiplier,i}return(0,l.Z)(n,[{key:"effectiveEnabled",get:function(){return this.enabledToggled?!this.enabled:this.enabled}},{key:"effectiveSelfEnabled",get:function(){return this.effectiveEnabled&&this.selfEnabled}},{key:"effectiveFeatureEnabled",get:function(){return this.effectiveEnabled&&this.featureEnabled}}]),n}(p.Z);(0,d._)([(0,g.Cb)()],ni.prototype,"enabled",void 0),(0,d._)([(0,g.Cb)()],ni.prototype,"enabledToggled",void 0),(0,d._)([(0,g.Cb)()],ni.prototype,"selfEnabled",void 0),(0,d._)([(0,g.Cb)()],ni.prototype,"featureEnabled",void 0),(0,d._)([(0,g.Cb)({type:h.Z.ofType(ti)})],ni.prototype,"featureSources",void 0),(0,d._)([(0,g.Cb)()],ni.prototype,"distance",void 0),(0,d._)([(0,g.Cb)()],ni.prototype,"touchSensitivityMultiplier",void 0),(0,d._)([(0,g.Cb)({readOnly:!0})],ni.prototype,"effectiveEnabled",null),(0,d._)([(0,g.Cb)({readOnly:!0})],ni.prototype,"effectiveSelfEnabled",null),(0,d._)([(0,g.Cb)({readOnly:!0})],ni.prototype,"effectiveFeatureEnabled",null);var ii=ni=(0,d._)([(0,m.j)("esri.views.interactive.snapping.SnappingOptions")],ni);var ri,ai=n(77427),oi=n(26277),si=n(92536),li=n(95122),ui=n(97760),ci=n(95905),di=n(75691),pi=n(92605),hi=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i,r=e.targetPoint,a=e.constraint,o=e.previousVertex,l=e.otherVertex,u=e.otherVertexType,c=e.objectId,d=e.isDraped;return(0,s.Z)(this,n),(i=t.call(this,r,a,d,nn.B.SELF)).previousVertex=o,i.otherVertex=l,i.otherVertexType=u,i.objectId=c,i}return(0,l.Z)(n,[{key:"hints",get:function(){var e=this.previousVertex,t=this.otherVertexType===ri.CENTER?this.otherVertex:this.targetPoint,n=this.otherVertexType===ri.CENTER?this.targetPoint:this.otherVertex;return[new ln.w(an.ze.TARGET,t,n,this.isDraped,this.domain),new ln.w(an.ze.REFERENCE,e,t,this.isDraped,this.domain),new dn(this.previousVertex,t,n,this.isDraped,this.domain)]}}]),n}(pi.j);!function(e){e[e.NEXT=0]="NEXT",e[e.CENTER=1]="CENTER"}(ri||(ri={}));var fi=function(e){(0,u.Z)(i,e);var t=(0,c.Z)(i);function i(e){var n;return(0,s.Z)(this,i),(n=t.call(this,e)).options=null,n._domain=nn.B.FEATURE,n._sourceModules={featureService:{module:null,loader:null},featureCollection:{module:null,loader:null},graphics:{module:null,loader:null},notes:{module:null,loader:null},scene:{module:null,loader:null}},n}return(0,l.Z)(i,[{key:"updating",get:function(){return(0,ai.oE)(this.snappingSources,(function(e){return e.snappingSource.updating}))||this.updatingHandles.updating}},{key:"snappingSources",get:function(){var e=this._get("snappingSources")||new Map,t=new Map;if((0,v.pC)(this.options)&&(0,v.pC)(this.options.featureSources)){var n,i=(0,o.Z)(this.options.featureSources.items);try{for(i.s();!(n=i.n()).done;){var r=n.value,a=r.layer.uid,s=e.get(a);if(s)e.delete(a),t.set(a,s);else if(r.layer.loaded){var l=this._createSourceInfo(r);(0,v.pC)(l)&&t.set(a,l)}else this.updatingHandles.addPromise(r.layer.load())}}catch(d){i.e(d)}finally{i.f()}}var u,c=(0,o.Z)(e);try{for(c.s();!(u=c.n()).done;){(0,k.Z)(u.value,2)[1].destroy()}}catch(d){c.e(d)}finally{c.f()}return t}},{key:"initialize",value:function(){var e=this;this.updatingHandles.add((function(){return e.snappingSources}),(function(){return e.notifyChange("updating")}),y.Z_),(0,v.pC)(this.view)&&this.handles.add([this.view.on("layerview-create",(function(t){return e._updateLayerView(t.layer,t.layerView)})),this.view.on("layerview-destroy",(function(t){return e._updateLayerView(t.layer,null)}))])}},{key:"_updateLayerView",value:function(e,t){var n,i=(0,o.Z)(this.snappingSources);try{for(i.s();!(n=i.n()).done;){var r=(0,k.Z)(n.value,2)[1];r.snappingSource.layerSource.layer===e&&(r.layerView=t)}}catch(a){i.e(a)}finally{i.f()}}},{key:"destroy",value:function(){this._set("options",null);var e,t=(0,o.Z)(this.snappingSources);try{for(t.s();!(e=t.n()).done;){(0,k.Z)(e.value,2)[1].destroy()}}catch(n){t.e(n)}finally{t.f()}}},{key:"fetchCandidates",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,i,a){var s,l,u,c,d,p,h,f,y,g=this;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&this._domain&&!(0,v.Wi)(this.options)&&this.options.effectiveFeatureEnabled){e.next=2;break}return e.abrupt("return",[]);case 2:u=[],c=this._computeScreenSizeDistanceParameters(t,i),d={distance:c,mode:null!==(s=null===(l=(0,v.Wg)(this.view))||void 0===l?void 0:l.type)&&void 0!==s?s:"2d",point:t,coordinateHelper:i.coordinateHelper,types:this._types},p=(0,o.Z)(this.snappingSources),e.prev=4,f=(0,r.Z)().mark((function e(){var t,n,o,s;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=(0,k.Z)(h.value,2),n=t[1],o=n.snappingSource,s=n.layerView,!o.layerSource.enabled||(0,v.pC)(s)&&s.suspended||u.push(o.fetchCandidates(d,a).then((function(e){return e.filter((function(e){return!g._candidateIsExcluded(o,e,i.excludeFeature)}))})));case 2:case"end":return e.stop()}}),e)})),p.s();case 7:if((h=p.n()).done){e.next=11;break}return e.delegateYield(f(),"t0",9);case 9:e.next=7;break;case 11:e.next=16;break;case 13:e.prev=13,e.t1=e.catch(4),p.e(e.t1);case 16:return e.prev=16,p.f(),e.finish(16);case 19:return e.next=21,(0,pt.WW)(u);case 21:return y=e.sent.flat(),e.abrupt("return",(this._addRightAngleCandidates(y,t,c,i),(0,pt.k_)(a),(0,an.lQ)(t,y),y));case 23:case"end":return e.stop()}}),e,this,[[4,13,16,19]])})));return function(t,n,i,r){return e.apply(this,arguments)}}()},{key:"_addRightAngleCandidates",value:function(e,t,n,i){for(var r,a,o,s,l,u,c,d,p=(0,v.pC)(i.vertexHandle)?null===(r=i.vertexHandle.rightEdge)||void 0===r||null===(a=r.rightVertex)||void 0===a?void 0:a.pos:(0,v.pC)(i.editGeometryOperations)&&"polygon"===i.editGeometryOperations.data.type?null===(o=(0,v.Wg)(null===(s=i.editGeometryOperations.data.components[0])||void 0===s?void 0:s.getFirstVertex()))||void 0===o?void 0:o.pos:null,h=(0,v.pC)(i.vertexHandle)?null===(l=i.vertexHandle.leftEdge)||void 0===l||null===(u=l.leftVertex)||void 0===u?void 0:u.pos:(0,v.pC)(i.editGeometryOperations)?null===(c=(0,v.Wg)(null===(d=i.editGeometryOperations.data.components[0])||void 0===d?void 0:d.getLastVertex()))||void 0===c?void 0:c.pos:null,f=this.view,y=(0,rn.$D)(p,f,i),g=(0,rn.$D)(h,f,i),m=e.length,_=0;_<m;_++)this._addRightAngleCandidate(e[_],g,t,n,e),this._addRightAngleCandidate(e[_],y,t,n,e)}},{key:"_addRightAngleCandidate",value:function(e,t,n,i,r){if(!(0,v.Wi)(t)&&function(e){return(e instanceof ci.L||e instanceof ui.k)&&!function(e){var t=e.constraint,n=t.start,i=t.end,r=(0,M.d)(n,i),a=(0,Vt.k)(n,i);return r<(0,oi.g)()||a/r<_i}(e)}(e)){var a=e.constraint.closestTo(t),o=(a[0]-n[0])/i.x,s=(a[1]-n[1])/i.y,l=e.constraint,u=l.start,c=l.end;if(o*o+s*s<=1){var d=new hi({targetPoint:a,otherVertex:t,otherVertexType:ri.NEXT,previousVertex:(0,Vt.k)(a,u)>(0,Vt.k)(a,c)?u:c,constraint:new li.aU(t,a),objectId:e.objectId,isDraped:e.isDraped});r.push(d)}}}},{key:"_computeScreenSizeDistanceParameters",value:function(e,t){var n=(0,v.pC)(this.options)?this.options.distance*("touch"===t.pointer?this.options.touchSensitivityMultiplier:1):0;return(0,v.Wi)(this.view)?{x:n,y:n,z:n,distance:n}:"2d"===this.view.type?{x:n*=this.view.resolution,y:n,z:n,distance:n}:this._computeScreenSizeDistanceParameters3D(e,n,this.view,t)}},{key:"_computeScreenSizeDistanceParameters3D",value:function(e,t,n,i){var r=i.spatialReference;n.renderCoordsHelper.toRenderCoords(e,r,gi);var a=n.state.camera.computeScreenPixelSizeAt(gi),o=a*n.renderCoordsHelper.unitInMeters/n.mapCoordsHelper.unitInMeters,s=t*o,l=(0,hn.Rs)(e,r,yt.jG,n),u=l?yi(l,e,o,0,0,n,i):0,c=l?yi(l,e,0,o,0,n,i):0,d=l?yi(l,e,0,0,o,n,i):0;return{x:0===u?0:s/u,y:0===c?0:s/c,z:0===d?0:s/d,distance:a*t}}},{key:"_types",get:function(){return si.r.EDGE|si.r.VERTEX}},{key:"_candidateIsExcluded",value:function(e,t,n){if((0,v.Wi)(n))return!1;var i=this._getCandidateObjectId(t);if((0,v.Wi)(i))return!1;var r=e.layerSource.layer;return"graphics"===r.type?n.uid===i:n.sourceLayer===r&&!(!n.attributes||!("objectIdField"in r))&&n.attributes[r.objectIdField]===i}},{key:"_getCandidateObjectId",value:function(e){return e instanceof di.a?e.objectId:null}},{key:"_createSourceInfo",value:function(e){var t=this,n=this._createFeatureSnappingSourceType(e);if((0,v.Wi)(n))return null;if("loading"in n)return this.updatingHandles.addPromise(n.loading.then((function(){t.destroyed||t.notifyChange("snappingSources")}))),null;var i=(0,v.pC)(this.view)?this.view.allLayerViews.find((function(t){return t.layer===e.layer})):null;return new vi(n.source,i)}},{key:"_createFeatureSnappingSourceType",value:function(e){switch(e.layer.type){case"feature":case"geojson":case"csv":case"oriented-imagery":case"subtype-group":case"wfs":return this._createFeatureSnappingSourceFeatureLayer(e);case"graphics":return this._createFeatureSnappingSourceGraphicsLayer(e);case"map-notes":return this._createFeatureSnappingSourceMapNotesLayer(e);case"scene":case"building-scene":return this._createFeatureSnappingSourceSceneLayer(e)}return null}},{key:"_createFeatureSnappingSourceSceneLayer",value:function(e){var t=this.view;if((0,v.Wi)(t)||"3d"!==t.type)return null;var n=this._getSourceModule("scene");return(0,v.pC)(n.module)?{source:new n.module.SceneLayerSnappingSource({layerSource:e,view:t})}:{loading:n.loader}}},{key:"_createFeatureSnappingSourceFeatureLayer",value:function(e){var t;switch(null===(t=e.layer.source)||void 0===t?void 0:t.type){case"feature-layer":case"oriented-imagery":var n=this._getSourceModule("featureService");return(0,v.pC)(n.module)?{source:new n.module.FeatureServiceSnappingSource({spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:n.loader};case"memory":case"csv":case"geojson":case"wfs":if("mesh"===e.layer.geometryType)return null;var i=this._getSourceModule("featureCollection");return(0,v.pC)(i.module)?{source:new i.module.FeatureCollectionSnappingSource({layerSource:e,view:this.view})}:{loading:i.loader}}return null}},{key:"_createFeatureSnappingSourceGraphicsLayer",value:function(e){var t=this._getSourceModule("graphics");return(0,v.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:function(){return[e.layer]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}},{key:"_createFeatureSnappingSourceMapNotesLayer",value:function(e){var t=this._getSourceModule("notes");return(0,v.pC)(t.module)?{source:new t.module.GraphicsSnappingSource({getGraphicsLayers:function(){return(0,v.pC)(e.layer.sublayers)?e.layer.sublayers.toArray():[]},spatialReference:this.spatialReference,view:this.view,layerSource:e})}:{loading:t.loader}}},{key:"_getSourceModule",value:function(e){var t=this._sourceModules[e];if((0,v.Wi)(t.loader)){var n=this._loadSourceModule(e).then((function(e){t.module=e}));return t.loader=n,{module:t.module,loader:n}}return{module:t.module,loader:t.loader}}},{key:"_loadSourceModule",value:function(e){var t=this.updatingHandles;switch(e){case"featureService":return t.addPromise(n.e(5532).then(n.bind(n,5532)));case"featureCollection":return t.addPromise(Promise.all([n.e(8441),n.e(2137)]).then(n.bind(n,26823)));case"graphics":case"notes":return t.addPromise(Promise.all([n.e(739),n.e(8928),n.e(8441),n.e(3518)]).then(n.bind(n,33518)));case"scene":return t.addPromise(n.e(2767).then(n.bind(n,92767)))}}}]),i}(ut.r);(0,d._)([(0,g.Cb)({constructOnly:!0})],fi.prototype,"spatialReference",void 0),(0,d._)([(0,g.Cb)({constructOnly:!0})],fi.prototype,"view",void 0),(0,d._)([(0,g.Cb)()],fi.prototype,"options",void 0),(0,d._)([(0,g.Cb)({readOnly:!0})],fi.prototype,"updating",null),(0,d._)([(0,g.Cb)({readOnly:!0})],fi.prototype,"snappingSources",null),fi=(0,d._)([(0,m.j)("esri.views.interactive.snapping.FeatureSnappingEngine")],fi);var vi=function(){function e(t,n){(0,s.Z)(this,e),this.snappingSource=t,this.layerView=n,this.handles=new w.Z;var i=this.snappingSource.layerSource.layer;if("refresh"in i){var r=i;this.handles.add(r.on("refresh",(function(){return t.refresh()})))}this.handles.add([(0,y.YP)((function(){return t.updating}),(function(e){return t.layerSource.updating=e}),y.tX),(0,y.YP)((function(){return t.availability}),(function(e){return t.layerSource.availability=e}),y.tX)])}return(0,l.Z)(e,[{key:"destroy",value:function(){this.snappingSource.destroy(),this.handles.destroy()}}]),e}();function yi(e,t,n,i,r,a,o){var s=o.spatialReference,l=(0,M.c)(mi,t);l[0]+=n,l[1]+=i,l[2]+=r;var u=(0,hn.Rs)(l,s,yt.jG,a);return u?(0,an.fG)(u,e):1/0}var gi=(0,A.c)(),mi=(0,A.c)(),_i=1e-4,Si=n(91505),wi=function(){function e(t,n){(0,s.Z)(this,e),this.view=t,this.options=n,this.squaredShortLineThreshold=tn.shortLineThreshold*tn.shortLineThreshold}return(0,l.Z)(e,[{key:"snap",value:function(e,t){return(0,v.pC)(t.vertexHandle)?"vertex"!==t.vertexHandle.type?[]:this.snapExistingVertex(e,t):this.snapNewVertex(e,t)}},{key:"edgeExceedsShortLineThreshold",value:function(e,t){return this.exceedsShortLineThreshold((0,rn.$D)(e.leftVertex.pos,this.view,t),(0,rn.$D)(e.rightVertex.pos,this.view,t),t)}},{key:"exceedsShortLineThreshold",value:function(e,t,n){var i=n.spatialReference;return 0===this.squaredShortLineThreshold||(0,an.Bb)((0,hn.Rs)(t,i,yt.jG,this.view),(0,hn.Rs)(e,i,yt.jG,this.view))>this.squaredShortLineThreshold}},{key:"isVertical",value:function(e,t){return(0,Vt.k)(e,t)<tn.verticalLineThreshold}},{key:"squaredProximityThreshold",value:function(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityThreshold}},{key:"_squaredMouseProximityThreshold",get:function(){return this.options.distance*this.options.distance}},{key:"_squaredTouchProximityThreshold",get:function(){var e=this.options,t=e.distance*e.touchSensitivityMultiplier;return t*t}}]),e}(),Ci=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i,r=e.lineStart,a=e.lineEnd,o=e.targetPoint,l=e.isDraped;return(0,s.Z)(this,n),(i=t.call(this,o,new li.jg(r,a),l,nn.B.SELF))._referenceLineHint=new ln.w(an.ze.REFERENCE_EXTENSION,r,a,l,i.domain),i}return(0,l.Z)(n,[{key:"hints",get:function(){return[this._referenceLineHint,new ln.w(an.ze.TARGET,this._lineEndClosestToTarget(),this.targetPoint,this.isDraped,this.domain)]}},{key:"_lineEndClosestToTarget",value:function(){return this.constraint.closestEndTo(this.targetPoint)}}]),n}(pi.j),bi=n(55793),ki=n(94163),Zi=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=[];if(i<1)return r;var a=t.spatialReference,o=(0,hn.Rs)(e,a,yt.jG,this.view),s=this.view,l=n.edges[i-1],u=l;do{if(this.edgeExceedsShortLineThreshold(u,t)){var c=(0,an._j)(u,s,t);this._processCandidateProposal(c.left,c.right,e,o,t,r)}u=u.leftVertex.leftEdge}while(u&&u!==l);return r}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,v.Wg)(t.vertexHandle),r=i.component;if(r.edges.length<2)return n;var a=this.view,o=t.spatialReference,s=(0,hn.Rs)(e,o,yt.jG,a),l=i.leftEdge,u=i.rightEdge;l&&u&&this.edgeExceedsShortLineThreshold(l,t)&&this.edgeExceedsShortLineThreshold(u,t)&&this._processCandidateProposal((0,rn.$D)(l.leftVertex.pos,a,t),(0,rn.$D)(u.rightVertex.pos,a,t),e,s,t,n);var c=r.edges[0],d=c;do{if(d!==i.leftEdge&&d!==i.rightEdge&&this.edgeExceedsShortLineThreshold(d,t)){var p=(0,an._j)(d,a,t);this._processCandidateProposal(p.left,p.right,e,s,t,n)}d=d.rightVertex.rightEdge}while(d&&d!==c);return n}},{key:"_processCandidateProposal",value:function(e,t,n,i,r,a){var o,s=r.spatialReference,l=r.pointer,u=(0,rn.uc)((0,bi.ZE)(n,{start:e,end:t,type:ki.SP.LINE}));(0,an.Bb)(i,(0,hn.Rs)(u,s,yt.jG,this.view))<this.squaredProximityThreshold(l)&&a.push(new Ci({lineStart:e,lineEnd:t,targetPoint:u,isDraped:"on-the-ground"===(null===(o=r.elevationInfo)||void 0===o?void 0:o.mode)}))}}]),n}(wi),Pi=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i,r=e.referenceLine,a=e.lineStart,o=e.targetPoint,l=e.isDraped;(0,s.Z)(this,n);var u=(0,A.a)(a),c=r.left,d=r.right;return(0,M.b)(u,(0,M.a)(u,u,d),c),(i=t.call(this,o,new li.jg(a,(0,rn.uc)(u)),l,nn.B.SELF))._referenceLines=[{edge:r,fadeLeft:!0,fadeRight:!0}],i}return(0,l.Z)(n,[{key:"hints",get:function(){var e=this;return[new ln.w(an.ze.TARGET,this.constraint.start,this.targetPoint,this.isDraped,this.domain),new un(this.constraint.start,this.targetPoint,this.isDraped,this.domain)].concat((0,ye.Z)(this._referenceLines.map((function(t){return new ln.w(an.ze.REFERENCE,t.edge.left,t.edge.right,e.isDraped,e.domain,t.fadeLeft,t.fadeRight)}))))}},{key:"addReferenceLine",value:function(e){var t={edge:e,fadeLeft:!0,fadeRight:!0};this._referenceLines.forEach((function(n){(0,M.k)(e.right,n.edge.left)&&(n.fadeLeft=!1,t.fadeRight=!1),(0,M.k)(e.right,n.edge.right)&&(n.fadeRight=!1,t.fadeRight=!1),(0,M.k)(e.left,n.edge.right)&&(n.fadeRight=!1,t.fadeLeft=!1),(0,M.k)(e.left,n.edge.left)&&(n.fadeLeft=!1,t.fadeLeft=!1)})),this._referenceLines.push(t)}}]),n}(pi.j),Di=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.edges.length,r=n.vertices.length,a=[];if(i<2)return a;var o=this.view,s=(0,hn.Rs)(e,t.spatialReference,yt.jG,o),l=(0,rn.$D)(n.vertices[r-1].pos,o,t),u=(0,rn.$D)(n.vertices[0].pos,o,t),c=n.edges[i-1],d=c;do{if(this.edgeExceedsShortLineThreshold(d,t)){var p=(0,an._j)(d,o,t);this._checkEdgeForParallelLines(p,l,e,s,t,a),this._checkEdgeForParallelLines(p,u,e,s,t,a)}d=d.leftVertex.leftEdge}while(d&&d!==c);return a}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,v.Wg)(t.vertexHandle),r=i.component;if(r.edges.length<3)return n;var a=this.view,o=(0,hn.Rs)(e,t.spatialReference,yt.jG,a),s=i.leftEdge,l=i.rightEdge,u=r.vertices[0],c=(0,rn.$D)(u.pos,a,t),d=r.vertices.length,p=r.vertices[d-1],h=(0,rn.$D)(p.pos,a,t),f=r.edges[0],y=f;do{if(y!==s&&y!==l&&this.edgeExceedsShortLineThreshold(y,t)){var g=(0,an._j)(y,a,t);s&&this._checkEdgeForParallelLines(g,(0,rn.$D)(s.leftVertex.pos,a,t),e,o,t,n),l&&this._checkEdgeForParallelLines(g,(0,rn.$D)(l.rightVertex.pos,a,t),e,o,t,n),i===u?this._checkEdgeForParallelLines(g,h,e,o,t,n):i===p&&this._checkEdgeForParallelLines(g,c,e,o,t,n)}y=y.rightVertex.rightEdge}while(y&&y!==f);return n}},{key:"_checkEdgeForParallelLines",value:function(e,t,n,i,r,a){var o=e.left,s=e.right;if((0,ki.k0)(xi,t,o,s),!((0,Vt.k)(xi,t)<tn.parallelLineThreshold)){(0,ki.k0)(xi,n,o,s,t);var l=r.spatialReference,u=r.pointer,c=(0,rn.uc)((0,A.f)(xi[0],xi[1],n[2]));if((0,an.Bb)(i,(0,hn.Rs)(c,l,yt.jG,this.view))<this.squaredProximityThreshold(u)){var d;if(this.isVertical(c,t)||this.isVertical(o,s))return;if(this._parallelToPreviousCandidate(e,a))return;a.push(new Pi({referenceLine:e,lineStart:t,targetPoint:c,isDraped:"on-the-ground"===(null===(d=r.elevationInfo)||void 0===d?void 0:d.mode)}))}}}},{key:"_parallelToPreviousCandidate",value:function(e,t){var n,i=e.left,r=e.right,a=(0,o.Z)(t);try{for(a.s();!(n=a.n()).done;){var s=n.value;if((0,ki.k0)(xi,r,s.constraint.start,s.constraint.end,i),(0,Vt.k)(xi,r)<tn.parallelLineThreshold)return s.addReferenceLine(e),!0}}catch(l){a.e(l)}finally{a.f()}return!1}}]),n}(wi),xi=(0,Wt.a)(),Mi=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=n.vertices.length,r=[];if(i<2)return r;var a=this.view,o=(0,hn.Rs)(e,t.spatialReference,yt.jG,a),s=n.vertices[i-1];if(this.edgeExceedsShortLineThreshold(s.leftEdge,t)){var l=(0,rn.$D)(s.pos,a,t),u=(0,rn.$D)(s.leftEdge.leftVertex.pos,a,t);this._checkForSnappingCandidate(r,u,l,e,o,t)}var c=n.vertices[0];if(this.edgeExceedsShortLineThreshold(c.rightEdge,t)){var d=(0,rn.$D)(c.pos,a,t),p=(0,rn.$D)(c.rightEdge.rightVertex.pos,a,t);this._checkForSnappingCandidate(r,p,d,e,o,t)}return r}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,v.Wg)(t.vertexHandle);if(i.component.vertices.length<3)return n;var r=this.view,a=(0,hn.Rs)(e,t.spatialReference,yt.jG,r),o=i.leftEdge,s=i.rightEdge;if(o&&o.leftVertex.leftEdge){var l=o.leftVertex.leftEdge;if(this.edgeExceedsShortLineThreshold(l,t)){var u=(0,rn.$D)(l.rightVertex.pos,r,t),c=(0,rn.$D)(l.leftVertex.pos,r,t);this._checkForSnappingCandidate(n,c,u,e,a,t)}}if(s&&s.rightVertex.rightEdge){var d=s.rightVertex.rightEdge;if(this.edgeExceedsShortLineThreshold(d,t)){var p=(0,rn.$D)(d.leftVertex.pos,r,t),h=(0,rn.$D)(d.rightVertex.pos,r,t);this._checkForSnappingCandidate(n,h,p,e,a,t)}}return n}},{key:"_checkForSnappingCandidate",value:function(e,t,n,i,r,a){var o=a.spatialReference,s=a.pointer;(0,Vt.a)(Ai,n,t);var l=(0,M.s)(Ei,Ai[1],-Ai[0],0),u=(0,Vt.h)(l,(0,Vt.a)(Ai,i,n))/(0,Vt.v)(l),c=(0,rn.uc)((0,Vt.w)((0,A.a)(i),n,l,u));if((0,an.Bb)(r,(0,hn.Rs)(c,o,yt.jG,this.view))<this.squaredProximityThreshold(s)){var d;if(this.isVertical(c,n)||this.isVertical(n,t))return;var p=(0,M.z)((0,A.c)(),n,l,Math.sign(u));e.push(new hi({targetPoint:c,constraint:new li.aU(n,(0,rn.uc)(p)),previousVertex:t,otherVertex:n,otherVertexType:ri.CENTER,isDraped:"on-the-ground"===(null===(d=a.elevationInfo)||void 0===d?void 0:d.mode)}))}}}]),n}(wi),Ai=(0,Wt.a)(),Ei=(0,A.c)(),Ri=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i,r=e.targetPoint,a=e.point1,o=e.point2,l=e.isDraped;return(0,s.Z)(this,n),(i=t.call(this,r,new li.kt((0,rn.uc)((0,M.h)((0,A.c)(),a,o,.5)),.5*(0,Vt.d)(a,o)),l,nn.B.SELF))._p1=a,i._p2=o,i}return(0,l.Z)(n,[{key:"hints",get:function(){return[new ln.w(an.ze.REFERENCE,this.targetPoint,this._p1,this.isDraped,this.domain),new ln.w(an.ze.REFERENCE,this.targetPoint,this._p2,this.isDraped,this.domain),new dn(this._p1,this.targetPoint,this._p2,this.isDraped,this.domain)]}}]),n}(pi.j),Ti=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){return(0,s.Z)(this,n),t.apply(this,arguments)}return(0,l.Z)(n,[{key:"snapNewVertex",value:function(e,t){var n=t.editGeometryOperations.data.components[0],i=[],r=n.vertices.length;if("polygon"!==t.editGeometryOperations.data.type||r<2)return i;var a=this.view,o=n.vertices[0],s=n.vertices[r-1],l=(0,rn.$D)(o.pos,a,t),u=(0,rn.$D)(s.pos,a,t);return this._processCandidateProposal(l,u,e,t,i),i}},{key:"snapExistingVertex",value:function(e,t){var n=[],i=(0,v.Wg)(t.vertexHandle),r=i.component;if(r.edges.length<2)return n;if("polyline"===t.editGeometryOperations.data.type&&(0===i.index||i.index===r.vertices.length-1))return n;var a=this.view,o=(0,rn.$D)(i.leftEdge.leftVertex.pos,a,t),s=(0,rn.$D)(i.rightEdge.rightVertex.pos,a,t);return this._processCandidateProposal(o,s,e,t,n),n}},{key:"_processCandidateProposal",value:function(e,t,n,i,r){if(this.exceedsShortLineThreshold(e,t,i)){var a=(0,Vt.l)(Oi,e,t,.5),o=.5*(0,Vt.d)(e,t),s=(0,A.c)();(0,ki.xO)(s,n,a,o),s[2]=n[2];var l=(0,rn.uc)(s),u=i.spatialReference,c=i.pointer,d=(0,hn.Rs)(n,u,yt.jG,this.view);if((0,an.Bb)(d,(0,hn.Rs)(l,u,yt.jG,this.view))<this.squaredProximityThreshold(c)){var p;if(this.isVertical(e,l)||this.isVertical(l,t))return;r.push(new Ri({targetPoint:l,point1:e,point2:t,isDraped:"on-the-ground"===(null===(p=i.elevationInfo)||void 0===p?void 0:p.mode)}))}}}}]),n}(wi),Oi=(0,Wt.a)(),Li=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).updating=!1,i._snappers=new h.Z,i._domain=nn.B.SELF,i}return(0,l.Z)(n,[{key:"initialize",value:function(){this._snappers.push(new Di(this.view,this.options),new Zi(this.view,this.options),new Mi(this.view,this.options),new Ti(this.view,this.options))}},{key:"options",set:function(e){this._set("options",e);var t,n=(0,o.Z)(this._snappers);try{for(n.s();!(t=n.n()).done;){t.value.options=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"fetchCandidates",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,i){var a,s,l,u,c,d,p;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n&this._domain&&this.options.effectiveSelfEnabled){e.next=2;break}return e.abrupt("return",[]);case 2:a=[],s=(0,o.Z)(this._snappers.items);try{for(s.s();!(l=s.n()).done;){u=l.value,c=(0,o.Z)(u.snap(t,i));try{for(c.s();!(d=c.n()).done;)p=d.value,a.push(p)}catch(r){c.e(r)}finally{c.f()}}}catch(r){s.e(r)}finally{s.f()}return e.abrupt("return",((0,an.lQ)(t,a),a));case 6:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()}]),n}(p.Z);function zi(e,t){return[new Li({view:e,options:t}),new fi({view:e,options:t,spatialReference:e.spatialReference})]}(0,d._)([(0,g.Cb)({readOnly:!0})],Li.prototype,"updating",void 0),(0,d._)([(0,g.Cb)({constructOnly:!0})],Li.prototype,"view",void 0),(0,d._)([(0,g.Cb)()],Li.prototype,"options",null),Li=(0,d._)([(0,m.j)("esri.views.interactive.snapping.SelfSnappingEngine")],Li);var Gi,Hi=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e,i,r,a){var o;return(0,s.Z)(this,n),(o=t.call(this,e,new li.Bq(e,i.constraint,r.constraint),a,nn.B.ALL)).first=i,o.second=r,o}return(0,l.Z)(n,[{key:"hints",get:function(){return this.first.targetPoint=this.targetPoint,this.second.targetPoint=this.targetPoint,[].concat((0,ye.Z)(this.first.hints),(0,ye.Z)(this.second.hints),[new sn(this.targetPoint,this.isDraped,this.domain)])}}]),n}(pi.j),Vi=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).options=new ii,i.snappingEnginesFactory=zi,i._engines=[],i._currentMainCandidate=null,i._currentOtherActiveCandidates=[],i._currentSnappedType=Gi.MAIN,i}return(0,l.Z)(n,[{key:"initialize",value:function(){var e=this;this.handles.add([(0,y.YP)((function(){var t=e.options;return{effectiveFeatureEnabled:t.effectiveFeatureEnabled,effectiveSelfEnabled:t.effectiveSelfEnabled,touchSensitivityMultiplier:t.touchSensitivityMultiplier,distance:t.distance}}),(function(){e.doneSnapping(),e.emit("changed")}),y.Z_),(0,y.YP)((function(){return e.options}),(function(t){var n,i=(0,o.Z)(e._engines);try{for(i.s();!(n=i.n()).done;){n.value.options=t}}catch(r){i.e(r)}finally{i.f()}}),y.Z_),(0,y.YP)((function(){return{viewReady:e.view.ready,viewSpatialReference:e.view.spatialReference,snappingEnginesFactory:e.snappingEnginesFactory}}),(function(t){var n=t.viewReady,i=t.snappingEnginesFactory;return e._recreateEngines(n,i)}),y.tX)])}},{key:"destroy",value:function(){this._destroyEngines()}},{key:"updating",get:function(){return this._engines.some((function(e){return e.updating}))}},{key:"_recreateEngines",value:function(e,t){if(this._destroyEngines(),e){var n=this.view,i=this.options;this._engines=t(n,i)}}},{key:"_destroyEngines",value:function(){var e,t=(0,o.Z)(this._engines);try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}this._engines=[]}},{key:"_squaredMouseProximityTreshold",get:function(){return this.options.distance*this.options.distance}},{key:"_squaredTouchProximityThreshold",get:function(){var e=this.options,t=e.distance*e.touchSensitivityMultiplier;return t*t}},{key:"_squaredSatisfiesConstraintThreshold",get:function(){return tn.satisfiesConstraintScreenThreshold*tn.satisfiesConstraintScreenThreshold}},{key:"snap",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",Ii(t)?this._snapMultiPoint(t):this._snapSinglePoint(t));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"update",value:function(e){var t=e.point,n=e.context;this._removeVisualization();var i=this._currentMainCandidate;if((0,v.Wi)(i))return t;var r=this._selectUpdateInput(e);if((0,v.Wi)(r))return t;var a=n.spatialReference,s=(0,z.iV)(r,a);if((0,v.Wi)(s))return t;var l=this.view,u=n.elevationInfo,c=n.visualizer,d=[],p=(0,rn.dF)(s,l,n),h=i.constraint.closestTo(p);if(!this._arePointsWithinScreenThreshold(p,h,n))return this._resetSnappingState(),t;i.targetPoint=h,d.push.apply(d,(0,ye.Z)(i.hints));var f,y=(0,o.Z)(this._currentOtherActiveCandidates);try{for(y.s();!(f=y.n()).done;){var g=f.value;g.targetPoint=h,d.push.apply(d,(0,ye.Z)(g.hints))}}catch(m){y.e(m)}finally{y.f()}return(0,v.pC)(c)&&this.handles.add(c.draw(d,{spatialReference:a,elevationInfo:Fi(n),view:l,selfSnappingZ:n.selfSnappingZ}),Wi),(0,rn.Gs)(h,l,{z:t.z,m:t.m,spatialReference:t.spatialReference,elevationInfo:u})}},{key:"doneSnapping",value:function(){this._removeVisualization(),this._resetSnappingState()}},{key:"_selectUpdateInput",value:function(e){var t=e.point,n=e.scenePoint;switch(this._currentSnappedType){case Gi.MAIN:return t;case Gi.SCENE:return n}}},{key:"_resetSnappingState",value:function(){this._currentMainCandidate=null,this._currentOtherActiveCandidates=[],this._currentSnappedType=Gi.MAIN}},{key:"_removeVisualization",value:function(){this.handles.remove(Wi)}},{key:"_snapSinglePoint",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,s,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.point,i=t.context,a=t.signal,o=this.view,s=(0,rn.dF)(n,o,i),e.next=5,this._fetchCandidates(s,nn.B.ALL,i,a);case 5:return l=e.sent,e.abrupt("return",this._createSnapResult(s,Gi.MAIN,l,o,i,{z:n.z,m:n.m,spatialReference:n.spatialReference,elevationInfo:i.elevationInfo},a));case 7:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_snapMultiPoint",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){var n,i,a,o,s,l,u,c,d,p,h,f,v,y,g;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.point,o=t.scenePoint,s=t.context,l=t.signal,u=this.view,c=s.coordinateHelper,d=s.spatialReference,e.next=4,(0,z.iQ)(o.spatialReference,d);case 4:return p=(0,z.iV)(o,d),h=(0,rn.dF)(p,u,s),e.next=8,this._fetchCandidates(h,nn.B.FEATURE,s,l);case 8:if(!((f=e.sent).length>0)){e.next=14;break}return e.next=12,this._fetchCandidates(h,nn.B.SELF,s,l);case 12:return v=e.sent,e.abrupt("return",this._createSnapResult(h,Gi.SCENE,[].concat((0,ye.Z)(f),(0,ye.Z)(v)),u,s,{z:p.z,m:p.m,spatialReference:p.spatialReference,elevationInfo:s.elevationInfo},l));case 14:return y=(0,rn.dF)(a,u,s),e.next=17,this._fetchCandidates(y,nn.B.SELF,s,l);case 17:return g=e.sent,e.abrupt("return",this._createSnapResult(y,Gi.MAIN,g,u,s,{z:c.hasZ()&&a.hasZ?null!==(n=a.z)&&void 0!==n?n:0:void 0,m:c.hasM()&&a.hasM?null!==(i=a.m)&&void 0!==i?i:0:void 0,spatialReference:a.spatialReference,elevationInfo:s.elevationInfo},l));case 19:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_fetchCandidates",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,i,a){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(this._engines.map((function(e){return e.fetchCandidates(t,n,i,a)})));case 2:return e.abrupt("return",e.sent.flat());case 3:case"end":return e.stop()}}),e,this)})));return function(t,n,i,r){return e.apply(this,arguments)}}()},{key:"_createSnapResult",value:function(e,t,n,i,r,a,o){var s=this;return{get valid(){return!(0,pt.Hc)(o)},apply:function(){var o=r.spatialReference,l=s._processCandidates(e,t,n,r),u=l.snappedPoint,c=l.hints;return s._removeVisualization(),(0,v.pC)(r.visualizer)&&s.handles.add(r.visualizer.draw(c,{spatialReference:o,elevationInfo:yt.jG,view:i,selfSnappingZ:r.selfSnappingZ}),Wi),(0,rn.Gs)(u,i,a)}}}},{key:"_processCandidates",value:function(e,t,n,i){if(n.length<1)return this.doneSnapping(),{snappedPoint:e,hints:[]};this._currentSnappedType!==t&&this._resetSnappingState(),(0,an.lQ)(e,n);var r=this._currentMainCandidate;if((0,v.pC)(r)){var a=this._findOldConstraintInNewCandidates(r,n);if(a>=0){if(!(n[a]instanceof Hi))return this._intersectWithOtherCandidates(a,n,e,t,i);if(this._arePointsWithinScreenThreshold(e,r.targetPoint,i))return this._updateSnappingCandidate(r,t,n,i)}}return this._intersectWithOtherCandidates(0,n,e,t,i)}},{key:"_findOldConstraintInNewCandidates",value:function(e,t){return e instanceof Hi?this._findOldCandidateIndex(t,e.first)>=0&&this._findOldCandidateIndex(t,e.second)>=0?0:-1:this._findOldCandidateIndex(t,e)}},{key:"_intersectWithOtherCandidates",value:function(e,t,n,i,r){for(var a=r.coordinateHelper,s=t[e],l=[],u=0;u<t.length;++u)if(u!==e){var c,d=t[u],p=(0,o.Z)(s.constraint.intersect(d.constraint));try{for(p.s();!(c=p.n()).done;){var h=c.value.closestTo(s.targetPoint);l.push([new Hi(h,s,d,d.isDraped),this._squaredScreenDistance(n,h,a)])}}catch(f){p.e(f)}finally{p.f()}}return l.length>0&&(l.sort((function(e,t){return e[1]-t[1]})),l[0][1]<this._squaredPointProximityThreshold(r.pointer))?this._updateSnappingCandidate(l[0][0],i,t,r):this._updateSnappingCandidate(s,i,t,r)}},{key:"_updateSnappingCandidate",value:function(e,t,n,i){this.doneSnapping(),this._currentMainCandidate=e,this._currentSnappedType=t;var r=this._currentMainCandidate.targetPoint,a=[];a.push.apply(a,(0,ye.Z)(e.hints));var s,l=(0,o.Z)(n);try{for(l.s();!(s=l.n()).done;){var u=s.value;if(e instanceof Hi){if(u.constraint.equals(e.first.constraint)||u.constraint.equals(e.second.constraint))continue}else if(u.constraint.equals(e.constraint))continue;var c=u.constraint.closestTo(r);this._squaredScreenDistance(c,r,i.coordinateHelper)<this._squaredSatisfiesConstraintThreshold&&(u.targetPoint=r,this._currentOtherActiveCandidates.push(u),a.push.apply(a,(0,ye.Z)(u.hints)))}}catch(d){l.e(d)}finally{l.f()}return{snappedPoint:r,hints:a}}},{key:"_squaredPointProximityThreshold",value:function(e){return"touch"===e?this._squaredTouchProximityThreshold:this._squaredMouseProximityTreshold}},{key:"_arePointsWithinScreenThreshold",value:function(e,t,n){return this._squaredScreenDistance(e,t,n.coordinateHelper)<this._squaredPointProximityThreshold(n.pointer)}},{key:"_squaredScreenDistance",value:function(e,t,n){return(0,an.Bb)(this._toScreen(e,n),this._toScreen(t,n))}},{key:"_toScreen",value:function(e,t){return(0,hn.Rs)(e,t.spatialReference,yt.jG,this.view)}},{key:"_findOldCandidateIndex",value:function(e,t){for(var n=-1,i=0;i<e.length;++i)if(t.constraint.equals(e[i].constraint)){n=i;break}return n}},{key:"test",get:function(){return{visualizationsActive:this.handles.has(Wi),engines:this._engines}}}]),n}(Si.Z.EventedMixin(ut.r));(0,d._)([(0,g.Cb)({constructOnly:!0})],Vi.prototype,"view",void 0),(0,d._)([(0,g.Cb)()],Vi.prototype,"options",void 0),(0,d._)([(0,g.Cb)({readOnly:!0})],Vi.prototype,"updating",null),(0,d._)([(0,g.Cb)()],Vi.prototype,"snappingEnginesFactory",void 0),(0,d._)([(0,g.Cb)()],Vi.prototype,"_engines",void 0),(0,d._)([(0,g.Cb)()],Vi.prototype,"_squaredMouseProximityTreshold",null),(0,d._)([(0,g.Cb)()],Vi.prototype,"_squaredTouchProximityThreshold",null),(0,d._)([(0,g.Cb)()],Vi.prototype,"_squaredSatisfiesConstraintThreshold",null),Vi=(0,d._)([(0,m.j)("esri.views.interactive.snapping.SnappingManager")],Vi),function(e){e[e.MAIN=0]="MAIN",e[e.SCENE=1]="SCENE"}(Gi||(Gi={}));var Wi="visualization-handle";function Ii(e){return(0,v.pC)(e.scenePoint)}function Fi(e){var t=e.coordinateHelper,n=e.elevationInfo;return t.hasZ()?yt.jG:n}var ji=new Map;function Ni(e){if(!ji.has(e)){var t=function(e,t){var n,i,r=new ii({enabled:!0,selfEnabled:!1,featureEnabled:!0,distance:null!==(n=null===t||void 0===t?void 0:t.distance)&&void 0!==n?n:tn.distance,touchSensitivityMultiplier:null!==(i=null===t||void 0===t?void 0:t.touchSensitivityMultiplier)&&void 0!==i?i:tn.touchSensitivityMultiplier});return(0,he.Z)((0,he.Z)({},(0,y.YP)((function(){var t,n,i;return null!==(t=null===(n=e.map)||void 0===n||null===(i=n.allLayers)||void 0===i?void 0:i.toArray())&&void 0!==t?t:[]}),(function(e){r.featureSources=new h.Z(e.map((function(e){return new ti({layer:e,enabled:!0})})))}),y.nn)),{},{options:r})}(e,{distance:10}),n=function(e,t){return new Vi({view:e,options:t,snappingEnginesFactory:function(t,n){return[new fi({view:e,spatialReference:e.spatialReference,options:n})]}})}(e,t.options);ji.set(e,{referenceCount:0,snappingManager:n,remove:function(){t.remove(),n.destroy()}})}var i=ji.get(e);i.referenceCount++;var r=(0,ve.kB)((function(){return function(e,t){t.referenceCount--,t.referenceCount>0||(0,$n.Y)((function(){0===t.referenceCount&&(t.remove(),ji.delete(e))}))}(e,i)}));return(0,he.Z)({snappingManager:i.snappingManager},r)}var qi=function(){function e(t){(0,s.Z)(this,e),this.vertexHandle=null,this.excludeFeature=null,this.visualizer=null,this.selfSnappingZ=null,this.editGeometryOperations=t.editGeometryOperations,this.elevationInfo=t.elevationInfo,this.pointer=t.pointer,this.vertexHandle=t.vertexHandle,this.excludeFeature=t.excludeFeature,this.visualizer=t.visualizer,this.selfSnappingZ=t.selfSnappingZ}return(0,l.Z)(e,[{key:"coordinateHelper",get:function(){return this.editGeometryOperations.data.coordinateHelper}},{key:"spatialReference",get:function(){return this.coordinateHelper.spatialReference}}]),e}(),Ui=n(70178),Bi=n(93463);function Qi(e){var t=e.predicate,n=void 0===t?function(){return!0}:t,i=e.snappingManager,s=e.snappingContext,l=e.updatingHandles,u=e.useZ,c=void 0===u||u,d=new Ge.hM;if((0,v.Wi)(i))return{snappingStep:[Ki,d],cancelSnapping:Ki};var p,h=null,f=null,g=null,m=function(){h=(0,v.IM)(h),i.doneSnapping(),(0,v.pC)(f)&&f.frameTask.remove(),f=null,p=(0,v.hw)(p),g=null},_=function(e,t,n){return(0,pt.Ds)(function(){var i=(0,a.Z)((0,r.Z)().mark((function i(a,o){var s,l,u,c,d,p,h,f,y,g;return(0,r.Z)().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:return s=a.frameTask,l=a.point,u=a.scenePoint,c=a.context,d=a.event,p=a.delta,h=a.getLastState,i.next=3,s.schedule((function(){return e.snap({point:l,scenePoint:u,context:c,signal:o})}),o);case 3:if(!(f=i.sent).valid){i.next=10;break}return i.next=7,s.schedule((function(){return f.apply()}),o);case 7:y=i.sent,g=h(),(0,v.pC)(g.point)&&l!==g.point&&(y=e.update({point:g.point,scenePoint:g.scenePoint,context:c})),!(0,v.Wi)(g.updatePoint)&&(0,Ui.k)(y,g.updatePoint)||(Ji(d.mapEnd,y,p,t),n.execute(d));case 10:case"end":return i.stop()}}),i)})));return function(e,t){return i.apply(this,arguments)}}())}(i,c,d),S=null,w=null,C=null;return{snappingStep:[function(e){if(!n(e))return e;var t=e.action;if("start"===t){var r=e.info,a=function(e){return"3d"===e.type?e.resourceController.scheduler.registerTask(Bi.T8.SNAPPING):Bi.sq}(i.view);if(f=function(e,t,n){return{context:new qi({editGeometryOperations:e.editGeometryOperations,elevationInfo:e.elevationInfo,pointer:e.pointer,vertexHandle:(0,v.pC)(t.info)?t.info.handle:null,excludeFeature:e.excludeFeature,visualizer:e.visualizer}),originalPos:(0,v.pC)(t.snapOrigin)?e.coordinateHelper.vectorToDehydratedPoint(t.snapOrigin):t.mapStart,originalScenePos:(0,v.pC)(t.scenePoints)?t.scenePoints.sceneStart:null,frameTask:n}}(s,e,a),f.context.selfSnappingZ=null,!c&&(0,v.pC)(r)){var u=function(e,t){if(!e.hasZ())return null;var n,i=t.vertices,r=null,a=(0,o.Z)(i);try{for(a.s();!(n=a.n()).done;){var s=n.value,l=e.getZ(s.pos);if((0,v.pC)(r)&&(0,v.pC)(l)&&Math.abs(l-r)>1e-6)return null;(0,v.Wi)(r)&&(r=l)}}catch(u){a.e(u)}finally{a.f()}return r}(s.coordinateHelper,r.handle.component);(0,v.pC)(u)&&(f.context.selfSnappingZ={value:u,elevationInfo:s.elevationInfo})}}if((0,v.pC)(f)){var d=f,b=d.context,k=d.originalScenePos,Z=d.originalPos,P=e.mapEnd,D=e.mapStart,x=e.scenePoints,M=Yi(Z,Xi(P,D)),A=Xi(D,Z),E=(0,he.Z)((0,he.Z)({},e),{},{action:"update"}),R=f.context,T=function(e,t){return(0,v.Wi)(e)||(0,v.Wi)(t)?null:Yi(e,Xi(t.sceneEnd,t.sceneStart))}(k,x),O=i.update({point:M,scenePoint:T,context:b});if(C=O,Ji(P,O,A,c),S=M,w=T,"end"!==t){var L=f.frameTask;(0,v.Wi)(h)&&(h=new AbortController),(g=function(e){l.addPromise((0,pt.R8)(_({frameTask:L,event:E,context:R,point:M,scenePoint:T,delta:A,getLastState:function(){return{point:S,scenePoint:w,updatePoint:e.forceUpdate?null:C}}},(0,v.Wg)(h).signal)))})({forceUpdate:!1}),(0,v.Wi)(p)&&(p=(0,y.YP)((function(){return i.options.effectiveEnabled}),(function(){var e;return null===(e=g)||void 0===e?void 0:e({forceUpdate:!0})})))}}return"end"===t&&m(),e},d],cancelSnapping:function(e){return m(),e}}}function Yi(e,t){var n=(0,k.Z)(t,3),i=n[0],r=n[1],a=n[2],o=(0,O.WG)(e);return o.x+=i,o.y+=r,o.hasZ&&(o.z+=a),o}function Xi(e,t){var n=e.hasZ&&t.hasZ?e.z-t.z:0;return[e.x-t.x,e.y-t.y,n]}function Ji(e,t,n,i){var r=(0,k.Z)(n,3),a=r[0],o=r[1],s=r[2];e.x=t.x+a,e.y=t.y+o,i&&e.hasZ&&t.hasZ&&(e.z=t.z+s)}function Ki(e){return e}var $i=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).constrainResult=function(e){return e},i._snapPoints=null,i._frameTask=null,i._abortController=null,i._stagedPoint=null,i._snap=(0,pt.Ds)(function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,a,o){var s,l;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s=i._frameTask,!(0,v.Wi)(s)){e.next=3;break}return e.abrupt("return");case 3:return e.next=5,s.schedule((function(){return n.snap((0,he.Z)((0,he.Z)({},t),{},{context:a,signal:o}))}),o);case 5:if(l=e.sent,e.t0=l.valid,!e.t0){e.next=10;break}return e.next=10,s.schedule((function(){i.stagedPoint=l.apply(),t!==i._snapPoints&&(0,v.pC)(i._snapPoints)&&(i.stagedPoint=n.update((0,he.Z)((0,he.Z)({},i._snapPoints),{},{context:a})))}),o);case 10:case"end":return e.stop()}}),e)})));return function(t,n,i,r){return e.apply(this,arguments)}}()),i}return(0,l.Z)(n,[{key:"stagedPoint",get:function(){return this._stagedPoint},set:function(e){this._stagedPoint=this.constrainResult(e)}},{key:"initialize",value:function(){var e,t,n="3d"===this.view.type?null===(e=this.view)||void 0===e||null===(t=e.resourceController)||void 0===t?void 0:t.scheduler:null;this._frameTask=(0,v.pC)(n)?n.registerTask(Bi.T8.SNAPPING):Bi.sq}},{key:"destroy",value:function(){this._abortController=(0,v.IM)(this._abortController),this._frameTask=(0,v.hw)(this._frameTask)}},{key:"update",value:function(e,t,n){this._snapPoints=e;var i=e.point,r=e.scenePoint,a=t.update({point:i,scenePoint:r,context:n});return this.stagedPoint=a,a}},{key:"snap",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n,i){var a,o;return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.point,o=t.scenePoint,e.abrupt("return",(this.stagedPoint=n.update({point:a,scenePoint:o,context:i}),this._snapPoints=t,(0,v.Wi)(this._abortController)&&(this._abortController=new AbortController),this._snap(t,n,i,this._abortController.signal)));case 2:case"end":return e.stop()}}),e,this)})));return function(t,n,i){return e.apply(this,arguments)}}()},{key:"resnap",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t,n){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.t0=(0,v.Wi)(this._snapPoints),e.t0){e.next=4;break}return e.next=4,this.snap(this._snapPoints,t,n);case 4:case"end":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}()},{key:"abort",value:function(){this._abortController=(0,v.IM)(this._abortController),this._snapPoints=null}}]),n}(p.Z);(0,d._)([(0,g.Cb)({constructOnly:!0})],$i.prototype,"view",void 0),(0,d._)([(0,g.Cb)()],$i.prototype,"stagedPoint",null),(0,d._)([(0,g.Cb)()],$i.prototype,"constrainResult",void 0),(0,d._)([(0,g.Cb)()],$i.prototype,"_stagedPoint",void 0),$i=(0,d._)([(0,m.j)("esri.views.interactive.snapping.SnappingOperation")],$i);var er=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;(0,s.Z)(this,n),(i=t.call(this,e))._stagedDimension=null,i._computationManipulators=new Map,i._computationHandles=new w.Z,i._getSnappingContext=function(e){var t,n,i=[],r=!1;return function(){for(var a=arguments.length,o=new Array(a),s=0;s<a;s++)o[s]=arguments[s];return r&&t===this&&function(e,t){if(e.length!==t.length)return!1;for(var n=0;n<e.length;++n)if(e[n]!==t[n])return!1;return!0}(o,i)||(n=e.apply(this,o),t=this,i=o,r=!0),n}}((function(e){return new qi({elevationInfo:{mode:"absolute-height",offset:0},pointer:e,editGeometryOperations:new Kn.c(new Jn.XE("point",(0,Xn.Y6)(!0,!1,i.view.spatialReference))),visualizer:new fn})})),i._snappingManagerResult=Ni(e.view),i.addHandles(i._snappingManagerResult),i._unfocusedOffsetManipulatorMaterial=tr(),i._focusedOffsetManipulatorMaterial=tr(),i._thinOffsetManipulatorMaterial=tr(),i._thinOffsetManipulatorMaterial.setParameters({stipplePattern:(0,Sn.z5)(2)}),i._constraintSnappingIndicator=new yn.r({view:e.view,attached:!0,width:1,color:ge.Z.toUnitRGBA(Ae.constraint.color),renderOccluded:xt.yD.OccludeAndTransparent,stipplePattern:(0,Sn.z5)(5)});var r=ge.Z.toUnitRGBA(Ae.disabledPointIndicator.color);return r[3]*=Ae.disabledPointIndicator.opacity,i._stagedStartIndicator=new Un({view:e.view,attached:!1,color:r,size:2*Ae.disabledPointIndicator.radius,elevationInfo:{mode:"absolute-height",offset:0},spatialReference:e.view.renderCoordsHelper.spatialReference,outlineSize:0,renderOccluded:xt.yD.OccludeAndTransparent}),i}return(0,l.Z)(n,[{key:"initialize",value:function(){var e=this;this._snappingOperation=new $i({view:this.view}),this._orientationManipulatorTexture=(0,vt.O)(this.view.toolViewManager.textures),this._orientationManipulatorMaterial=new Yn.j({transparent:!0,writeDepth:!1,textureId:this._orientationManipulatorTexture.texture.id,renderOccluded:xt.yD.Opaque});var t,n=this.analysisViewData.computations,i=(0,o.Z)(n);try{for(i.s();!(t=i.n()).done;){var r=t.value;this._addComputation(r)}}catch(a){i.e(a)}finally{i.f()}this.addHandles([n.on("after-add",(function(t){return e._addComputation(t.item)})),n.on("after-remove",(function(t){return e._removeComputation(t.item)}))]),this.addHandles([(0,y.YP)((function(){return{stagedPoint:e._snappingOperation.stagedPoint,stagedComputation:e._stagedComputation}}),(function(t){var n=t.stagedPoint,i=t.stagedComputation;if(!(0,v.Wi)(i)&&!(0,v.Wi)(n)){var r=(0,O.WG)(n,new Ve.Z);e._applyPointUpdate(i,{endPoint:r})}}),y.Z_),(0,y.YP)((function(){return{stagedDimension:e._stagedDimension,selectedComputation:e.analysisViewData.selectedComputation,firstGrabbedManipulator:e.firstGrabbedManipulator}}),(function(t,n){var i=t.stagedDimension,r=t.selectedComputation,s=t.firstGrabbedManipulator;if(i===(null===n||void 0===n?void 0:n.stagedDimension)&&s===(null===n||void 0===n?void 0:n.firstGrabbedManipulator))for(var l=0,u=[r,null===n||void 0===n?void 0:n.selectedComputation];l<u.length;l++){var c=u[l];if((0,v.pC)(c)){var d=e._computationManipulators.get(c);e._updateManipulators(c,d,t)}}else{var p,h=(0,o.Z)(e._computationManipulators);try{for(h.s();!(p=h.n()).done;){var f=(0,k.Z)(p.value,2),y=f[0],g=f[1];e._updateManipulators(y,g,t)}}catch(a){h.e(a)}finally{h.f()}}}),y.tX),(0,y.YP)((function(){return e.analysis.style.lineSize}),(function(t){e._updateManipulatorStyle(t)}),y.nn),(0,y.YP)((function(){return e.view.state.camera}),(function(){(0,v.pC)(e._stagedComputation)&&e._updateStagedDimensionOffset(e._stagedComputation)})),(0,y.YP)((function(){return(0,v.yw)(e._stagedComputation,(function(t){var n=t.elevationAlignedStartPoint,i=(0,A.c)();return(0,v.pC)(n)&&e.view.renderCoordsHelper.toRenderCoords(n,i)?i:null}))}),(function(t){(0,v.pC)(t)?(e._stagedStartIndicator.vertices=[t],e._stagedStartIndicator.attached=!0):e._stagedStartIndicator.attached=!1}))]),this.addHandles(this._constraintHandles),this.addHandles(this._snappingIndicatorHandles),(0,an.Ob)(this,(function(){var t=e._activeComputation,n=e._stagedComputation;if((0,v.Wi)(t)||(0,v.pC)(n)){var i=(0,v.Pt)(e.view.inputManager.latestPointerType,"mouse"),r=e._getSnappingContext(i);e.updatingHandles.addPromise((0,pt.R8)(e._snappingOperation.resnap(e._snappingManager,r)))}if((0,v.pC)(t)){var a=e._computationManipulators.get(t),o=a.start,s=a.end;if(o.grabbing||s.grabbing)!function(e,t,n){var i=n.constraint,r=n.view,a=e.unconstrainedGeometry;if(!(0,v.Wi)(a)){var o=r.renderCoordsHelper,s=r.spatialReference,l=a.directSegment,u=l.startRenderSpace,c=l.endRenderSpace,d=o.fromRenderCoords(u,new Ve.Z,s),p=o.fromRenderCoords(c,new Ve.Z,s);ht(e,"start"===t?{startPoint:d}:{endPoint:p},{constraint:i,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,unconstrainedGeometry:a,view:r})}}(t,o.grabbing?"start":"end",{constraint:e._computeConstraint(t),view:e.view})}}))}},{key:"destroy",value:function(){this._snappingOperation=(0,v.SC)(this._snappingOperation),this._computationHandles.destroy(),this._constraintSnappingIndicator.destroy(),this._stagedStartIndicator.destroy(),this._orientationManipulatorMaterial.dispose(),this._orientationManipulatorTexture.release()}},{key:"updating",get:function(){return this.updatingHandles.updating||this._snappingManager.updating}},{key:"firstGrabbedManipulator",get:function(){return this.parentTool.firstGrabbedManipulator}},{key:"hasGrabbedManipulators",get:function(){return this.parentTool.hasGrabbedManipulators}},{key:"snappingOptions",get:function(){return this._snappingManager.options}},{key:"_snappingManager",get:function(){return this._snappingManagerResult.snappingManager}},{key:"_activeComputation",get:function(){if((0,v.pC)(this._stagedComputation))return this._stagedComputation;var e=this.analysisViewData.selectedComputation;return this.hasGrabbedManipulators&&(0,v.pC)(e)?e:null}},{key:"_stagedComputation",get:function(){var e=this._stagedDimension,t=this.analysisViewData.computations.at(-1);return(0,v.Wi)(e)||(0,v.Wi)(t)||t.dimension!==e?null:t}},{key:"_constraintHandles",get:function(){var e=this;return[(0,y.gx)((function(){return e.analysisViewData.selectedComputation}),(function(t){t.previousConstraint=e._computeConstraint(t)}),(0,he.Z)((0,he.Z)({},y.tX),{},{equals:ct.fS})),(0,y.YP)((function(){var t=e._activeComputation;if((0,v.Wi)(t))return null;var n=t.dimension;return{measureType:n.measureType,orientation:n.orientation,computation:t}}),(function(e,t){if((0,v.pC)(e)&&(0,v.Wi)(t)){var n=e.measureType,i=e.orientation,r=e.computation;switch(r.previousConstraint){case dt.Horizontal:r.preConstraintProperties={measureType:S.n.Horizontal,orientation:0};break;case dt.Vertical:r.preConstraintProperties={measureType:S.n.Vertical,orientation:0};break;case dt.Direct:r.preConstraintProperties={measureType:S.n.Direct,orientation:i};break;default:r.preConstraintProperties={measureType:n,orientation:i}}}(0,v.Wi)(e)&&(0,v.pC)(t)&&(t.computation.preConstraintProperties=null)}),y.Z_)]}},{key:"_snappingIndicatorHandles",get:function(){var e=this,t="snapping-indicator-event-handles";return[(0,y.YP)((function(){return{stagedComputation:e._stagedComputation,activeComputation:e._activeComputation}}),(function(n){var i=n.stagedComputation,r=n.activeComputation,a=e._constraintSnappingIndicator;if(e.removeHandles(t),(0,v.Wi)(r))a.attached=!1;else if(r===i)a.attached=!0;else{var o=e._computationManipulators.get(r),s=o.start,l=o.end,u=function(){a.attached=s.grabbing||l.grabbing};u(),e.addHandles([s.events.on("grab-changed",u),l.events.on("grab-changed",u)],t)}})),(0,y.YP)((function(){var t=e._activeComputation;return(0,v.pC)(t)?{geometry:t.geometry,constraint:t.previousConstraint}:{}}),(function(t){var n=t.geometry,i=t.constraint,r=e._constraintSnappingIndicator;(0,v.pC)(n)&&(0,v.pC)(i)&&i!==dt.Direct?(r.visible=!0,r.setGeometryFromSegment(n.directSegment)):r.visible=!1}))]}},{key:"removeStaged",value:function(){return!!(0,v.pC)(this._stagedDimension)&&(this.analysis.dimensions.remove(this._stagedDimension),this._stagedDimension=null,!0)}},{key:"onDeactivate",value:function(){this.removeStaged(),this._resetSnappingState()}},{key:"onClick",value:function(e){var t=this._stagedDimension;if((0,v.Wi)(t)){var n=this._onUnstagedClick(e);return this.analysis.dimensions.add(n),null}return this._onStagedClick(e),t}},{key:"onPointerMove",value:function(e){var t=e.mapPoint,n=e.pointerType;if("touch"!==n){var i=this._getSnappingContext(n);this.updatingHandles.addPromise((0,pt.R8)(this._snappingOperation.snap({point:t},this._snappingManager,i)))}}},{key:"onManipulatorSelectionChanged",value:function(){(0,v.pC)(this.analysisViewData.selectedComputation)&&(this._computationManipulators.get(this.analysisViewData.selectedComputation).offset.selected||(this.analysisViewData.selectedDimension=null))}},{key:"_onUnstagedClick",value:function(e){var t=e.mapPoint,n=e.pointerType,i=t;if("mouse"===n){var r=this._getSnappingContext(n);i=this._snappingManager.update({point:t,context:r})}var a=new lt.Z({startPoint:(0,O.WG)(i,new Ve.Z),endPoint:null,measureType:S.n.Horizontal});return this._stagedDimension=a,this._resetSnappingState(),a}},{key:"_onStagedClick",value:function(e){var t=e.mapPoint,n=e.pointerType,i=this._stagedComputation;if(!(0,v.Wi)(i)){var r=t;if("mouse"===n){var a=this._getSnappingContext(n);r=this._snappingManager.update({point:t,context:a})}var o=(0,O.WG)(r,new Ve.Z);this._applyPointUpdate(i,{endPoint:o}),this._stagedDimension=null,this._resetSnappingState()}}},{key:"_resetSnappingState",value:function(){this._snappingManager.doneSnapping(),this._snappingOperation.abort(),this._snappingOperation.stagedPoint=null}},{key:"_addComputation",value:function(e){if(!this._computationManipulators.has(e)){var t=this._setupPointManipulator(e,{isStart:!0}),n=this._setupPointManipulator(e,{isStart:!1}),i=this._setupOffsetManipulator(e),r=this._setupHeadingManipulator(e),a=this._setupRotationManipulator(e),o=this._setupMeasureTypeManipulator(e,S.n.Direct),s=this._setupMeasureTypeManipulator(e,S.n.Horizontal),l=this._setupMeasureTypeManipulator(e,S.n.Vertical),u=new We({start:t,end:n,offset:i,heading:r,rotation:a,direct:o,horizontal:s,vertical:l});this._setupComputationToManipulatorsSync(e,u),this._computationManipulators.set(e,u),this.manipulators.addMany(u.values())}}},{key:"_removeComputation",value:function(e){var t=this._computationManipulators.get(e);if(!(0,v.Wi)(t)){this._computationHandles.remove(e),this._computationManipulators.delete(e);var n,i=(0,o.Z)(t.values());try{for(i.s();!(n=i.n()).done;){var r=n.value;this.manipulators.remove(r)}}catch(a){i.e(a)}finally{i.f()}}}},{key:"_setupComputationToManipulatorsSync",value:function(e,t){var n=this;this._computationHandles.add([(0,y.YP)((function(){return e.geometry}),(function(){return n._updateManipulators(e,t)}),(0,he.Z)((0,he.Z)({},y.tX),{},{equals:ct.fS}))],e)}},{key:"_setupPointManipulator",value:function(e,t){var n=this,i=this.view,r=e.dimension,a=function(e,t){var n=(0,Re.aD)(e,ge.Z.toUnitRGB(Ae.pointManipulators.color),Ae.pointManipulators.opacity,it);return n.available=!1,n.grabCursor="crosshair",n.radius=Ae.pointManipulators.radius,n.metadata=t.metadata,n.collisionPriority=1,n}(i,{metadata:r}),o=function(e,t){var n=t.isStart,i=t.createSnappingPipelineStep,r=t.dimension,a=t.onUpdate,o=t.view,s=n?"startPoint":"endPoint",l=(0,Ge.Xd)(e,(function(e,t,n,l){var u,c=(0,Oe.J4)(e),d=i(l),p=d.snappingStep,h=d.cancelSnapping;n=n.next(c).next((0,Ge.di)(r,[s,"measureType","orientation"])).next(h),(u=t.next(c).next((0,Oe.gv)(o))).next.apply(u,(0,ye.Z)(p)).next((function(e){var t=(0,O.WG)(e.mapEnd,new Ve.Z);a("startPoint"===s?{startPoint:t}:{endPoint:t})}))}));return[l]}(a,{isStart:t.isStart,createSnappingPipelineStep:function(e){return Qi({snappingContext:n._getSnappingContext(e),snappingManager:n._snappingManager,updatingHandles:n.updatingHandles})},dimension:r,onUpdate:function(t){return n._applyPointUpdate(e,t)},view:i});return this._computationHandles.add(o,e),a}},{key:"_setupOffsetManipulator",value:function(e){var t=this.view,n=function(e,t){var n=[(0,A.f)(-.5,0,0),(0,A.f)(.5,0,0)],i=Ae.offsetManipulator.lengthFraction,r=(0,ze.rh)(t.unfocusedMaterial,n.map((function(e){return(0,M.g)((0,A.c)(),e,i)}))),a=r.instantiate({material:t.focusedMaterial});return new Ee.Z((0,he.Z)({view:e,renderObjects:[new Te.r(r,He.Q9.Unfocused|He.Q9.Selected|it),new Te.r(a,He.Q9.Focused|it)],collisionType:{type:"line",paths:[n]},radius:nt(t.lineSizePt)/2,metadata:t.metadata,available:!1},Re.X9))}(t,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,metadata:e.dimension}),i=function(e,t){var n=t.computation,i=t.view;return[(0,Ge.Xd)(e,(function(e,t,r){if(de(n)&&e.selected){var a=n.geometry,o=n.dimension,s=(0,Oe.J4)(e);t.next(s).next(Be(i,o,a.dimensionSegment,a.primaryOffsetAxis)),r.next(s).next((0,Ge.di)(o,["offset"]))}}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}},{key:"_setupHeadingManipulator",value:function(e){var t=this.view,n=Fe(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=function(e,t){var n=t.computation,i=t.view;return[(0,Ge.Xd)(e,(function(e,t,r){qe({cancel:r,computation:n,settingHeading:!0,steps:t,view:i})}))]}(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}},{key:"_setupRotationManipulator",value:function(e){var t=this.view,n=Fe(t,{lineSizePt:this.analysis.style.lineSize,material:this._orientationManipulatorMaterial,metadata:e.dimension}),i=Ne(n,{computation:e,view:t});return this._computationHandles.add(i,e),n}},{key:"_setupMeasureTypeManipulator",value:function(e,t){var n=this.view,i=function(e,t){var n=[(0,A.f)(-.5,0,0),(0,A.f)(.5,0,0)],i=Ae.offsetManipulator.lengthFraction,r=(0,ze.rh)(t.thinOffsetManipulatorMaterial,n),a=(0,ze.rh)(t.unfocusedMaterial,n.map((function(e){return(0,M.g)((0,A.c)(),e,i)}))),o=a.instantiate({material:t.focusedMaterial});return new Ee.Z((0,he.Z)({view:e,renderObjects:[new Te.r(a,He.Q9.Unfocused|it),new Te.r(o,He.Q9.Focused|it),new Te.r(r,it)],collisionType:{type:"line",paths:[n]},radius:nt(t.lineSizePt)/2,available:!1,metadata:t.metadata},Re.X9))}(n,{lineSizePt:this.analysis.style.lineSize,unfocusedMaterial:this._unfocusedOffsetManipulatorMaterial,focusedMaterial:this._focusedOffsetManipulatorMaterial,thinOffsetManipulatorMaterial:this._thinOffsetManipulatorMaterial,metadata:e.dimension}),r=Ue(i,{computation:e,manipulatorMeasureType:t,view:n});return this._computationHandles.add(r,e),i}},{key:"_updateManipulators",value:function(e,t){var n,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{stagedDimension:this._stagedDimension,selectedComputation:this.analysisViewData.selectedComputation,firstGrabbedManipulator:this.firstGrabbedManipulator},r=i.stagedDimension,a=i.selectedComputation,s=i.firstGrabbedManipulator,l=t.start,u=t.end,c=t.offset,d=t.heading,p=t.rotation,h=a===e,f=de(e),y=e.dimension,g=(0,o.Z)(t.values());try{for(g.s();!(n=g.n()).done;){var m=n.value,_=f&&(0,v.Wi)(r)&&((0,v.Wi)(s)||m===s);m===c?(m.available=_,m.selected=h):m.available=_&&h}}catch(P){g.e(P)}finally{g.f()}if(f){(0,v.pC)(this._computeConstraint(e))?t.forEachMeasureTypeManipulator((function(e){return e.available=!1})):t.manipulatorForMeasureType(y.measureType).available=!1;for(var w=0,C=[d,p];w<C.length;w++){var b=C[w];y.measureType===S.n.Direct&&0!==y.offset||(b.available=!1)}ne(e)?p.available=!1:d.available=!1;var k=e.geometry;l.renderLocation=k.directSegment.startRenderSpace,u.renderLocation=k.directSegment.endRenderSpace;var Z=this.view.renderCoordsHelper;(function(e,t,n){var i=t.dimensionSegment,r=t.primaryOffsetAxis,a=oe(rt,t),o=(0,M.k)(a,A.Z)?(0,D.i)(ot):(0,Re.Aq)(a,r,A.Z,ot),s=Math.max((0,M.l)(a),Ae.offsetManipulator.minLengthMeters/n.unitInMeters);(0,D.k)(o,o,(0,M.s)(rt,s,s,s)),e.modelTransform=o,e.renderLocation=i.eval(.5,rt)})(c,k,Z),d.available&&function(e,t,n){Ye(e,t,n,{forHeading:!0})}(d,e,Z),p.available&&function(e,t,n){Ye(e,t,n,{forHeading:!1})}(p,e,Z),t.forEachMeasureTypeManipulator((function(t,n){t.available&&function(e,t,n,i){var r=t.geometry,a=X(st,n,t,i),o=ee(rt,{measureType:n,directSegment:r.directSegment,renderCoordsHelper:i}),s=(0,M.w)(at,a.endRenderSpace,a.startRenderSpace),l=(0,Re.Aq)(s,o,A.Z,ot),u=(0,M.l)(s);(0,D.k)(l,l,(0,M.s)(at,u,u,u)),e.modelTransform=l,e.renderLocation=a.eval(.5,at)}(t,e,n,Z)}))}}},{key:"_updateManipulatorStyle",value:function(e){var t,n=function(e){return(0,_e.F2)(e)+Ae.offsetManipulator.linePaddingPx}(e),i=nt(e),r={lineSizePt:e,material:this._orientationManipulatorMaterial},a=(0,o.Z)(this._computationManipulators.values());try{for(a.s();!(t=a.n()).done;){var s=t.value,l=s.offset,u=s.heading,c=s.rotation;l.radius=i/2,je(u,r),je(c,r)}}catch(d){a.e(d)}finally{a.f()}this._unfocusedOffsetManipulatorMaterial.setParameters({width:n}),this._focusedOffsetManipulatorMaterial.setParameters({width:i})}},{key:"_applyPointUpdate",value:function(e,t){var n=this.view,i=B(e);"startPoint"in t&&(i.elevationAlignedStartPoint=t.startPoint),"endPoint"in t&&(i.elevationAlignedEndPoint=t.endPoint);var r=Q(i,n.renderCoordsHelper);if(!(0,v.Wi)(r)){var a=this._computeConstraint((0,he.Z)((0,he.Z)({},i),{},{geometry:r}));ht(e,t,(0,he.Z)((0,he.Z)({},i),{},{constraint:a,unconstrainedGeometry:r,view:n})),e===this._stagedComputation&&this._updateStagedDimensionOffset(e)}}},{key:"_updateStagedDimensionOffset",value:function(e){if(!(0,v.Wi)(e.geometry)){e.geometry.directSegment.eval(.5,ir);var t=this.view.state.camera.computeRenderPixelSizeAt(ir);e.dimension.offset=Ae.initialOffsetPx*t}}},{key:"_computeConstraint",value:function(e){return function(e,t){if(ue(e))return dt.Direct;if(!e.enabled)return null;var n=e.geometry;if((0,v.Wi)(n)||(0,M.k)(n.directSegment.startRenderSpace,n.directSegment.endRenderSpace))return null;var i=Ae.constraintThresholdPx,r=t.state.camera,a=re(R.WM.get(),n,t.renderCoordsHelper),o=ae(R.WM.get(),n),s=(0,M.g)(R.WM.get(),a,(0,M.e)(o,a)),l=(0,M.b)(R.WM.get(),o,s),u=(0,M.p)(l),c=(0,M.p)(s),d=n.directSegment,p=d.startRenderSpace,h=d.endRenderSpace,f=Math.pow(Math.max(r.computeRenderPixelSizeAt(p)*i,r.computeRenderPixelSizeAt(h)*i),2);return u<f?dt.Vertical:c<f?dt.Horizontal:null}(function(e,t){return{enabled:t.effectiveFeatureEnabled,elevationAlignedStartPoint:e.elevationAlignedStartPoint,elevationAlignedEndPoint:e.elevationAlignedEndPoint,geometry:e.geometry}}(e,this._snappingManager.options),this.view)}},{key:"testInfo",get:function(){var e=this,t=function(t){return e.analysisViewData.computations.find((function(e){return e.dimension===t}))};return{disableManipulatorPartialOcclusion:function(){e._stagedStartIndicator.renderOccluded=xt.yD.Occlude,e.manipulators.forEach((function(e){var t,n=e.manipulator,i=(0,o.Z)(n.renderObjects);try{for(i.s();!(t=i.n()).done;){t.value.geometry.material.setParameters({renderOccluded:xt.yD.Occlude})}}catch(r){i.e(r)}finally{i.f()}}))},getManipulatorsForDimension:function(n){return e._computationManipulators.get(t(n))},getComputationForDimension:function(e){return t(e)},getConstraintForDimension:function(n){var i=t(n);return(0,v.pC)(i)?e._computeConstraint(i):null},stagedDimension:this._stagedDimension,stagedStartIndicator:this._stagedStartIndicator,constraintSnappingIndicator:this._constraintSnappingIndicator,snappingManager:this._snappingManager}}}]),n}(ut.r);function tr(){var e=Ae.offsetManipulator,t=e.color,n=e.opacity;return new Et.U({color:[].concat((0,ye.Z)(ge.Z.toUnitRGB(t)),[n]),width:1,renderOccluded:xt.yD.OccludeAndTransparent,writeDepth:!1,hasPolygonOffset:!0})}(0,d._)([(0,g.Cb)({constructOnly:!0})],er.prototype,"analysis",void 0),(0,d._)([(0,g.Cb)({constructOnly:!0})],er.prototype,"analysisViewData",void 0),(0,d._)([(0,g.Cb)({constructOnly:!0})],er.prototype,"manipulators",void 0),(0,d._)([(0,g.Cb)({constructOnly:!0})],er.prototype,"parentTool",void 0),(0,d._)([(0,g.Cb)({constructOnly:!0,nonNullable:!0})],er.prototype,"view",void 0),(0,d._)([(0,g.Cb)({readOnly:!0})],er.prototype,"updating",null),(0,d._)([(0,g.Cb)()],er.prototype,"firstGrabbedManipulator",null),(0,d._)([(0,g.Cb)()],er.prototype,"hasGrabbedManipulators",null),(0,d._)([(0,g.Cb)()],er.prototype,"snappingOptions",null),(0,d._)([(0,g.Cb)()],er.prototype,"_stagedDimension",void 0),(0,d._)([(0,g.Cb)()],er.prototype,"_activeComputation",null),(0,d._)([(0,g.Cb)()],er.prototype,"_stagedComputation",null),er=(0,d._)([(0,m.j)("esri.views.3d.analysis.Dimension.LengthDimensionSubTool")],er);var nr,ir=(0,A.c)(),rr=n(88153),ar=n(54463),or=n(76365),sr=n(87888),lr=n(72612);!function(e){e.Ready="ready",e.Creating="creating",e.Created="created"}(nr||(nr={}));var ur=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).automaticManipulatorSelection=!1,i.removeIncompleteOnCancel=!1,i._pointerMoveTimerMs=Ae.pointerMoveTimeoutMs,i._prevPointerMoveTimeout=null,i}return(0,l.Z)(n,[{key:"initialize",value:function(){var e=this;this._intersector=(0,rr.Z8)(this.view.state.viewingMode),this._intersector.options.store=ar.eC.MIN,this._lengthDimensionSubTool=new er({analysis:this.analysis,analysisViewData:this.analysisViewData,manipulators:this.manipulators,parentTool:this,view:this.view}),this.addHandles([(0,ve.ed)(this._lengthDimensionSubTool),(0,ve.kB)((function(){return e._clearPointerMoveTimeout()})),(0,y.YP)((function(){return e.state}),(function(t){t===nr.Created&&e.finishToolCreation()}),y.tX),(0,y.gx)((function(){return e.firstGrabbedManipulator}),(function(t){e.selectedDimension=t.metadata}),y.tX),(0,y.YP)((function(){return e.selectedDimension}),(function(){return e._resetPointerMoveTimeout()}),y.tX)])}},{key:"state",get:function(){return this.analysis.dimensions.some((function(e){return"length"===e.type}))?(0,v.pC)(this._activeSubTool)?nr.Creating:nr.Created:nr.Ready}},{key:"updating",get:function(){return this._lengthDimensionSubTool.updating}},{key:"cursor",get:function(){return this.active?"crosshair":null}},{key:"selectedDimension",get:function(){return this.analysisViewData.selectedDimension},set:function(e){this.analysisViewData.selectedDimension=e}},{key:"onInputEvent",value:function(e){switch(e.type){case"immediate-click":this._clickHandler(e);break;case"immediate-double-click":this._doubleClickHandler(e);break;case"pointer-move":this._pointerMoveHandler(e);break;case"key-down":if(sr.j.cancel===e.key){if((0,v.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged())return void e.stopPropagation();this.active||(this.selectedDimension=null)}else sr.j.delete.includes(e.key)&&this._deleteKeyHandler()}}},{key:"onActivate",value:function(){this._activeSubTool=this._lengthDimensionSubTool}},{key:"onDeactivate",value:function(){(0,v.pC)(this._activeSubTool)&&(this._activeSubTool.onDeactivate(),this._activeSubTool=null)}},{key:"onShow",value:function(){this._resetPointerMoveTimeout()}},{key:"onManipulatorSelectionChanged",value:function(){this._lengthDimensionSubTool.onManipulatorSelectionChanged()}},{key:"onHide",value:function(){this.selectedDimension=null}},{key:"_clickHandler",value:function(e){if(this.hasFocusedManipulators)e.stopPropagation();else if(!(0,v.Wi)(this._activeSubTool)){var t=this._intersectScreen(e);(0,v.Wi)(t)||(this.selectedDimension=this._activeSubTool.onClick({mapPoint:t,pointerType:e.pointerType}),e.stopPropagation())}}},{key:"_doubleClickHandler",value:function(e){this.active&&(this.view.activeTool=null,e.stopPropagation())}},{key:"_pointerMoveHandler",value:function(e){if(this._resetPointerMoveTimeout(),!(0,v.Wi)(this._activeSubTool)&&!this.hasFocusedManipulators){var t=this._intersectScreen(e);(0,v.Wi)(t)||this._activeSubTool.onPointerMove({mapPoint:t,pointerType:e.pointerType})}}},{key:"_deleteKeyHandler",value:function(){(0,v.pC)(this._activeSubTool)&&this._activeSubTool.removeStaged(),this._removeSelected()}},{key:"_intersectScreen",value:function(e){var t=(0,lr.Sj)(e);this.view.sceneIntersectionHelper.intersectToolIntersectorScreen(t,this._intersector);var n=this._intersector.results.min,i=R.WM.get();return n.getIntersectionPoint(i)?this.view.renderCoordsHelper.fromRenderCoords(i,this.view.spatialReference):null}},{key:"_removeSelected",value:function(){(0,v.pC)(this.selectedDimension)&&(this.analysis.dimensions.remove(this.selectedDimension),this.selectedDimension=null)}},{key:"_clearPointerMoveTimeout",value:function(){this._prevPointerMoveTimeout=(0,v.hw)(this._prevPointerMoveTimeout)}},{key:"_resetPointerMoveTimeout",value:function(){var e=this;this._clearPointerMoveTimeout(),this.manipulators.forEach((function(e){e.manipulator.state|=it})),this._prevPointerMoveTimeout=fe.m.setTimeout((function(){e.manipulators.forEach((function(e){e.manipulator.state&=~it}))}),this._pointerMoveTimerMs)}},{key:"testInfo",get:function(){var e=this;return(0,he.Z)((0,he.Z)({},this._lengthDimensionSubTool.testInfo),{},{setManipulatorAutoHideDelay:function(t){e._pointerMoveTimerMs=t,e._resetPointerMoveTimeout()}})}}]),n}(or.f);(0,d._)([(0,g.Cb)({constructOnly:!0})],ur.prototype,"view",void 0),(0,d._)([(0,g.Cb)({constructOnly:!0})],ur.prototype,"analysis",void 0),(0,d._)([(0,g.Cb)({readOnly:!0})],ur.prototype,"state",null),(0,d._)([(0,g.Cb)({readOnly:!0})],ur.prototype,"updating",null),(0,d._)([(0,g.Cb)({readOnly:!0})],ur.prototype,"cursor",null),(0,d._)([(0,g.Cb)({constructOnly:!0})],ur.prototype,"analysisViewData",void 0),(0,d._)([(0,g.Cb)()],ur.prototype,"selectedDimension",null),(0,d._)([(0,g.Cb)()],ur.prototype,"automaticManipulatorSelection",void 0),(0,d._)([(0,g.Cb)()],ur.prototype,"_activeSubTool",void 0),(0,d._)([(0,g.Cb)()],ur.prototype,"_lengthDimensionSubTool",void 0),ur=(0,d._)([(0,m.j)("esri.views.3d.analysis.Dimension.DimensionTool")],ur);n(59166);var cr=n(58935),dr=n(61201),pr=n(79685),hr=n(21317),fr=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e,i){var r;return(0,s.Z)(this,n),(r=t.call(this,e))._hasExternalMaterial=!1,r._renderOccluded=xt.yD.OccludeAndTransparent,r._width=1,r._color=(0,St.f)(1,0,1,1),r._placement="end",r._textureId=null,r._material=i,r._hasExternalMaterial=(0,v.pC)(i),r.applyProps(e),r}return(0,l.Z)(n,[{key:"setGeometryFromSegment",value:function(e,t){var n=e.endRenderSpace;this.transform=(0,D.f)(vr,n),this._normal=t;var i=e.createRenderGeometry(n,this.view.renderCoordsHelper).points;this.geometry=[i]}},{key:"renderOccluded",get:function(){return(0,v.pC)(this._material)?this._material.parameters.renderOccluded:this._renderOccluded},set:function(e){this._renderOccluded=e,(0,v.pC)(this._material)&&this._material.setParameters({renderOccluded:e})}},{key:"geometry",get:function(){return this._geometry},set:function(e){this._geometry=e,this.recreateGeometry()}},{key:"normal",get:function(){return this._normal},set:function(e){this._normal=e,this.recreateGeometry()}},{key:"width",get:function(){return(0,v.pC)(this._material)?this._material.parameters.width:this._width},set:function(e){this._width=e,(0,v.pC)(this._material)&&this._material.setParameters({width:e})}},{key:"color",get:function(){return(0,v.pC)(this._material)?this._material.parameters.color:this._color},set:function(e){this._color=(0,St.c)(e),(0,v.pC)(this._material)&&this._material.setParameters({color:this._color})}},{key:"placement",get:function(){return(0,v.pC)(this._material)?this._material.parameters.placement:this._placement},set:function(e){this._placement=e,(0,v.pC)(this._material)&&this._material.setParameters({placement:this._placement})}},{key:"textureId",get:function(){return(0,v.pC)(this._material)?this._material.parameters.textureId:this._textureId},set:function(e){this._textureId=e,(0,v.pC)(this._material)&&this._material.setParameters({textureId:e})}},{key:"createExternalResources",value:function(){this._hasExternalMaterial||(this._material=new hr.X({width:this._width,color:this._color,placement:this._placement,renderOccluded:this._renderOccluded,textureId:this._textureId}))}},{key:"destroyExternalResources",value:function(){this._hasExternalMaterial||(this._material=null)}},{key:"createGeometries",value:function(e){var t,n=(0,o.Z)((0,pr.c)(this.geometry,this.normal));try{for(n.s();!(t=n.n()).done;){var i=t.value,r=(0,pr.Y)((0,v.Wg)(this._material),i);e.addGeometry(r)}}catch(a){n.e(a)}finally{n.f()}}},{key:"forEachExternalMaterial",value:function(e){this._hasExternalMaterial||e((0,v.Wg)(this._material))}}]),n}(Wn._),vr=(0,x.c)(),yr=function(){function e(t){var n=this;(0,s.Z)(this,e),this.destroyed=!1,this._handles=new w.Z,this._messages=null,this._labelSegment=new L.y;var i=t.analysis,r=t.computation,a=t.view,o=t.messages;this.analysis=i,this.computation=r,this.view=a,this._messages=o;var l=t.visible,u={view:a,attached:l},c=i.style,d=c.fontSize,p=c.textColor,h=c.textBackgroundColor;this._visualElements=new Sr({marker:new fr(u,t.markerMaterial),dimension:new yn.r(u,t.dimensionLineMaterial),startOffset:new yn.r(u,t.offsetLineMaterial),endOffset:new yn.r(u,t.offsetLineMaterial),dimensionSmall:new yn.r(u,t.smallDimensionLineMaterial),startOffsetSmall:new yn.r(u,t.smallOffsetLineMaterial),endOffsetSmall:new yn.r(u,t.smallOffsetLineMaterial),label:new dr.Kc({view:a,attached:l,distance:0,geometry:{type:"segment",sampleLocation:"center",segment:this._labelSegment,callout:!1},fontSize:(0,_e.F2)(d),textColor:p.clone(),backgroundColor:h.clone()})}),this._handles.add([(0,y.YP)((function(){return r.geometry}),(function(e){n.updateCameraDependentElements(a.state.camera,e,i.style),(0,v.pC)(r.geometry)&&n._updateLines(r.geometry)}),(0,he.Z)((0,he.Z)({},y.nn),{},{equals:ct.fS})),(0,y.YP)((function(){return r.length}),(function(e){return n._updateLabelContent(e)}),y.nn)])}return(0,l.Z)(e,[{key:"visible",set:function(e){var t,n=(0,o.Z)(this._visualElements.values());try{for(n.s();!(t=n.n()).done;){t.value.attached=e}}catch(i){n.e(i)}finally{n.f()}}},{key:"destroy",value:function(){this.destroyed=!0,this._handles=(0,v.SC)(this._handles);var e,t=(0,o.Z)(this._visualElements.values());try{for(t.s();!(e=t.n()).done;){e.value.destroy()}}catch(n){t.e(n)}finally{t.f()}}},{key:"testInfo",get:function(){return{dimensionVisualElement:this._visualElements.dimension,label:this._visualElements.label}}},{key:"_updateLines",value:function(e){var t=Y(gr,I.Start,e.directSegment,e.dimensionSegment),n=Y(mr,I.End,e.directSegment,e.dimensionSegment),i=this._visualElements;i.marker.setGeometryFromSegment(e.dimensionSegment,e.primaryOffsetAxis),i.dimension.setGeometryFromSegment(e.dimensionSegment),i.startOffset.setGeometryFromSegment(t),i.endOffset.setGeometryFromSegment(n),i.dimensionSmall.setGeometryFromSegment(e.dimensionSegment),i.startOffsetSmall.setGeometryFromSegment(t),i.endOffsetSmall.setGeometryFromSegment(n)}},{key:"updateCameraDependentElements",value:function(e,t,n){var i=this._visualElements;if((0,v.Wi)(t)){var r,a=(0,o.Z)(i.values());try{for(a.s();!(r=a.n()).done;){r.value.visible=!1}}catch(m){a.e(m)}finally{a.f()}}else{var s=e.computeScreenPixelSizeAt(t.dimensionSegment.eval(.5,_r)),l=function(e,t){return(0,M.p)(oe(le,e))/Math.pow(t,2)}(t,s),u=l<Math.pow((0,_e.F2)(n.lineSize)*Ae.smallScreenLengthLineSizeFactor,2),c=!u;i.marker.visible=c,i.dimension.visible=c,i.startOffset.visible=c,i.endOffset.visible=c,i.dimensionSmall.visible=u,i.startOffsetSmall.visible=u,i.endOffsetSmall.visible=u;var d=(0,_e.F2)(n.fontSize)*Ae.labels.minScreenLengthFontSizeFactor,p=i.label;if(p.visible=l>=Math.pow(d,2),p.visible){var h=t.dimensionSegment,f=t.primaryOffsetAxis,y=this.computation.dimension.offset,g=(Math.sign(y)>=0?1:-1)*function(e){return 1.5*(0,_e.F2)(e.fontSize)+Ae.labels.marginPx+(0,_e.F2)(e.lineSize/2)}(n)*s;(function(e,t,n,i){(0,M.z)(e.startRenderSpace,t.startRenderSpace,n,i),(0,M.z)(e.endRenderSpace,t.endRenderSpace,n,i)})(this._labelSegment,h,f,g),p.updateLabelPosition()}}}},{key:"updateLabelStyle",value:function(e){var t=this._visualElements.label;t.fontSize=(0,_e.F2)(e.fontSize),t.textColor=e.textColor,t.backgroundColor=e.textBackgroundColor}},{key:"updateUnitsMessages",value:function(e){this._messages=e;var t=this.computation.length;this._updateLabelContent(t)}},{key:"_updateLabelContent",value:function(e){var t=this._visualElements.label;(0,v.Wi)(e)||(0,v.Wi)(this._messages)?t.text="":t.text=(0,cr.VG)(this._messages,e,e.unit)}}]),e}();var gr=new L.y,mr=new L.y,_r=(0,A.c)(),Sr=function(){function e(t){(0,s.Z)(this,e),this.marker=t.marker,this.dimension=t.dimension,this.startOffset=t.startOffset,this.endOffset=t.endOffset,this.dimensionSmall=t.dimensionSmall,this.startOffsetSmall=t.startOffsetSmall,this.endOffsetSmall=t.endOffsetSmall,this.label=t.label}return(0,l.Z)(e,[{key:"values",value:function(){return[this.marker,this.dimension,this.startOffset,this.endOffset,this.dimensionSmall,this.startOffsetSmall,this.endOffsetSmall,this.label]}}]),e}(),wr=n(89261),Cr=function(){function e(t,n){(0,s.Z)(this,e),this._textures=t,this._textureRepository=n,this._texturesByPrimitive=new Map}return(0,l.Z)(e,[{key:"acquire",value:function(e){if(!this._texturesByPrimitive.has(e)){var t=(0,Le.uM)(this._textures,e),n=new wr.T(this._textureRepository,t.texture.id);return this._texturesByPrimitive.set(e,{result:t,reference:n}),t.texture}return this._texturesByPrimitive.get(e).result.texture}},{key:"destroy",value:function(){this._texturesByPrimitive.forEach((function(e){var t=e.result;e.reference.dispose(),t.release()})),this._texturesByPrimitive.clear()}}]),e}(),br=n(33720),kr=n(36257),Zr=n(41201),Pr=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).loadingMessages=!1,i._messages=null,i._dimensionVisualizations=new Map,i._markerMaterial=new hr.X({width:1,anchor:br.i5.Tip,color:_n.Z,placement:"begin-end",worldSpace:!0,hideOnShortSegments:!0,hasTip:!0,renderOccluded:xt.yD.OccludeAndTransparent}),i._dimensionLineMaterial=new Et.U({width:1,color:_n.Z,renderOccluded:xt.yD.OccludeAndTransparent,markerParameters:i._markerMaterial.parameters}),i._offsetLineMaterial=new Et.U({width:1,color:_n.Z,renderOccluded:xt.yD.OccludeAndTransparent,stipplePattern:(0,Sn.z5)(5),stippleScaleWithLineWidth:!0}),i._smallDimensionLineMaterial=new Et.U({width:1,color:_n.Z,renderOccluded:xt.yD.OccludeAndTransparent}),i._smallOffsetLineMaterial=new Et.U({width:1,color:_n.Z,renderOccluded:xt.yD.OccludeAndTransparent,stipplePattern:(0,Sn.z5)(5),stippleScaleWithLineWidth:!0}),i}return(0,l.Z)(n,[{key:"analysis",get:function(){return this.analysisViewData.analysis}},{key:"visible",get:function(){return this.analysisViewData.visible}},{key:"initialize",value:function(){var e,t=this,n=null===(e=this.view.sharedSymbolResources)||void 0===e?void 0:e.textures;if((0,v.pC)(n)){var i=this.view._stage.renderView.textureRepository,r=new Cr(n,i),a=r.acquire("triangle");this.addHandles((0,ve.kB)((function(){return r.destroy()}))),this._markerMaterial.setParameters({textureId:a.id})}var s,l=(0,o.Z)(this._lineMaterials());try{var u=function(){var e=s.value;t.view._stage.add(e),t.addHandles((0,ve.kB)((function(){t.view._stage.remove(e),e.dispose()})))};for(l.s();!(s=l.n()).done;)u()}catch(f){l.e(f)}finally{l.f()}var c,d=this.analysisViewData.computations,p=(0,o.Z)(d);try{for(p.s();!(c=p.n()).done;){var h=c.value;this._addComputation(h)}}catch(f){p.e(f)}finally{p.f()}this.addHandles([d.on("change",(function(e){var n,i=e.added,r=e.removed,a=(0,o.Z)(r);try{for(a.s();!(n=a.n()).done;){var s=n.value;t._removeComputation(s)}}catch(f){a.e(f)}finally{a.f()}var l,u=(0,o.Z)(i);try{for(u.s();!(l=u.n()).done;){var c=l.value;t._addComputation(c)}}catch(f){u.e(f)}finally{u.f()}})),(0,y.YP)((function(){return ge.Z.toUnitRGBA(t.analysis.style.color)}),(function(e){var n,i=(0,o.Z)(t._lineMaterials());try{for(i.s();!(n=i.n()).done;){n.value.setParameters({color:e})}}catch(f){i.e(f)}finally{i.f()}}),y.tX),(0,y.YP)((function(){return t.analysis.style.lineSize}),(function(e){var n=(0,_e.F2)(e);t._markerMaterial.setParameters({width:n*Ae.markers.lineSizeFraction}),t._dimensionLineMaterial.setParameters({width:n,markerParameters:t._markerMaterial.parameters});var i=Math.max(n*Ae.offsetLine.lineSizeFraction,1);t._offsetLineMaterial.setParameters({width:i})}),y.tX),(0,y.YP)((function(){return{camera:t.view.state.camera,style:Dr(t.analysis)}}),(function(e){var n,i=e.camera,r=e.style,a=(0,o.Z)(t._dimensionVisualizations);try{for(a.s();!(n=a.n()).done;){var s=(0,k.Z)(n.value,2),l=s[0],u=s[1];u.updateCameraDependentElements(i,l.geometry,r),u.updateLabelStyle(r)}}catch(f){a.e(f)}finally{a.f()}})),(0,y.YP)((function(){return t.visible}),(function(e){var n,i=(0,o.Z)(t._dimensionVisualizations.values());try{for(i.s();!(n=i.n()).done;){n.value.visible=e}}catch(f){i.e(f)}finally{i.f()}}))]),this.addHandles([(0,kr.qe)((function(){return t._updateMessageBundle()})),(0,y.gx)((function(){return!t.loadingMessages}),(function(){var e,n=(0,o.Z)(t._dimensionVisualizations.values());try{for(n.s();!(e=n.n()).done;){e.value.updateUnitsMessages(t._messages)}}catch(f){n.e(f)}finally{n.f()}}),y.Z_)]),this._updateMessageBundle()}},{key:"destroy",value:function(){this._dimensionVisualizations.forEach((function(e){e.destroy()})),this._dimensionVisualizations.clear()}},{key:"testInfo",get:function(){var e=this;return{visualizations:Array.from(this._dimensionVisualizations.values()),disablePartialOcclusion:function(){var t,n=(0,o.Z)(e._lineMaterials());try{for(n.s();!(t=n.n()).done;){t.value.setParameters({renderOccluded:xt.yD.Occlude})}}catch(i){n.e(i)}finally{n.f()}}}}},{key:"_addComputation",value:function(e){this._dimensionVisualizations.has(e)||this._dimensionVisualizations.set(e,new yr({analysis:this.analysis,computation:e,view:this.view,visible:this.visible,markerMaterial:this._markerMaterial,dimensionLineMaterial:this._dimensionLineMaterial,offsetLineMaterial:this._offsetLineMaterial,smallDimensionLineMaterial:this._smallDimensionLineMaterial,smallOffsetLineMaterial:this._smallOffsetLineMaterial,messages:this._messages}))}},{key:"_removeComputation",value:function(e){var t=this._dimensionVisualizations.get(e);(0,v.Wi)(t)||(t.destroy(),this._dimensionVisualizations.delete(e))}},{key:"_lineMaterials",value:function(){return[this._markerMaterial,this._dimensionLineMaterial,this._offsetLineMaterial,this._smallDimensionLineMaterial,this._smallOffsetLineMaterial]}},{key:"_updateMessageBundle",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingMessages=!0,e.prev=1,e.next=4,(0,Zr.ME)("esri/core/t9n/Units");case 4:this._messages=e.sent;case 5:return e.prev=5,this.loadingMessages=!1,e.finish(5);case 8:case"end":return e.stop()}}),e,this,[[1,,5,8]])})));return function(){return e.apply(this,arguments)}}()}]),n}(p.Z);function Dr(e){var t=e.style,n=t.fontSize,i=t.lineSize,r=t.textColor;return{fontSize:n,lineSize:i,textBackgroundColor:t.textBackgroundColor.clone(),textColor:r.clone()}}(0,d._)([(0,g.Cb)({constructOnly:!0})],Pr.prototype,"analysisViewData",void 0),(0,d._)([(0,g.Cb)({constructOnly:!0,nonNullable:!0})],Pr.prototype,"view",void 0),(0,d._)([(0,g.Cb)()],Pr.prototype,"analysis",null),(0,d._)([(0,g.Cb)()],Pr.prototype,"visible",null),(0,d._)([(0,g.Cb)()],Pr.prototype,"loadingMessages",void 0),Pr=(0,d._)([(0,m.j)("esri.views.3d.analysis.Dimension.DimensionVisualization")],Pr);var xr=n(44925),Mr=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).dimension=null,i.length=null,i}return(0,l.Z)(n)}(p.Z);(0,d._)([(0,g.Cb)({constructOnly:!0,nonNullable:!0})],Mr.prototype,"dimension",void 0),(0,d._)([(0,g.Cb)()],Mr.prototype,"length",void 0);var Ar=Mr=(0,d._)([(0,m.j)("esri.views.3d.analysis.LengthDimensionResult")],Mr),Er=["dimension"],Rr=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).geometry=null,i.unconstrainedGeometry=null,i.elevationAlignedStartPoint=null,i.elevationAlignedEndPoint=null,i}return(0,l.Z)(n,[{key:"normalizeCtorArgs",value:function(e){var t=e.dimension,n=(0,xr.Z)(e,Er);return(0,he.Z)({result:new Ar({dimension:t})},n)}},{key:"initialize",value:function(){var e=this;this.addHandles([(0,y.YP)((function(){return e.dimension.startPoint}),(function(t){return e.elevationAlignedStartPoint=e.projectAndAlignPoint(t)}),y.tX),(0,y.YP)((function(){return e.dimension.endPoint}),(function(t){return e.elevationAlignedEndPoint=e.projectAndAlignPoint(t)}),y.tX)])}},{key:"dimension",get:function(){return this.result.dimension}},{key:"length",get:function(){return this.result.length}}]),n}(p.Z);(0,d._)([(0,g.Cb)({constructOnly:!0,nonNullable:!0})],Rr.prototype,"result",void 0),(0,d._)([(0,g.Cb)({constructOnly:!0,nonNullable:!0})],Rr.prototype,"projectAndAlignPoint",void 0),(0,d._)([(0,g.Cb)()],Rr.prototype,"dimension",null),(0,d._)([(0,g.Cb)()],Rr.prototype,"length",null),(0,d._)([(0,g.Cb)()],Rr.prototype,"geometry",void 0),(0,d._)([(0,g.Cb)()],Rr.prototype,"unconstrainedGeometry",void 0),(0,d._)([(0,g.Cb)()],Rr.prototype,"elevationAlignedStartPoint",void 0),(0,d._)([(0,g.Cb)()],Rr.prototype,"elevationAlignedEndPoint",void 0),(0,d._)([(0,g.Cb)()],Rr.prototype,"preConstraintProperties",void 0),(0,d._)([(0,g.Cb)()],Rr.prototype,"previousConstraint",void 0),Rr=(0,d._)([(0,m.j)("esri.views.3d.analysis.LengthDimensionComputation")],Rr);var Tr=n(33906),Or=n(70209),Lr=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this,e)).type="dimension-view-3d",i.tool=null,i.computations=new h.Z,i.selectedDimension=null,i._dimensionsToComputations=new Map,i._placementTask=null,i._projectAndAlignPoint=null,i}return(0,l.Z)(n,[{key:"initialize",value:function(){var e=this;this._projectAndAlignPoint=function(t){if((0,v.Wi)(t))return null;var n=e.view,i=n.spatialReference,r=n.elevationProvider,a=(0,Tr.G)(t,i,r);return(0,v.Wi)(a)&&(0,Tr.e)(e.analysis,t.spatialReference,f.Z.getLogger(e.declaredClass)),a},this.addHandles([(0,Or.Lp)(this,ur),(0,y.on)((function(){return e.analysis.dimensions}),"after-add",(function(t){return e._onDimensionAdd(t.item)}),{onListenerAdd:function(t){var n,i=(0,o.Z)(t);try{for(i.s();!(n=i.n()).done;){var r=n.value;e._onDimensionAdd(r)}}catch(a){i.e(a)}finally{i.f()}},onListenerRemove:function(){e._onDimensionsClear()}}),(0,y.on)((function(){return e.analysis.dimensions}),"after-remove",(function(t){return e._onDimensionRemove(t.item)}))]),this._analysisVisualization=new Pr({analysisViewData:this,view:this.view}),this._analysisController=new pe({analysisViewData:this,view:this.view})}},{key:"destroy",value:function(){this._placementTask=(0,v.IM)(this._placementTask),this._analysisVisualization=(0,v.SC)(this._analysisVisualization),(0,Or.Yq)(this)}},{key:"updating",get:function(){var e,t;return null!==(e=null===(t=this._analysisVisualization)||void 0===t?void 0:t.loadingMessages)&&void 0!==e&&e}},{key:"results",get:function(){var e=this;return this.analysis.dimensions.map((function(t){return e._dimensionsToComputations.get(t).result}))}},{key:"selectedComputation",get:function(){var e=this.selectedDimension;return(0,v.Wi)(e)?null:this._dimensionsToComputations.get(e)}},{key:"testInfo",get:function(){return{visualization:this._analysisVisualization,controller:this._analysisController}}},{key:"createLengthDimensions",value:function(){var e=(0,a.Z)((0,r.Z)().mark((function e(t){return(0,r.Z)().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.selectedDimension=null,this._placementTask=(0,v.IM)(this._placementTask),this._placementTask=(0,Or.Er)(this,t),this._placementTask.promise));case 1:case"end":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}()},{key:"_onDimensionAdd",value:function(e){var t=this.computations,n=this._dimensionsToComputations;if(!n.has(e)){var i=new Rr({dimension:e,projectAndAlignPoint:this._projectAndAlignPoint});t.add(i),n.set(e,i)}}},{key:"_onDimensionRemove",value:function(e){var t=this.computations,n=this._dimensionsToComputations,i=t.findIndex((function(t){return t.dimension===e})),r=t.getItemAt(i);r.dimension===this.selectedDimension&&(this.selectedDimension=null),t.removeAt(i),n.delete(e),(0,v.SC)(r)}},{key:"_onDimensionsClear",value:function(){this.computations.drain((function(e){return e.destroy()})),this._dimensionsToComputations.clear()}}]),n}(function(e){var t=function(e){(0,u.Z)(n,e);var t=(0,c.Z)(n);function n(){var e;(0,s.Z)(this,n);for(var i=arguments.length,r=new Array(i),a=0;a<i;a++)r[a]=arguments[a];return(e=t.call.apply(t,[this].concat(r))).analysis=null,e.tool=null,e.selectedDimension=null,e.interactive=!1,e.visible=null,e}return(0,l.Z)(n,[{key:"results",get:function(){return new h.Z}},{key:"createLengthDimensions",value:function(e){throw new Error("Method not implemented.")}}]),n}(e);return(0,d._)([(0,g.Cb)({constructOnly:!0})],t.prototype,"view",void 0),(0,d._)([(0,g.Cb)({constructOnly:!0,nonNullable:!0})],t.prototype,"analysis",void 0),(0,d._)([(0,g.Cb)()],t.prototype,"tool",void 0),(0,d._)([(0,g.Cb)({readOnly:!0})],t.prototype,"results",null),(0,d._)([(0,g.Cb)()],t.prototype,"selectedDimension",void 0),(0,d._)([(0,g.Cb)()],t.prototype,"interactive",void 0),(0,d._)([(0,g.Cb)()],t.prototype,"visible",void 0),t=(0,d._)([(0,m.j)("esri.views.analysis.DimensionAnalysisView")],t)}((0,_.p)(p.Z)));(0,d._)([(0,g.Cb)({readOnly:!0})],Lr.prototype,"type",void 0),(0,d._)([(0,g.Cb)()],Lr.prototype,"tool",void 0),(0,d._)([(0,g.Cb)()],Lr.prototype,"updating",null),(0,d._)([(0,g.Cb)({readOnly:!0})],Lr.prototype,"results",null),(0,d._)([(0,g.Cb)({readOnly:!0})],Lr.prototype,"computations",void 0),(0,d._)([(0,g.Cb)()],Lr.prototype,"selectedDimension",void 0),(0,d._)([(0,g.Cb)()],Lr.prototype,"selectedComputation",null),(0,d._)([(0,g.Cb)()],Lr.prototype,"_analysisVisualization",void 0),(0,d._)([(0,g.Cb)()],Lr.prototype,"_analysisController",void 0),(0,d._)([(0,g.Cb)()],Lr.prototype,"_dimensionsToComputations",void 0),(0,d._)([(0,g.Cb)()],Lr.prototype,"_placementTask",void 0);var zr=Lr=(0,d._)([(0,m.j)("esri.views.3d.analysis.DimensionAnalysisView3D")],Lr)},96664:function(e,t,n){n.d(t,{O:function(){return s},s:function(){return l}});var i="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAAAnFBMVEUAAAD/gAD/gAD/cAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/gAD/fAD/gAD/fAD/gAD/fAD/fQD/fQD/fQD/fQD/fQD/fgD/jR7/mjn/mjf/p1H/plH/smf/sWb/vHr/u3n/xYz/xIv/zZz/zJv/zJr/1Kv/1Kr/06r/06n/27n/27f/4cX/4cT/59D/7dr/8uX/9u7/+/f////u2EN0AAAAM3RSTlMACBAQICAoKDAwODhAQEhIUFBYYGhweICIkJCXmJ+gp6ivsLe4uL+/wMDHx8/P19/n7/cWvjXwAAACeUlEQVR42tWX3XqiMBCGY2pbtbrUnzhhdak/lHWliJD7v7fdJ+KG5AMhh30P8zCTmS+TycDaeBoHi5Wgf4jVYvbKmRfPgSAHMX9mPRnM1tSIGHM/c2QddLp4c8wxCvYIvqROBPfbHlm/sRYC6smMNTKn3sxZAyvyYNW1v38MM/IkcPQnZHPMLtciz9P9hhqwzoLD+cnfpTIUaYinyZlBkE2YKZcMXCyN/YhsPkuFlMfWJLiwo89VMxfpJDForMCwuG+Zx7ttGO2S/w4LJ42ZURDty5M0a4dqsZAQAihQfXqWdlhnpcmdEPAI0tv2EbnsbsKmdgi6/1GN7T1XJLx5sF0P9SWABMC+co5JBE4Ge/1NTM3EGIJgjFONXCdAbeQYwhN7pRrRV20LJNIhWOczdu+xPFzIBiQ62iIsyIOTvlZUY+HXySLQaMUEeSC1CPYxENIlwk+q8e0clFAIfiKG+qpaIvod4wfU8sqvkDLda+xCCqgDaAk7uyeNqD+feFlfGCcg3Hzsk+xS7Nz1Aq4CcauhhMc0uxaqIgcFsF0J+1WQyoCN7Y9ezeCVH5LhSxmyRvsihKbK1m7LafpSpkpj6yJgtsiVBh6AX5UyCVmMbrNpcwj5/h6DPN79JjAiQAhXVeN6SZI0q5bQnn4wBiHEqpUybp1ZJzWxStVCHhKhAhVLp/Emh6trHpGLaB6yZHk7wu3Z+ChOxhwUNEmYYjpUvqJDksSHraQmJm2DdqQK6sGUObybYtpSN+8Phm3pN2xjDH33R6b0CKxAZNLvl8foD3BBnSw5e8RI+G2P8GD9wHw6YN3wkfA0R4Zz8CGCIfOCv8zM738walXuLw6nXBvPr8wvAAAAAElFTkSuQmCC",r="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAMAAACdt4HsAAACtVBMVEUAAAD/AAD/gAD/VQD/gAD/gAD/bQD/gAD/cQD/gAD/dAD/gAD/gAD/eAD/gAD/eQD/gAD/egD/gAD/ewD/fAD/gAD/gAD/fAD/gAD/fQD/fQD/gAD/fQD/egD/fQD/gAD/egD/fQD/gAD/ewD/gAD/ewD/gAD/ewD/fQD/fQD/gAD/ewD/fQD/gAD/fAD/gAD/fAD/fgD/gAD/fAD/fgD/fAD/fgD/gAD/fAD/fgD/fAD/fgD/fQD/fQD/fgD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fgD/fQD/fQD/fgD/gAL/fgD/gAb/gAT/gwr/hAz/hxH/hQ//iBX/iBP/ixn/iRf/jBr/jR7/jyP/jyL/kif/kCX/kyr/lS7/lCz/ljH/li//mTX/nDr/mjn/nTz/oEL/okf/o0r/pU3/pU7/qFL/plH/qFX/q1j/q1r/rl7/sGL/rmH/s2v/tW//tW7/t3L/uHL/unb/unf/vHv/vX3/v4D/vX7/v4D/wYT/v4L/wYX/x4//x5H/yZX/y5n/zZv/y5n/zJv/zZ3/zp//0aL/z6H/1Kr/1av/06r/1q//17H/2bT/2LP/2rb/27n/3bz/3r7/37//4MH/38D/4ML/4sX/4sb/4sf/48n/5cv/48r/5cz/5s7/6dT/6tb/69j/69n/7Nn/7dv/7dz/7t7/7t3/7+H/7+D/7+H/8eL/8uX/8uX/8ub/8+j/8+f/9On/9er/9Or/9ez/9e3/9ez/9u7/9e3/9+//9+7/+PD/+PH/+fT/+fL/+vb/+vX/+vb/+/f/+vb//Pn/+/j//Pr//Pn//fv//Pr//fv//v3//fz//////v7//v3///8ZYzD6AAAA5nRSTlMAAQIDBAYHCAkKCwwQERITGBkaGyUmKCkqKy0uLzAxMjIzNDQ2Njg4OTs+Pj9AQEJCQ0RERUZHUlJTVFVWWFlfYGFiY2RlZmdoaWprbG1ucHFyc3R1dnd4eXp8f4CAgYGCg4SEhYWGhoeIiYmKiouMjI2Nj5CQkZOUlZaXmJiZmpudnp6io6OkpaanqKmqqqusrK2xs7W2t7e4ubq7u7/AwMLExcXGyMrLzM3NztDR0tPU1NXW29zd3t/g4eLi5OTl5ufo6erq6+zs7e7u7+/w8PHy9PT29vf4+Pn5+vr7+/z9/f7+/pNrFTEAAAO8SURBVHjaldf5W1RVGAfwl4kGxa2yIDPbF82EJhkVUEOiUiDMcJa482XCijStNLLVpoWCbLHFaZUoMSkq2wgtW8mobFcryiiWkffv6J557jh3zj33zvD56f3h3vM873nP+z7nkJ3cPE9JxdX+OgSWX15aMG0CjcnUoiuRSls2byplyH1eDZSqZrkz+d0ThC1/QQ45c521Eo58p5GTSZcirbIpZGtGEBkI5pNaVhEyo3mzSCF7ITJW7CKLYxbDTsPG5qe33QezxdkkySqGndYY615CilI5Cy9sRVjYgVRzKcXJGmzdwsKHkEwnkylB2AsNse5zSIITKWkJnPzCut8gW5IsxRlw9CnrRuohO5MM43xw9D4Lt0JWm2jOOXD2Ogv3w6LQaGA/nL3AwuOwCLpJmIU0nmDheVidQ0IV0niAhQ5YVcfnH2zcCMNtLLwHheOJaB5s7OxuQlx4hHV7oeAhokrYaOeBjkYIv7LuJyhUEU3QYONFZj4YrQfwGeuGQrDSxtM0KK2N7h5koa8V+ICFdVA4SX2Kbt5xmA2j7SHsZGETFOZQqarwhzjhUAuAl1nYDIUFdAVkoe0s/LiLmT9eD91TLDwHhXJaDtmbrPvyEWzg4dfCEB5kYTsUrqIgJK8w8/C2MHDDgWYgromFXVDwkQbDRsRFhpkHWyHcBMO1oyzSgcI1VGdEd8V6o6uA8D7m2BZIDrJuPxTqKGBEnczc33nHFmZ+A7IvWDegTmEF4lb1s3Dk+wH+oxGyj1hYC6saqkDcVk74u6cJsk4W7oXVZVSCuK84aXTP5pBcGeFRWM2nQmMPOw+zyQ9t62DyLAtRWM2mPBgao1+zyVD3wyEkPMTCq7DKo/Gmdo50DbDJd22JbbudhXdgoeUSVcNkTfRbNvnv3U0QGmKs2w2LpUR0MVI1d4+wSW/0egC/i7APFkXKobq+7Wc2+avrHvSK4B/1UKUaWNQ/1nOEk2Kf7GdhNSTLSDgfKhvaDrDsbkhmkuAOQKnhmb2cqkVuBDfFeWDnzo4/2WQrUl2QuB7XwtZ1T+7ho9qRYmUOGc6Gk8hb/xoLvI0Up1KCqxyOVkf3sdADs0soaVIQaUS6Bpm/gUlgMplMR1pron39SNLyKcVcpBduCQMJXpLMx5gsdJEkexHGYJGLLFzFyFhJNilkeTVkxkM28oPIQOAUsjW5DGmVTSQnM3xwVHt6FjnLudAPW4GLMnq7zqyEUvW5x1KGTvAulSqiVRYeR2OSmz+7uKLGpwX8K8oXFJw4zu67/wFaspwc84wT2QAAAABJRU5ErkJggg==",a=n(1487),o={mipmap:!0,preMultiplyAlpha:!0,width:64,height:64};function s(e){return e.fromData(i,(function(){return new a.x(i,o)}))}function l(e){return e.fromData(r,(function(){return new a.x(r,o)}))}},51328:function(e,t,n){n.d(t,{J4:function(){return g},_N:function(){return v},gv:function(){return m}});var i,r=n(1413),a=n(92026),o=n(17842),s=(n(11186),n(71353)),l=(n(79803),n(55652)),u=n(40885),c=(n(40927),n(51378)),d=(n(74509),n(81703)),p=n(88153),h=n(54463),f=n(76783);n(5693);function v(e,t){return y(e,(function(){return t}))}function y(e,t){var n=(0,s.c)(),i=(0,s.c)(),u=!1;return function(s){var p=t(s);if("start"===s.action){var h=(0,o.md)(s.screenStart,(0,o.c$)(c.qW.get())),f=(0,d.u4)(e.state.camera,h,_);(0,a.pC)(f)&&(u=(0,l.BR)(p,f,n))}if(!u)return null;var v=(0,o.md)(s.screenEnd,(0,o.c$)(c.qW.get())),y=(0,d.u4)(e.state.camera,v,_);return(0,a.Wi)(y)?null:(0,l.BR)(p,y,i)?(0,r.Z)((0,r.Z)({},s),{},{renderStart:n,renderEnd:i,plane:p,ray:y}):null}}function g(e){var t=null;return function(n){switch(n.action){case"start":t=e.disableDisplay();break;case"end":case"cancel":(0,a.pC)(t)&&(t.remove(),t=null)}return n}}function m(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=(0,p.Z8)(e.state.viewingMode);n.options.selectionMode=!0,n.options.store=h.eC.MIN,n.options.hud=!1;var l,u=(0,o.s1)(),c={requiresGroundFeedback:!0,enableDraped:!0,exclude:new Set},d=(0,s.c)(),v=(0,a.Pt)(t,e.spatialReference),y=function(t){e.map.ground&&e.map.ground.opacity<1?c.exclude.add(f.cy):c.exclude.delete(f.cy),e.sceneIntersectionHelper.intersectIntersectorScreen((0,o.md)(t,u),n,c);var r,a=n.results.min;if(a.getIntersectionPoint(d))r=a.intersector===h.q7.TERRAIN?i.GROUND:i.OTHER;else{if(!n.results.ground.getIntersectionPoint(d))return null;r=i.GROUND}return{location:e.renderCoordsHelper.fromRenderCoords(d,v),surfaceType:r}};return function(e){if("start"===e.action){var t=y(e.screenStart);l=(0,a.pC)(t)?t.location:null}if((0,a.Wi)(l))return null;var n=y(e.screenEnd);return(0,a.pC)(n)&&(0,a.pC)(n.location)?(0,r.Z)((0,r.Z)({},e),{},{mapStart:l,mapEnd:n.location,surfaceType:n.surfaceType}):null}}!function(e){e[e.GROUND=0]="GROUND",e[e.OTHER=1]="OTHER"}(i||(i={}));(0,s.c)(),(0,s.c)();var _=(0,u.Ue)()},89261:function(e,t,n){n.d(t,{T:function(){return s}});var i=n(15671),r=n(43144),a=n(92026),o=n(66978),s=function(){function e(t,n){var r=this;(0,i.Z)(this,e),this._textureRep=t,this.loadPromise=null,this._disposed=!1;var s=this._textureRep.acquire(n);(0,o.y8)(s)?(s.then((function(e){r._disposed?(0,a.RY)(e):r._textureRef=e})),this.loadPromise=s):this._textureRef=s}return(0,r.Z)(e,[{key:"dispose",value:function(){this._textureRef=(0,a.RY)(this._textureRef),this._disposed=!0}},{key:"glTexture",get:function(){return(0,a.pC)(this._textureRef)?this._textureRef.glTexture:null}}]),e}()},87888:function(e,t,n){n.d(t,{c:function(){return r},j:function(){return i}});var i={redo:"r",undo:"z",center:"Alt",constraint:"Shift",cancel:"Escape",delete:["Backspace","Delete"],complete:"Enter",vertexAdd:"f",pan:" "},r={toggle:"Control"}},95122:function(e,t,n){n.d(t,{Bq:function(){return w},Hk:function(){return m},M8:function(){return D},aU:function(){return Z},jg:function(){return P},kt:function(){return b},ku:function(){return S}});var i=n(29439),r=n(37762),a=n(60136),o=n(29388),s=n(15671),l=n(43144),u=n(92026),c=n(88396),d=n(6394),p=n(11186),h=n(71353),f=n(1700),v=n(55793),y=n(94163),g=function(){function e(){(0,s.Z)(this,e)}return(0,l.Z)(e,[{key:"intersect",value:function(e){return function(e,t){var n=[];if(M(e)){var i=e.point;A(t)?n=(0,v.pk)(t.lineLike,i):E(t)?n=(0,v.Xi)(t.center,t.radius,i):R(t)?n=(0,v.hm)(t.planeLike,i):T(t)&&(n=x(t,e))}else if(A(e)){var r=e.lineLike;M(t)?n=(0,v.pk)(r,t.point):A(t)?n=(0,v.Lh)(r,t.lineLike):E(t)?n=(0,v.CJ)(r,t.center,t.radius):R(t)?n=(0,v.fK)(t.planeLike,r):T(t)&&(n=x(t,e))}else if(E(e)){var a=e.center,o=e.radius;if(A(t))n=(0,v.CJ)(t.lineLike,a,o);else if(M(t))n=(0,v.Xi)(a,o,t.point);else{if(R(t))return(0,v.SD)(t.planeLike,a,o).map((function(n){return new C(n,e,t)}));T(t)&&(n=x(t,e))}}else if(R(e)){var s=e.planeLike;if(R(t))return(0,v.qi)(s,t.planeLike).map((function(n){return new C(n,e,t)}));if(M(t))n=(0,v.hm)(s,t.point);else if(A(t))n=(0,v.fK)(s,t.lineLike);else{if(E(t))return(0,v.SD)(s,t.center,t.radius).map((function(n){return new C(n,e,t)}));T(t)&&(n=x(t,e))}}else T(e)&&(n=x(e,t));return function(e,t,n){return e.map((function(e){return new w((0,f.uc)(e),t,n)}))}(n,e,t)}(this,e)}}]),e}(),m=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i;return(0,s.Z)(this,n),(i=t.call(this)).point=e,i}return(0,l.Z)(n,[{key:"equals",value:function(e){return M(e)&&(0,p.k)(this.point,e.point)}},{key:"closestTo",value:function(){return(0,f.bQ)(this.point)}}]),n}(g),_=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,i,r){var a;return(0,s.Z)(this,n),(a=t.call(this)).start=e,a.end=i,a.type=r,a.lineLike={start:a.start,end:a.end,type:a.type},a}return(0,l.Z)(n,[{key:"equals",value:function(e){return A(e)&&this.type===e.type&&(0,p.k)(this.start,e.start)&&(0,p.k)(this.end,e.end)}},{key:"closestTo",value:function(e){var t=(0,v.ZE)(e,this.lineLike);return(0,f.uc)(t)}}]),n}(g),S=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,i){return(0,s.Z)(this,n),t.call(this,e,i,y.SP.LINE)}return(0,l.Z)(n)}(_),w=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,i,r){var a;return(0,s.Z)(this,n),(a=t.call(this)).intersection=e,a.first=i,a.second=r,a}return(0,l.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&this.first.equals(e.first)&&this.second.equals(e.second)}},{key:"closestTo",value:function(){return(0,f.bQ)(this.intersection)}}]),n}(g),C=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,i,r){var a;return(0,s.Z)(this,n),(a=t.call(this)).basePoint=e,a.first=i,a.second=r,a}return(0,l.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&this.first.equals(e.first)&&this.second.equals(e.second)}},{key:"closestTo",value:function(e){var t=this.basePoint;return(0,f.uc)((0,h.f)(t[0],t[1],e[2]))}}]),n}(g),b=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,i){var r;return(0,s.Z)(this,n),(r=t.call(this)).center=e,r.radius=i,r}return(0,l.Z)(n,[{key:"equals",value:function(e){return E(e)&&this.center[0]===e.center[0]&&this.center[1]===e.center[1]&&this.radius===e.radius}},{key:"closestTo",value:function(e){var t=(0,v.sc)(e,this.center,this.radius);return(0,f.uc)(t)}}]),n}(g),k=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,i,r){var a;return(0,s.Z)(this,n),(a=t.call(this)).start=e,a.end=i,a.type=r,a.planeLike={start:e,end:i,type:r},a}return(0,l.Z)(n,[{key:"equals",value:function(e){return R(e)&&this.type===e.type&&(0,p.k)(this.start,e.start)&&(0,p.k)(this.end,e.end)}},{key:"closestTo",value:function(e){return(0,f.uc)((0,v.z9)(e,this.planeLike))}},{key:"closestEndTo",value:function(e){var t=this.start,n=this.end;return Math.sign((0,c.h)((0,c.a)(O,n,t),(0,c.a)(L,e,t)))>0?n:t}}]),n}(g),Z=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,i){return(0,s.Z)(this,n),t.call(this,e,i,v.Jk.HALF_PLANE)}return(0,l.Z)(n)}(k),P=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,i){return(0,s.Z)(this,n),t.call(this,e,i,v.Jk.PLANE)}return(0,l.Z)(n)}(k),D=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,i,r){var a;return(0,s.Z)(this,n),(a=t.call(this)).start=e,a.end=i,a.getZ=r,a.planeLike={start:e,end:i,type:v.Jk.HALF_PLANE},a}return(0,l.Z)(n,[{key:"equals",value:function(e){return T(e)&&(0,p.k)(this.start,e.start)&&(0,p.k)(this.end,e.end)&&this.getZ===e.getZ}},{key:"closestTo",value:function(e){return function(e,t){var n,i=(0,v.z9)(t,e.planeLike);return i[2]=null!==(n=(0,u.WG)(e.getZ(t[0],t[1],t[2])))&&void 0!==n?n:z,(0,f.uc)(i)}(this,e)}},{key:"addIfOnTheGround",value:function(e,t){var n,i=(0,r.Z)(t);try{for(i.s();!(n=i.n()).done;){var a=n.value,o=(0,u.Pt)(this.getZ(a[0],a[1],a[2]),0);Math.abs(a[2]-o)<v.Ho&&(a[2]=o,e.push(a))}}catch(s){i.e(s)}finally{i.f()}}}]),n}(g);function x(e,t){var n=e.planeLike,a=e.getZ,o=[];if(M(t))e.addIfOnTheGround(o,(0,v.hm)(n,t.point));else if(A(t))e.addIfOnTheGround(o,(0,v.fK)(n,t.lineLike));else if(E(t)){var s,l=(0,r.Z)((0,v.SD)(n,t.center,t.radius));try{for(l.s();!(s=l.n()).done;){var c=(0,i.Z)(s.value,2),d=c[0],p=c[1],f=a(d,p,0);(0,u.pC)(f)&&o.push((0,h.f)(d,p,f))}}catch(b){l.e(b)}finally{l.f()}}else if(R(t)||T(t)){var y,g=(0,r.Z)((0,v.qi)(n,t.planeLike));try{for(g.s();!(y=g.n()).done;){var m,_=(0,i.Z)(y.value,2),S=_[0],w=_[1],C=null!==(m=(0,u.WG)(a(S,w,0)))&&void 0!==m?m:z;o.push((0,h.f)(S,w,C))}}catch(b){g.e(b)}finally{g.f()}}return o}function M(e){return e instanceof m}function A(e){return e instanceof _}function E(e){return e instanceof b}function R(e){return e instanceof k}function T(e){return e instanceof D}var O=(0,d.a)(),L=(0,d.a)(),z=0},80371:function(e,t,n){var i;n.d(t,{B:function(){return i}}),function(e){e[e.FEATURE=1]="FEATURE",e[e.SELF=2]="SELF",e[e.ALL=3]="ALL"}(i||(i={}))},1700:function(e,t,n){n.d(t,{$D:function(){return c},$G:function(){return u},Gs:function(){return p},SH:function(){return h},bQ:function(){return l},dF:function(){return d},uc:function(){return s}});var i=n(92026),r=n(71353),a=n(65618),o=n(74509);function s(e){return e}function l(e){return(0,r.a)(e)}function u(e,t,n){return(0,r.f)(e,t,n)}function c(e,t,n){return(0,i.Wi)(e)?null:d(n.coordinateHelper.vectorToDehydratedPoint(e,f),t,n)}function d(e,t,n){var a,s;if((0,i.Wi)(e))return null;if((0,i.Wi)(t))return(0,r.f)(e.x,e.y,null!==(a=e.z)&&void 0!==a?a:0);if("2d"===t.type)return(0,r.f)(e.x,e.y,0);var l=n.elevationInfo,u=null!==(s=(0,o.vQ)(t,e,l,o.jG))&&void 0!==s?s:0;return(0,r.f)(e.x,e.y,u)}function p(e,t,n){var r,s=n.z,l=n.m,u=n.spatialReference,c=n.elevationInfo;if(null==s&&null==l){var d=(0,a.Tx)(e[0],e[1],void 0,u);return null!=l&&(d.m=l,d.hasM=!0),d}if((0,i.Wi)(t)||"2d"===t.type){var p=(0,a.Tx)(e[0],e[1],s,u);return null!=l&&(p.m=l,p.hasM=!0),p}var h=null!==(r=(0,o.zx)(t,e,u,o.jG,c))&&void 0!==r?r:0,f=(0,a.Tx)(e[0],e[1],h,u);return null!=l&&(f.m=l,f.hasM=!0),f}function h(e,t){return(0,a.Tx)(e[0],e[1],e[2],t)}var f=(0,a.Tx)(0,0,0,null)},97760:function(e,t,n){n.d(t,{k:function(){return p}});var i=n(1413),r=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(95122),u=n(64674),c=n(75691),d=n(53397),p=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){return(0,r.Z)(this,n),t.call(this,(0,i.Z)((0,i.Z)({},e),{},{isDraped:!0,constraint:new l.M8(e.edgeStart,e.edgeEnd,e.getGroundElevation)}))}return(0,a.Z)(n,[{key:"hints",get:function(){return[new d.w(u.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}]),n}(c.a)},95905:function(e,t,n){n.d(t,{L:function(){return p}});var i=n(1413),r=n(15671),a=n(43144),o=n(60136),s=n(29388),l=n(95122),u=n(64674),c=n(75691),d=n(53397),p=function(e){(0,o.Z)(n,e);var t=(0,s.Z)(n);function n(e){return(0,r.Z)(this,n),t.call(this,(0,i.Z)((0,i.Z)({},e),{},{constraint:new l.ku(e.edgeStart,e.edgeEnd)}))}return(0,a.Z)(n,[{key:"hints",get:function(){return[new d.w(u.ze.REFERENCE,this.constraint.start,this.constraint.end,this.isDraped,this.domain)]}}]),n}(c.a)},75691:function(e,t,n){n.d(t,{a:function(){return l}});var i=n(43144),r=n(15671),a=n(60136),o=n(29388),s=n(80371),l=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e){var i,a=e.targetPoint,o=e.objectId,l=e.constraint,u=e.isDraped;return(0,r.Z)(this,n),(i=t.call(this,a,l,u,s.B.FEATURE)).objectId=o,i}return(0,i.Z)(n)}(n(92605).j)},92605:function(e,t,n){n.d(t,{j:function(){return a}});var i=n(43144),r=n(15671),a=(0,i.Z)((function e(t,n,i,a){(0,r.Z)(this,e),this.targetPoint=t,this.constraint=n,this.isDraped=i,this.domain=a}))},53397:function(e,t,n){n.d(t,{w:function(){return u}});var i=n(15671),r=n(43144),a=n(60136),o=n(29388),s=(n(93169),n(32718),n(11186)),l=n(80371),u=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a,o){var s,u=arguments.length>4&&void 0!==arguments[4]?arguments[4]:l.B.ALL,c=!(arguments.length>5&&void 0!==arguments[5])||arguments[5],d=!(arguments.length>6&&void 0!==arguments[6])||arguments[6];return(0,i.Z)(this,n),(s=t.call(this,o,u)).type=e,s.lineStart=r,s.lineEnd=a,s.fadeLeft=c,s.fadeRight=d,s}return(0,r.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&this.type===e.type&&(0,s.k)(this.lineStart,e.lineStart)&&(0,s.k)(this.lineEnd,e.lineEnd)&&this.fadeLeft===e.fadeLeft&&this.fadeRight===e.fadeRight}},{key:"length",get:function(){return(0,s.i)(this.lineStart,this.lineEnd)}}]),n}(n(55054).r)},61309:function(e,t,n){n.d(t,{n:function(){return l}});var i=n(15671),r=n(43144),a=n(60136),o=n(29388),s=n(11186),l=function(e){(0,a.Z)(n,e);var t=(0,o.Z)(n);function n(e,r,a){var o;return(0,i.Z)(this,n),(o=t.call(this,r,a)).point=e,o}return(0,r.Z)(n,[{key:"equals",value:function(e){return e instanceof n&&(0,s.k)(this.point,e.point)}}]),n}(n(55054).r)},55054:function(e,t,n){n.d(t,{r:function(){return a}});var i=n(43144),r=n(15671),a=(0,i.Z)((function e(t,n){(0,r.Z)(this,e),this.isDraped=t,this.domain=n}))},64674:function(e,t,n){n.d(t,{Bb:function(){return d},ML:function(){return y},Ob:function(){return g},_j:function(){return v},fG:function(){return p},lQ:function(){return h},rh:function(){return f},ze:function(){return i}});var i,r=n(92026),a=n(94172),o=n(11186),s=n(65618),l=n(1614),u=n(87888),c=n(1700);function d(e,t){var n=e.x-t.x,i=e.y-t.y;return n*n+i*i}function p(e,t){return Math.sqrt(d(e,t))}function h(e,t){t.sort((function(t,n){return(0,o.d)(t.targetPoint,e)-(0,o.d)(n.targetPoint,e)}))}function f(e,t,n){var i=e.point,a=e.distance,o=e.types,l=e.coordinateHelper.spatialReference;return{point:(0,s.Tx)(i[0],i[1],i[2],l.toJSON()),mode:t,distance:a,types:o,query:(0,r.pC)(n)?n.toJSON():{where:"1=1"}}}function v(e,t,n){return{left:(0,c.$D)(e.leftVertex.pos,t,n),right:(0,c.$D)(e.rightVertex.pos,t,n)}}function y(e){return e.createQuery()}function g(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},n=(0,a.YP)((function(){return{view:e.view,snappingOptions:e.snappingOptions}}),(function(n){var i=n.view,a=n.snappingOptions,o="snapping-toggle",s=l.f.TOOL;if(e.removeHandles(o),i&&(0,r.pC)(a)){var c=[i.on("key-down",(function(e){e.key!==u.c.toggle||e.repeat||(a.enabledToggled=!0,t())}),s),i.on("key-up",(function(e){e.key===u.c.toggle&&(a.enabledToggled=!1,t())}),s),i.on("pointer-move",(function(e){var n=e.native.ctrlKey;a.enabledToggled!==n&&(a.enabledToggled=n,t())}),s)];e.addHandles(c,o)}}),a.tX);e.addHandles(n)}!function(e){e[e.TARGET=0]="TARGET",e[e.REFERENCE=1]="REFERENCE",e[e.REFERENCE_EXTENSION=2]="REFERENCE_EXTENSION"}(i||(i={}))},55793:function(e,t,n){n.d(t,{CJ:function(){return S},Ho:function(){return P},Jk:function(){return r},Lh:function(){return w},SD:function(){return h},Xi:function(){return b},ZE:function(){return _},fK:function(){return f},hm:function(){return v},pk:function(){return C},qi:function(){return y},sc:function(){return m},z9:function(){return g}});var i,r,a=n(4942),o=n(37762),s=n(16889),l=n(88396),u=n(6394),c=n(11186),d=n(71353),p=n(94163);function h(e,t,n){var i=e.start,a=e.end,o=e.type,s=[],c=(0,l.a)(D,a,i),d=(0,l.a)(x,i,t),p=(0,l.v)(c),h=2*(0,l.h)(c,d),f=h*h-4*p*((0,l.v)(d)-n*n);if(0===f){var v=-h/(2*p);(o===r.PLANE||v>=0)&&s.push((0,l.w)((0,u.a)(),i,c,v))}else if(f>0){var y=Math.sqrt(f),g=(-h+y)/(2*p);(o===r.PLANE||g>=0)&&s.push((0,l.w)((0,u.a)(),i,c,g));var m=(-h-y)/(2*p);(o===r.PLANE||m>=0)&&s.push((0,l.w)((0,u.a)(),i,c,m))}return s}function f(e,t){var n=e.start,i=e.end,a=(0,l.a)(D,i,n),o=(0,c.s)(x,-a[1],a[0],0),s=t.start,u=t.end,h=(0,c.w)(M,u,s),f=(0,c.e)(h,o),v=(0,c.s)(A,n[0],n[1],0),y=(0,c.w)(E,v,s),g=(0,c.e)(y,o);if(Math.abs(f)<P)return Math.abs(g),[];var m=(0,c.z)(R,s,h,g/f);if(t.type===p.SP.RAY){var _=(0,c.w)(T,m,s);if((0,c.e)(_,h)<-P)return[]}if(e.type===r.HALF_PLANE){var S=(0,l.e)(T,m,n);if((0,l.h)(S,a)<-P)return[]}return[(0,d.a)(m)]}function v(e,t){return C(k(O,t[2],e),t)}function y(e,t){var n,i=w(k(O,0,e),k(L,0,t)),r=[],a=(0,o.Z)(i);try{for(a.s();!(n=a.n()).done;){var s=n.value;r.push((0,u.d)(s))}}catch(l){a.e(l)}finally{a.f()}return r}function g(e,t){return _(e,k(O,e[2],t))}function m(e,t,n){var i=(0,l.a)(D,e,t),r=n/(0,l.i)(i),a=(0,l.w)((0,d.c)(),t,i,r);return a[2]=e[2],a}function _(e,t){var n=t.start,i=t.end,r=t.type,a=(0,c.w)(D,e,n),o=(0,c.w)(x,i,n),s=(0,c.e)(a,o)/(0,c.e)(o,o);return(0,c.z)((0,d.c)(),n,o,r===p.SP.RAY?Math.max(s,0):s)}function S(e,t,n){var i=e.start,r=e.end,a=e.type,o=[],s=(0,c.b)(D,r,i),u=(0,l.a)(x,i,t),h=(0,l.v)(s),f=2*(0,l.h)(s,u),v=f*f-4*h*((0,l.v)(u)-n*n);if(0===v){var y=-f/(2*h);(a===p.SP.LINE||y>=0)&&o.push((0,c.z)((0,d.c)(),i,s,y))}else if(v>0){var g=Math.sqrt(v),m=(-f+g)/(2*h);(a===p.SP.LINE||m>=0)&&o.push((0,c.z)((0,d.c)(),i,s,m));var _=(-f-g)/(2*h);(a===p.SP.LINE||_>=0)&&o.push((0,c.z)((0,d.c)(),i,s,_))}return o}function w(e,t){var n=e.start,i=e.end,r=t.start,a=t.end,o=(0,c.w)(D,i,n),l=(0,c.w)(x,a,r),u=(0,c.w)(M,r,n),h=(0,c.f)(A,o,l),f=(0,c.e)(u,h);if(!(0,s.W8)(f,0,P))return[];var v=(0,c.D)(h);if((0,s.W8)(v,0,P))return[];var y=(0,c.f)(E,u,l),g=(0,c.e)(y,h)/v,m=(0,c.z)(R,n,o,g);if(e.type===p.SP.RAY){var _=(0,c.w)(T,m,n);if((0,c.e)(o,_)<-P)return[]}if(t.type===p.SP.RAY){var S=(0,c.w)(T,m,r);if((0,c.e)(l,S)<-P)return[]}return[(0,d.a)(m)]}function C(e,t){var n=e.start,i=e.end,r=e.type,a=(0,c.w)(D,t,n),o=(0,c.w)(x,i,n),s=(0,c.f)(M,o,a);if((0,c.D)(s)/(0,c.D)(o)<P)switch(r){case p.SP.LINE:return[(0,d.a)(t)];case p.SP.RAY:return(0,c.e)(o,a)<-P?[]:[(0,d.a)(t)]}return[]}function b(e,t,n){return(0,s.W8)((0,l.k)(n,e),t*t,P)?[(0,d.a)(n)]:[]}function k(e,t,n){var i=n.start,r=n.end,a=n.type;return(0,c.s)(e.start,i[0],i[1],t),(0,c.s)(e.end,r[0],r[1],t),e.type=Z[a],e}!function(e){e[e.PLANE=0]="PLANE",e[e.HALF_PLANE=1]="HALF_PLANE"}(r||(r={}));var Z=(i={},(0,a.Z)(i,r.PLANE,p.SP.LINE),(0,a.Z)(i,r.HALF_PLANE,p.SP.RAY),i),P=1e-6,D=(0,d.c)(),x=(0,d.c)(),M=(0,d.c)(),A=(0,d.c)(),E=(0,d.c)(),R=(0,d.c)(),T=(0,d.c)(),O={start:(0,d.c)(),end:(0,d.c)(),type:p.SP.LINE},L={start:(0,d.c)(),end:(0,d.c)(),type:p.SP.LINE}}}]);
//# sourceMappingURL=5724.d522687f.chunk.js.map